# -*- coding: utf-8 -*-
from flask import Flask, request, jsonify
from langchain.vectorstores import Chroma
from langchain.embeddings import OpenAIEmbeddings
from langchain.chat_models import ChatOpenAI
from langchain.chains import RetrievalQA
import os
from dotenv import load_dotenv
load_dotenv()
import sqlite3
import stripe
import requests
import zipfile
import json
import re
import traceback
import random

app = Flask(__name__)

# GASã¸ã®æ±ºæ¸ˆæˆåŠŸé€šçŸ¥é–¢æ•°
def notify_gas_payment_success(user_id):
    GAS_URL = os.getenv("GAS_NOTIFY_URL")
    if not GAS_URL:
        print("âš ï¸ GAS_NOTIFY_URLãŒè¨­å®šã•ã‚Œã¦ã„ã¾ã›ã‚“ã€‚é€šçŸ¥ã‚’ã‚¹ã‚­ãƒƒãƒ—ã—ã¾ã™ã€‚")
        return
    
    try:
        res = requests.post(GAS_URL, json={"userId": user_id, "paid": True})
        print("âœ… GASé€šçŸ¥é€ä¿¡æ¸ˆã¿:", res.status_code, res.text)
    except Exception as e:
        print("âŒ GASé€šçŸ¥ã‚¨ãƒ©ãƒ¼:", str(e))

# GASã¸ã®è©³ç´°ã‚¢ãƒ‰ãƒã‚¤ã‚¹é€ä¿¡é–¢æ•°
def send_detailed_advice_to_gas(user_id, mbti):
    GAS_URL = os.getenv("GAS_NOTIFY_URL")
    if not GAS_URL:
        print("âš ï¸ GAS_NOTIFY_URLãŒè¨­å®šã•ã‚Œã¦ã„ã¾ã›ã‚“ã€‚è©³ç´°ã‚¢ãƒ‰ãƒã‚¤ã‚¹é€ä¿¡ã‚’ã‚¹ã‚­ãƒƒãƒ—ã—ã¾ã™ã€‚")
        return
    
    try:
        res = requests.post(GAS_URL, json={
            "action": "send_detailed_advice",
            "userId": user_id,
            "mbti": mbti
        })
        print("âœ… è©³ç´°ã‚¢ãƒ‰ãƒã‚¤ã‚¹é€ä¿¡æ¸ˆã¿:", res.status_code, res.text)
    except Exception as e:
        print("âŒ è©³ç´°ã‚¢ãƒ‰ãƒã‚¤ã‚¹é€ä¿¡ã‚¨ãƒ©ãƒ¼:", str(e))

# GASã¸ã®ãƒãƒ£ãƒƒãƒˆãƒ¡ãƒƒã‚»ãƒ¼ã‚¸é€ä¿¡é–¢æ•°
def send_chat_message_to_gas(user_id, mbti):
    GAS_URL = os.getenv("GAS_NOTIFY_URL")
    if not GAS_URL:
        print("âš ï¸ GAS_NOTIFY_URLãŒè¨­å®šã•ã‚Œã¦ã„ã¾ã›ã‚“ã€‚ãƒãƒ£ãƒƒãƒˆãƒ¡ãƒƒã‚»ãƒ¼ã‚¸é€ä¿¡ã‚’ã‚¹ã‚­ãƒƒãƒ—ã—ã¾ã™ã€‚")
        return
    
    try:
        res = requests.post(GAS_URL, json={
            "action": "send_chat_message",
            "userId": user_id,
            "mbti": mbti
        })
        print("âœ… ãƒãƒ£ãƒƒãƒˆãƒ¡ãƒƒã‚»ãƒ¼ã‚¸é€ä¿¡æ¸ˆã¿:", res.status_code, res.text)
    except Exception as e:
        print("âŒ ãƒãƒ£ãƒƒãƒˆãƒ¡ãƒƒã‚»ãƒ¼ã‚¸é€ä¿¡ã‚¨ãƒ©ãƒ¼:", str(e))

# ğŸ” OpenAIãƒ»Stripeãƒ»LINEè¨­å®š
openai_api_key = os.getenv("OPENAI_API_KEY")
stripe.api_key = os.getenv("STRIPE_SECRET_KEY")
stripe_price_id = os.getenv("STRIPE_PRICE_ID")
stripe_webhook_secret = os.getenv("STRIPE_WEBHOOK_SECRET")

# ğŸ’¾ ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ãƒ‘ã‚¹è¨­å®šï¼ˆç’°å¢ƒã«å¿œã˜ã¦åˆ‡ã‚Šæ›¿ãˆï¼‰
DB_PATH = os.getenv("DB_PATH", "/data/user_data.db")  # æœ¬ç•ªç’°å¢ƒã§ã¯æ°¸ç¶šãƒ‡ã‚£ã‚¹ã‚¯ã‚’ä½¿ç”¨

# ğŸ§³ chroma_db.zip ã‚’å±•é–‹ï¼ˆåˆå›èµ·å‹•æ™‚ï¼‰
if not os.path.exists("./chroma_db") and os.path.exists("./chroma_db.zip"):
    print("chroma_db.zipã‚’å±•é–‹ä¸­...")
    with zipfile.ZipFile("./chroma_db.zip", 'r') as zip_ref:
        zip_ref.extractall("./")
    print("chroma_db.zipã®å±•é–‹ãŒå®Œäº†ã—ã¾ã—ãŸã€‚")

# ğŸ“– MBTIã‚¢ãƒ‰ãƒã‚¤ã‚¹èª­ã¿è¾¼ã¿
if not os.path.exists("mbti_advice.json"):
    print("ã‚¨ãƒ©ãƒ¼: mbti_advice.jsonãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“ã€‚")
    mbti_detailed_advice = {}
else:
    with open("mbti_advice.json", "r", encoding="utf-8") as f:
        mbti_detailed_advice = json.load(f)
    print("mbti_advice.jsonã‚’èª­ã¿è¾¼ã¿ã¾ã—ãŸã€‚")

# MBTIãƒ‹ãƒƒã‚¯ãƒãƒ¼ãƒ ã®å®šç¾©
MBTI_NICKNAME = {
    "INTJ": "é™ã‹ãªã‚‹æ„›ã®åœ°é›·å‡¦ç†ç­",
    "INTP": "ã“ã˜ã‚‰ã›çŸ¥èƒ½å‹ãƒ©ãƒ–ãƒ­ãƒœ",
    "ENTJ": "æ‹ã‚‚ä¸»å°æ¨©ã‚¬ãƒå‹¢",
    "ENTP": "æ‹ã®ã‚¸ã‚§ãƒƒãƒˆã‚³ãƒ¼ã‚¹ã‚¿ãƒ¼",
    "INFJ": "é‡ãŸã‚ãƒ©ãƒ–ãƒã‚¨ãƒãƒ¼ğŸ“œ",
    "INFP": "æ„›ã•ã‚ŒãŸã„ãƒ¢ãƒ³ã‚¹ã‚¿ãƒ¼ğŸ§¸",
    "ENFJ": "ã”å¥‰ä»•ãƒãƒãƒ¼ã‚¸ãƒ£ãƒ¼ğŸ“‹",
    "ENFP": "ã‹ã¾ã£ã¦ãƒ•ã‚§ãƒ‹ãƒƒã‚¯ã‚¹ğŸ”¥",
    "ISTJ": "æ‹æ„›ãƒ«ãƒ¼ãƒ«ãƒ–ãƒƒã‚¯ğŸ“˜",
    "ISFJ": "æ„Ÿæƒ…ã—ã¿ã—ã¿ãŠã§ã‚“ğŸ¢",
    "ESTJ": "æ­£è«–ã¶ã‚“å›ã—ä¾âš”ï¸",
    "ESFJ": "æ„›ã®æŠ¼ã—å£²ã‚Šç™¾è²¨åº—ğŸ›ï¸",
    "ISTP": "ç”˜ãˆæ–¹ã‚ã‹ã‚‰ã‚“æ˜ŸäººğŸª",
    "ISFP": "ã¬ãã‚‚ã‚Šä¸­æ¯’è€…ğŸ”¥",
    "ESTP": "å‹¢ã„é‡è¦–æ—ğŸ“¶",
    "ESFP": "ãƒã‚¤ãƒ†ãƒ³ãƒ»ãƒ©ãƒ–ãƒ»ã‚¸ã‚§ãƒƒãƒˆğŸš€"
}

# MBTIåˆ¥ã®è©³ç´°ãªæ€§æ ¼ç‰¹å¾´ã¨æ‹æ„›å‚¾å‘
MBTI_PERSONALITY = {
    "INTJ": {
        "traits": ["æˆ¦ç•¥çš„æ€è€ƒ", "ç‹¬ç«‹å¿ƒãŒå¼·ã„", "å®Œç’§ä¸»ç¾©", "è«–ç†çš„", "æ´å¯ŸåŠ›", "åŠ¹ç‡æ€§é‡è¦–", "ãƒ—ãƒ©ã‚¤ãƒã‚·ãƒ¼é‡è¦–"],
        "love_style": "æ·±ã„çµ†ã‚’æ±‚ã‚ã‚‹ãŒã€ãƒ—ãƒ©ã‚¤ãƒã‚·ãƒ¼ã‚‚å¤§åˆ‡ã«ã™ã‚‹çŸ¥çš„ãƒ‘ãƒ¼ãƒˆãƒŠãƒ¼ã‚·ãƒƒãƒ—ã€‚é•·æœŸçš„ãªãƒ“ã‚¸ãƒ§ãƒ³ã‚’å…±æœ‰ã—ã€ãŠäº’ã„ã®æˆé•·ã‚’ã‚µãƒãƒ¼ãƒˆã—åˆã†é–¢ä¿‚ã‚’é‡è¦–ã™ã‚‹ã€‚æ„Ÿæƒ…è¡¨ç¾ã¯æ§ãˆã‚ã ãŒã€èª å®Ÿã•ã¨ä¸€è²«æ€§ã§ç›¸æ‰‹ã‚’æ”¯ãˆã‚‹ã€‚åŠ¹ç‡çš„ã§æˆ¦ç•¥çš„ãªã‚¢ãƒ—ãƒ­ãƒ¼ãƒã‚’å¥½ã¿ã€ç„¡é§„ã®ãªã„æ„›æƒ…è¡¨ç¾ã‚’å¿ƒãŒã‘ã‚‹ã€‚",
        "strengths": ["é•·æœŸçš„ãªè¦–ç‚¹", "èª å®Ÿã•", "çŸ¥çš„åˆºæ¿€", "æˆ¦ç•¥çš„ã‚¢ãƒ—ãƒ­ãƒ¼ãƒ", "ä¸€è²«æ€§"],
        "challenges": ["æ„Ÿæƒ…è¡¨ç¾ãŒè‹¦æ‰‹", "å®Œç’§ã‚’æ±‚ã‚ã‚‹", "ç›¸æ‰‹ã®æ„Ÿæƒ…ã‚’ç†è§£ã—ã«ãã„", "æŸ”è»Ÿæ€§ä¸è¶³"],
        "advice_style": "è«–ç†çš„ã§æ§‹é€ åŒ–ã•ã‚ŒãŸã‚¢ãƒ‰ãƒã‚¤ã‚¹",
        "likes_in_partner": ["çŸ¥çš„åˆºæ¿€", "ç‹¬ç«‹å¿ƒ", "åŠ¹ç‡æ€§", "èª å®Ÿã•", "é•·æœŸçš„ãƒ“ã‚¸ãƒ§ãƒ³", "ãƒ—ãƒ©ã‚¤ãƒã‚·ãƒ¼ã‚’å°Šé‡"],
        "dislikes_in_partner": ["æ„Ÿæƒ…çš„ãªè¦æ±‚", "ç„¡è¨ˆç”»", "è¡¨é¢çš„ãªé–¢ä¿‚", "ä¾å­˜å¿ƒ", "éåŠ¹ç‡"],
        "common_concerns": ["ç›¸æ‰‹ãŒè‡ªåˆ†ã®æ„Ÿæƒ…ã‚’ç†è§£ã—ã¦ãã‚Œãªã„", "å®Œç’§ä¸»ç¾©ã§ç›¸æ‰‹ã‚’è¿½ã„è©°ã‚ã¦ã—ã¾ã†", "æ„Ÿæƒ…è¡¨ç¾ãŒä¸‹æ‰‹"],
        "my_approaches": ["ç›¸æ‰‹ã®çŸ¥çš„å¥½å¥‡å¿ƒã‚’åˆºæ¿€ã™ã‚‹", "åŠ¹ç‡çš„ãªãƒ‡ãƒ¼ãƒˆãƒ—ãƒ©ãƒ³ã‚’ææ¡ˆã™ã‚‹", "ãƒ—ãƒ©ã‚¤ãƒã‚·ãƒ¼ã‚’å°Šé‡ã™ã‚‹"],
        "partner_approaches": ["ç›¸æ‰‹ã®æˆ¦ç•¥çš„æ€è€ƒã‚’æ´»ã‹ã—ãŸä¼šè©±ã‚’ã™ã‚‹", "ç›¸æ‰‹ã®åŠ¹ç‡æ€§ã‚’é‡è¦–ã—ãŸãƒ‡ãƒ¼ãƒˆãƒ—ãƒ©ãƒ³ã‚’ç«‹ã¦ã‚‹", "ç›¸æ‰‹ã®ãƒ—ãƒ©ã‚¤ãƒã‚·ãƒ¼ã‚’å°Šé‡ã—ãŸè·é›¢æ„Ÿã‚’ä¿ã¤", "ç›¸æ‰‹ã®è«–ç†çš„æ€è€ƒã«åˆã‚ã›ãŸèª¬æ˜ã‚’ã™ã‚‹", "ç›¸æ‰‹ã®é•·æœŸçš„ãƒ“ã‚¸ãƒ§ãƒ³ã«å…±æ„Ÿã‚’ç¤ºã™"],
        "ng_behaviors": ["æ„Ÿæƒ…çš„ãªè¦æ±‚ã‚’æŠ¼ã—ä»˜ã‘ã‚‹", "ç„¡è¨ˆç”»ãªè¡Œå‹•ã‚’å¼·è¦ã™ã‚‹", "è¡¨é¢çš„ãªä¼šè©±ã°ã‹ã‚Šã™ã‚‹"],
        "partner_ng_behaviors": ["ç›¸æ‰‹ã®ãƒ—ãƒ©ã‚¤ãƒã‚·ãƒ¼ã‚’ä¾µå®³ã™ã‚‹", "ç›¸æ‰‹ã®åŠ¹ç‡æ€§ã‚’ç„¡è¦–ã—ãŸç„¡è¨ˆç”»ãªææ¡ˆã‚’ã™ã‚‹", "ç›¸æ‰‹ã®è«–ç†çš„æ€è€ƒã‚’å¦å®šã™ã‚‹", "ç›¸æ‰‹ã®å®Œç’§ä¸»ç¾©ã‚’æ‰¹åˆ¤ã™ã‚‹", "ç›¸æ‰‹ã®ç‹¬ç«‹å¿ƒã‚’æŸç¸›ã—ã‚ˆã†ã¨ã™ã‚‹"],
        "partner_ng_behaviors": ["ç›¸æ‰‹ã®ãƒ—ãƒ©ã‚¤ãƒã‚·ãƒ¼ã‚’ä¾µå®³ã™ã‚‹", "ç›¸æ‰‹ã®åŠ¹ç‡æ€§ã‚’ç„¡è¦–ã—ãŸç„¡è¨ˆç”»ãªææ¡ˆã‚’ã™ã‚‹", "ç›¸æ‰‹ã®è«–ç†çš„æ€è€ƒã‚’å¦å®šã™ã‚‹", "ç›¸æ‰‹ã®å®Œç’§ä¸»ç¾©ã‚’æ‰¹åˆ¤ã™ã‚‹", "ç›¸æ‰‹ã®ç‹¬ç«‹å¿ƒã‚’æŸç¸›ã—ã‚ˆã†ã¨ã™ã‚‹"]
    },
    "INTP": {
        "traits": ["åˆ†æçš„æ€è€ƒ", "å¥½å¥‡å¿ƒæ—ºç››", "ç‹¬å‰µçš„", "æŸ”è»Ÿæ€§", "è«–ç†çš„", "å‰µé€ çš„", "ç‹¬ç«‹å¿ƒ"],
        "love_style": "çŸ¥çš„ãƒ‘ãƒ¼ãƒˆãƒŠãƒ¼ã‚·ãƒƒãƒ—ã‚’é‡è¦–ã—ã€è‡ªç”±ãªé–¢ä¿‚ã‚’æ±‚ã‚ã‚‹ã€‚æ·±ã„ä¼šè©±ã¨æ–°ã—ã„ç™ºè¦‹ã‚’å…±æœ‰ã—ã€ãŠäº’ã„ã®å¥½å¥‡å¿ƒã‚’åˆºæ¿€ã—åˆã†é–¢ä¿‚ã‚’å¤§åˆ‡ã«ã™ã‚‹ã€‚æ„Ÿæƒ…è¡¨ç¾ã¯æ§ãˆã‚ã ãŒã€ç›¸æ‰‹ã®å€‹æ€§ã‚’å°Šé‡ã—ã€æŸç¸›ã®ãªã„è‡ªç”±ãªæ„›æƒ…ã‚’è¡¨ç¾ã™ã‚‹ã€‚å‰µé€ çš„ã§é©æ–°çš„ãªã‚¢ãƒ—ãƒ­ãƒ¼ãƒã‚’å¥½ã¿ã€ä¼çµ±çš„ãªæ‹æ„›è¦³ã«ã¨ã‚‰ã‚ã‚Œãªã„ã€‚",
        "strengths": ["å‰µé€ æ€§", "ã‚ªãƒ¼ãƒ—ãƒ³ãƒã‚¤ãƒ³ãƒ‰", "æ·±ã„æ´å¯ŸåŠ›", "å•é¡Œè§£æ±ºåŠ›", "ç‹¬å‰µçš„ã‚¢ã‚¤ãƒ‡ã‚¢"],
        "challenges": ["æ—¥å¸¸çš„ãªæ„Ÿæƒ…è¡¨ç¾", "æ±ºæ–­åŠ›", "ç›¸æ‰‹ã®æ„Ÿæƒ…ã¸ã®é…æ…®", "å®Ÿè·µæ€§"],
        "advice_style": "åˆ†æçš„ã§å¤šè§’çš„ãªè¦–ç‚¹ã‹ã‚‰ã®ã‚¢ãƒ‰ãƒã‚¤ã‚¹",
        "likes_in_partner": ["çŸ¥çš„åˆºæ¿€", "å‰µé€ æ€§", "ç‹¬ç«‹å¿ƒ", "ã‚ªãƒ¼ãƒ—ãƒ³ãƒã‚¤ãƒ³ãƒ‰", "æ·±ã„ä¼šè©±", "è‡ªç”±ãªé–¢ä¿‚"],
        "dislikes_in_partner": ["æ„Ÿæƒ…çš„ãªè¦æ±‚", "ä¼çµ±çš„ãªä¾¡å€¤è¦³", "è¡¨é¢çš„ãªé–¢ä¿‚", "æŸç¸›", "éè«–ç†çš„"],
        "common_concerns": ["æ„Ÿæƒ…è¡¨ç¾ãŒè‹¦æ‰‹", "æ±ºæ–­ãŒã§ããªã„", "ç›¸æ‰‹ã®æ„Ÿæƒ…ã‚’ç†è§£ã—ã«ãã„"],
        "my_approaches": ["çŸ¥çš„ä¼šè©±ã§èˆˆå‘³ã‚’å¼•ã", "å‰µé€ çš„ãªãƒ‡ãƒ¼ãƒˆã‚’ææ¡ˆã™ã‚‹", "è‡ªç”±ãªé–¢ä¿‚ã‚’å°Šé‡ã™ã‚‹"],
        "partner_approaches": ["ç›¸æ‰‹ã®å‰µé€ æ€§ã‚’åˆºæ¿€ã™ã‚‹è©±é¡Œã‚’æä¾›ã™ã‚‹", "ç›¸æ‰‹ã®å¥½å¥‡å¿ƒã‚’æº€ãŸã™æ–°ã—ã„ä½“é¨“ã‚’ææ¡ˆã™ã‚‹", "ç›¸æ‰‹ã®ç‹¬ç«‹å¿ƒã‚’å°Šé‡ã—ãŸè‡ªç”±ãªé–¢ä¿‚ã‚’ç¯‰ã", "ç›¸æ‰‹ã®è«–ç†çš„æ€è€ƒã«åˆã‚ã›ãŸæ·±ã„ä¼šè©±ã‚’ã™ã‚‹", "ç›¸æ‰‹ã®æŸ”è»Ÿæ€§ã‚’æ´»ã‹ã—ãŸã‚¢ãƒ—ãƒ­ãƒ¼ãƒã‚’å¿ƒãŒã‘ã‚‹"],
        "ng_behaviors": ["æ„Ÿæƒ…çš„ãªè¦æ±‚ã‚’æŠ¼ã—ä»˜ã‘ã‚‹", "ä¼çµ±çš„ãªä¾¡å€¤è¦³ã‚’å¼·è¦ã™ã‚‹", "æŸç¸›ã™ã‚‹"],
        "partner_ng_behaviors": ["ç›¸æ‰‹ã®ç‹¬ç«‹å¿ƒã‚’æŸç¸›ã—ã‚ˆã†ã¨ã™ã‚‹", "ç›¸æ‰‹ã®è«–ç†çš„æ€è€ƒã‚’å¦å®šã™ã‚‹", "ç›¸æ‰‹ã®å‰µé€ æ€§ã‚’åˆ¶é™ã™ã‚‹", "ç›¸æ‰‹ã®å¥½å¥‡å¿ƒã‚’ç„¡è¦–ã™ã‚‹", "ç›¸æ‰‹ã®è‡ªç”±ã‚’åˆ¶é™ã—ã‚ˆã†ã¨ã™ã‚‹"]
    },
    "ENTJ": {
        "traits": ["ãƒªãƒ¼ãƒ€ãƒ¼ã‚·ãƒƒãƒ—", "æ±ºæ–­åŠ›", "åŠ¹ç‡æ€§é‡è¦–", "è‡ªä¿¡å®¶", "æˆ¦ç•¥çš„", "å®Ÿè¡ŒåŠ›", "ç›®æ¨™å¿—å‘"],
        "love_style": "ãƒ‘ãƒ¼ãƒˆãƒŠãƒ¼ã‚·ãƒƒãƒ—ã‚’æˆ¦ç•¥çš„ã«æ§‹ç¯‰ã—ã€ç›®æ¨™ã‚’å…±æœ‰ã™ã‚‹ã€‚æ˜ç¢ºãªãƒ“ã‚¸ãƒ§ãƒ³ã‚’æŒã¡ã€ãŠäº’ã„ã®æˆé•·ã¨æˆåŠŸã‚’ã‚µãƒãƒ¼ãƒˆã—åˆã†é–¢ä¿‚ã‚’é‡è¦–ã™ã‚‹ã€‚ãƒªãƒ¼ãƒ€ãƒ¼ã‚·ãƒƒãƒ—ã‚’ç™ºæ®ã—ã€åŠ¹ç‡çš„ã§å®Ÿè·µçš„ãªæ„›æƒ…è¡¨ç¾ã‚’å¿ƒãŒã‘ã‚‹ã€‚ç›¸æ‰‹ã®å¯èƒ½æ€§ã‚’ä¿¡ã˜ã€å…·ä½“çš„ãªã‚¹ãƒ†ãƒƒãƒ—ã§é–¢ä¿‚ã‚’ç™ºå±•ã•ã›ã‚‹ã€‚",
        "strengths": ["æ˜ç¢ºãªãƒ“ã‚¸ãƒ§ãƒ³", "å®Ÿè¡ŒåŠ›", "ç›¸æ‰‹ã®æˆé•·ã‚’ã‚µãƒãƒ¼ãƒˆ", "ãƒªãƒ¼ãƒ€ãƒ¼ã‚·ãƒƒãƒ—", "åŠ¹ç‡æ€§"],
        "challenges": ["æ„Ÿæƒ…çš„ãªæŸ”è»Ÿæ€§", "ç›¸æ‰‹ã®ãƒšãƒ¼ã‚¹ã‚’å°Šé‡", "æ”¯é…çš„ã«ãªã‚ŠãŒã¡", "å…±æ„ŸåŠ›"],
        "advice_style": "å…·ä½“çš„ã§å®Ÿè¡Œå¯èƒ½ãªã‚¹ãƒ†ãƒƒãƒ—ã‚’é‡è¦–",
        "likes_in_partner": ["ç›®æ¨™å¿—å‘", "åŠ¹ç‡æ€§", "æˆé•·æ„æ¬²", "ç‹¬ç«‹å¿ƒ", "çŸ¥çš„åˆºæ¿€", "å®Ÿè¡ŒåŠ›"],
        "dislikes_in_partner": ["ç„¡è¨ˆç”»", "ä¾å­˜å¿ƒ", "éåŠ¹ç‡", "æ„Ÿæƒ…çš„ãªè¦æ±‚", "æ¶ˆæ¥µçš„"],
        "common_concerns": ["ç›¸æ‰‹ãŒè‡ªåˆ†ã®ãƒšãƒ¼ã‚¹ã«ã¤ã„ã¦ã„ã‘ãªã„", "æ”¯é…çš„ã«ãªã£ã¦ã—ã¾ã†", "æ„Ÿæƒ…è¡¨ç¾ãŒè‹¦æ‰‹"],
        "my_approaches": ["ç›¸æ‰‹ã®æˆé•·ã‚’ã‚µãƒãƒ¼ãƒˆã™ã‚‹", "åŠ¹ç‡çš„ãªãƒ‡ãƒ¼ãƒˆãƒ—ãƒ©ãƒ³ã‚’ææ¡ˆã™ã‚‹", "ç›®æ¨™ã‚’å…±æœ‰ã™ã‚‹"],
        "partner_approaches": ["ç›¸æ‰‹ã®ãƒªãƒ¼ãƒ€ãƒ¼ã‚·ãƒƒãƒ—ã‚’å°Šé‡ã—ã€ã‚µãƒãƒ¼ãƒˆã™ã‚‹", "ç›¸æ‰‹ã®åŠ¹ç‡æ€§ã«åˆã‚ã›ãŸè¡Œå‹•ã‚’å¿ƒãŒã‘ã‚‹", "ç›¸æ‰‹ã®ç›®æ¨™ã«å…±æ„Ÿã—ã€å”åŠ›ã™ã‚‹", "ç›¸æ‰‹ã®æ±ºæ–­åŠ›ã«ä¿¡é ¼ã‚’ç½®ã", "ç›¸æ‰‹ã®å®Ÿè¡ŒåŠ›ã«åˆã‚ã›ãŸãƒšãƒ¼ã‚¹ã§é€²ã‚ã‚‹"],
        "ng_behaviors": ["æ„Ÿæƒ…çš„ãªè¦æ±‚ã‚’æŠ¼ã—ä»˜ã‘ã‚‹", "ç„¡è¨ˆç”»ãªè¡Œå‹•ã‚’å¼·è¦ã™ã‚‹", "ä¾å­˜å¿ƒã‚’å¼·ã‚ã‚‹"],
        "partner_ng_behaviors": ["ç›¸æ‰‹ã®ãƒªãƒ¼ãƒ€ãƒ¼ã‚·ãƒƒãƒ—ã‚’å¦å®šã™ã‚‹", "ç›¸æ‰‹ã®åŠ¹ç‡æ€§ã‚’ç„¡è¦–ã—ãŸç„¡è¨ˆç”»ãªè¡Œå‹•ã‚’ã™ã‚‹", "ç›¸æ‰‹ã®ç›®æ¨™ã‚’è»½è¦–ã™ã‚‹", "ç›¸æ‰‹ã®æ±ºæ–­åŠ›ã«ç–‘å•ã‚’æŠ•ã’ã‹ã‘ã‚‹", "ç›¸æ‰‹ã®å®Ÿè¡ŒåŠ›ã‚’é˜»å®³ã™ã‚‹"]
    },
    "ENTP": {
        "traits": ["å‰µé€ çš„æ€è€ƒ", "é©å¿œåŠ›", "è­°è«–å¥½ã", "å†’é™ºå¿ƒ", "æ©ŸçŸ¥", "æŸ”è»Ÿæ€§", "ç¤¾äº¤æ€§"],
        "love_style": "åˆºæ¿€çš„ã§å¤‰åŒ–ã«å¯Œã‚“ã é–¢ä¿‚ã‚’æ±‚ã‚ã‚‹ã€‚æ–°ã—ã„ä½“é¨“ã¨å†’é™ºã‚’å…±æœ‰ã—ã€ãŠäº’ã„ã‚’æ¥½ã—ã¾ã›åˆã†é–¢ä¿‚ã‚’å¤§åˆ‡ã«ã™ã‚‹ã€‚ãƒ¦ãƒ¼ãƒ¢ã‚¢ã¨å‰µé€ æ€§ã‚’æ­¦å™¨ã«ã€å¸¸ã«æ–°é®®ã§é­…åŠ›çš„ãªæ„›æƒ…è¡¨ç¾ã‚’å¿ƒãŒã‘ã‚‹ã€‚æŸ”è»Ÿæ€§ãŒã‚ã‚Šã€ç›¸æ‰‹ã®èˆˆå‘³ã‚„é–¢å¿ƒã«åˆã‚ã›ã¦ã‚¢ãƒ—ãƒ­ãƒ¼ãƒã‚’å¤‰åŒ–ã•ã›ã‚‹ã€‚",
        "strengths": ["ãƒ¦ãƒ¼ãƒ¢ã‚¢", "æ–°ã—ã„ã‚¢ã‚¤ãƒ‡ã‚¢", "ç›¸æ‰‹ã‚’æ¥½ã—ã¾ã›ã‚‹", "é©å¿œåŠ›", "å‰µé€ æ€§"],
        "challenges": ["ä¸€è²«æ€§", "æ·±ã„æ„Ÿæƒ…ã®å…±æœ‰", "é•·æœŸçš„ãªã‚³ãƒŸãƒƒãƒˆãƒ¡ãƒ³ãƒˆ", "æ„Ÿæƒ…ã®å®‰å®š"],
        "advice_style": "å‰µé€ çš„ã§é©æ–°çš„ãªã‚¢ãƒ—ãƒ­ãƒ¼ãƒ",
        "likes_in_partner": ["åˆºæ¿€", "å‰µé€ æ€§", "å†’é™ºå¿ƒ", "çŸ¥çš„åˆºæ¿€", "æŸ”è»Ÿæ€§", "ãƒ¦ãƒ¼ãƒ¢ã‚¢"],
        "dislikes_in_partner": ["é€€å±ˆ", "ä¼çµ±çš„ãªä¾¡å€¤è¦³", "æŸç¸›", "æ„Ÿæƒ…çš„ãªè¦æ±‚", "éè«–ç†çš„"],
        "common_concerns": ["ä¸€è²«æ€§ãŒãªã„", "æ„Ÿæƒ…ãŒå®‰å®šã—ãªã„", "é•·æœŸçš„ãªé–¢ä¿‚ãŒè‹¦æ‰‹"],
        "my_approaches": ["åˆºæ¿€çš„ãªãƒ‡ãƒ¼ãƒˆã‚’ææ¡ˆã™ã‚‹", "å‰µé€ çš„ãªã‚¢ãƒ—ãƒ­ãƒ¼ãƒã‚’ã™ã‚‹", "æŸ”è»Ÿãªé–¢ä¿‚ã‚’ç¯‰ã"],
        "partner_approaches": ["ç›¸æ‰‹ã®å‰µé€ æ€§ã‚’åˆºæ¿€ã™ã‚‹æ–°ã—ã„ä½“é¨“ã‚’ææ¡ˆã™ã‚‹", "ç›¸æ‰‹ã®ãƒ¦ãƒ¼ãƒ¢ã‚¢ã«åˆã‚ã›ãŸæ¥½ã—ã„ä¼šè©±ã‚’ã™ã‚‹", "ç›¸æ‰‹ã®æŸ”è»Ÿæ€§ã‚’æ´»ã‹ã—ãŸå¤‰åŒ–ã«å¯Œã‚“ã é–¢ä¿‚ã‚’ç¯‰ã", "ç›¸æ‰‹ã®å†’é™ºå¿ƒã‚’æº€ãŸã™åˆºæ¿€çš„ãªãƒ‡ãƒ¼ãƒˆã‚’è¨ˆç”»ã™ã‚‹", "ç›¸æ‰‹ã®é©å¿œåŠ›ã«åˆã‚ã›ãŸã‚¢ãƒ—ãƒ­ãƒ¼ãƒã‚’å¿ƒãŒã‘ã‚‹"],
        "ng_behaviors": ["æŸç¸›ã™ã‚‹", "ä¼çµ±çš„ãªä¾¡å€¤è¦³ã‚’å¼·è¦ã™ã‚‹", "æ„Ÿæƒ…çš„ãªè¦æ±‚ã‚’æŠ¼ã—ä»˜ã‘ã‚‹"],
        "partner_ng_behaviors": ["ç›¸æ‰‹ã®å‰µé€ æ€§ã‚’åˆ¶é™ã™ã‚‹", "ç›¸æ‰‹ã®æŸ”è»Ÿæ€§ã‚’ç„¡è¦–ã—ãŸå›ºå®šè¦³å¿µã‚’æŠ¼ã—ä»˜ã‘ã‚‹", "ç›¸æ‰‹ã®å†’é™ºå¿ƒã‚’é˜»å®³ã™ã‚‹", "ç›¸æ‰‹ã®ãƒ¦ãƒ¼ãƒ¢ã‚¢ã‚’å¦å®šã™ã‚‹", "ç›¸æ‰‹ã®å¤‰åŒ–ã‚’å«Œã†"]
    },
    "INFJ": {
        "traits": ["å…±æ„ŸåŠ›", "ç†æƒ³ä¸»ç¾©", "æ´å¯ŸåŠ›", "å‰µé€ æ€§", "çŒ®èº«æ€§", "æ·±ã„æ„›æƒ…", "ç¥ç§˜æ€§"],
        "love_style": "æ·±ã„ç²¾ç¥çš„ãªçµ†ã¨çœŸã®ç†è§£ã‚’æ±‚ã‚ã‚‹ã€‚ç›¸æ‰‹ã®å¿ƒã®å¥¥åº•ã¾ã§ç†è§£ã—ã€ç„¡æ¡ä»¶ã®æ„›æƒ…ã§åŒ…ã¿è¾¼ã‚€é–¢ä¿‚ã‚’é‡è¦–ã™ã‚‹ã€‚ç†æƒ³ä¸»ç¾©çš„ã§ã€å®Œç’§ãªæ„›ã‚’è¿½æ±‚ã™ã‚‹ãŒã€ç¾å®Ÿã¨ã®ãƒãƒ©ãƒ³ã‚¹ã‚‚å¤§åˆ‡ã«ã™ã‚‹ã€‚ç›¸æ‰‹ã®æˆé•·ã‚’ã‚µãƒãƒ¼ãƒˆã—ã€æ·±ã„æ´å¯ŸåŠ›ã§é–¢ä¿‚ã‚’å°ãã€‚",
        "strengths": ["ç›¸æ‰‹ã®æ„Ÿæƒ…ã‚’ç†è§£", "æ·±ã„æ„›æƒ…", "æˆé•·ã‚’ã‚µãƒãƒ¼ãƒˆ", "æ´å¯ŸåŠ›", "å‰µé€ æ€§"],
        "challenges": ["å®Œç’§ä¸»ç¾©", "ç›¸æ‰‹ã®æœŸå¾…ã«å¿œãˆã™ãã‚‹", "æ„Ÿæƒ…çš„ãªç–²åŠ´", "ç¾å®Ÿã¨ã®æŠ˜ã‚Šåˆã„"],
        "advice_style": "æ„Ÿæƒ…çš„ã§å…±æ„Ÿçš„ãªã‚¢ãƒ‰ãƒã‚¤ã‚¹",
        "likes_in_partner": ["æ·±ã„ç†è§£", "æˆé•·æ„æ¬²", "ç†æƒ³ä¸»ç¾©", "å‰µé€ æ€§", "èª å®Ÿã•", "ç²¾ç¥çš„ãªçµ†"],
        "dislikes_in_partner": ["è¡¨é¢çš„ãªé–¢ä¿‚", "éèª å®Ÿ", "æˆé•·æ„æ¬²ã®ãªã„", "ç¾å®Ÿçš„ã™ãã‚‹", "æ„Ÿæƒ…çš„ãªç†è§£ä¸è¶³"],
        "common_concerns": ["ç›¸æ‰‹ãŒè‡ªåˆ†ã®æ·±ã„æ„Ÿæƒ…ã‚’ç†è§£ã—ã¦ãã‚Œãªã„", "å®Œç’§ä¸»ç¾©ã§ç›¸æ‰‹ã‚’è¿½ã„è©°ã‚ã¦ã—ã¾ã†", "æ„Ÿæƒ…çš„ãªç–²åŠ´"],
        "my_approaches": ["æ·±ã„ä¼šè©±ã§å¿ƒã‚’é€šã‚ã›ã‚‹", "ç›¸æ‰‹ã®æˆé•·ã‚’ã‚µãƒãƒ¼ãƒˆã™ã‚‹", "ç²¾ç¥çš„ãªçµ†ã‚’ç¯‰ã"],
        "partner_approaches": ["ç›¸æ‰‹ã®æ·±ã„æ„Ÿæƒ…ã‚’ç†è§£ã—ã€å…±æ„Ÿã‚’ç¤ºã™", "ç›¸æ‰‹ã®ç†æƒ³ä¸»ç¾©ã«å¯„ã‚Šæ·»ã„ã€ã‚µãƒãƒ¼ãƒˆã™ã‚‹", "ç›¸æ‰‹ã®æ´å¯ŸåŠ›ã«æ•¬æ„ã‚’æ‰•ã„ã€æ·±ã„ä¼šè©±ã‚’å¿ƒãŒã‘ã‚‹", "ç›¸æ‰‹ã®å‰µé€ æ€§ã‚’åˆºæ¿€ã—ã€ç²¾ç¥çš„ãªçµ†ã‚’æ·±ã‚ã‚‹", "ç›¸æ‰‹ã®çŒ®èº«æ€§ã«æ„Ÿè¬ã—ã€åŒã˜æ„›æƒ…ã§è¿”ã™"],
        "ng_behaviors": ["è¡¨é¢çš„ãªé–¢ä¿‚ã‚’æ±‚ã‚ã‚‹", "éèª å®Ÿãªæ…‹åº¦", "æ„Ÿæƒ…çš„ãªç†è§£ã‚’æ€ ã‚‹"],
        "partner_ng_behaviors": ["ç›¸æ‰‹ã®æ·±ã„æ„Ÿæƒ…ã‚’è»½è¦–ã™ã‚‹", "ç›¸æ‰‹ã®ç†æƒ³ä¸»ç¾©ã‚’å¦å®šã™ã‚‹", "ç›¸æ‰‹ã®æ´å¯ŸåŠ›ã‚’ç„¡è¦–ã™ã‚‹", "ç›¸æ‰‹ã®çŒ®èº«æ€§ã‚’å½“ãŸã‚Šå‰ã¨æ€ã†", "ç›¸æ‰‹ã®ç²¾ç¥çš„ãªçµ†ã‚’è»½è¦–ã™ã‚‹"]
    },
    "INFP": {
        "traits": ["ç†æƒ³ä¸»ç¾©", "å…±æ„ŸåŠ›", "å‰µé€ æ€§", "ä¾¡å€¤è¦³é‡è¦–", "æ·±ã„æ„Ÿæƒ…", "æŸ”è»Ÿæ€§", "èŠ¸è¡“æ€§"],
        "love_style": "çœŸå®Ÿã®æ„›ã¨æ·±ã„æ„Ÿæƒ…çš„ãªçµ†ã‚’æ±‚ã‚ã‚‹ã€‚ç›¸æ‰‹ã®å€‹æ€§ã‚’ç„¡æ¡ä»¶ã§å—ã‘å…¥ã‚Œã€è©©çš„ã§ç¾ã—ã„æ„›æƒ…è¡¨ç¾ã‚’å¿ƒãŒã‘ã‚‹ã€‚ä¾¡å€¤è¦³ã®ä¸€è‡´ã‚’é‡è¦–ã—ã€ãŠäº’ã„ã®å¿ƒã®å¥¥åº•ã¾ã§ç†è§£ã—åˆã†é–¢ä¿‚ã‚’å¤§åˆ‡ã«ã™ã‚‹ã€‚å‰µé€ çš„ã§èŠ¸è¡“çš„ãªã‚¢ãƒ—ãƒ­ãƒ¼ãƒã‚’å¥½ã¿ã€æ„Ÿæƒ…ã®èµ·ä¼ãŒè±Šã‹ã€‚",
        "strengths": ["ç„¡æ¡ä»¶ã®æ„›æƒ…", "å‰µé€ æ€§", "ç›¸æ‰‹ã®å€‹æ€§ã‚’å°Šé‡", "å…±æ„ŸåŠ›", "æ·±ã„æ„Ÿæƒ…"],
        "challenges": ["ç¾å®Ÿã¨ã®æŠ˜ã‚Šåˆã„", "æ„Ÿæƒ…ã®èµ·ä¼", "ç›¸æ‰‹ã®æœŸå¾…ã«å¿œãˆã™ãã‚‹", "æ±ºæ–­åŠ›"],
        "advice_style": "è©©çš„ã§æ„Ÿæƒ…çš„ãªã‚¢ãƒ‰ãƒã‚¤ã‚¹",
        "likes_in_partner": ["æ·±ã„æ„Ÿæƒ…", "å‰µé€ æ€§", "å€‹æ€§", "ç†æƒ³ä¸»ç¾©", "å…±æ„ŸåŠ›", "ä¾¡å€¤è¦³ã®ä¸€è‡´"],
        "dislikes_in_partner": ["è¡¨é¢çš„ãªé–¢ä¿‚", "éå‰µé€ çš„", "å€‹æ€§ã‚’å°Šé‡ã—ãªã„", "ç¾å®Ÿçš„ã™ãã‚‹", "æ„Ÿæƒ…çš„ãªç†è§£ä¸è¶³"],
        "common_concerns": ["ç¾å®Ÿã¨ã®æŠ˜ã‚Šåˆã„ãŒã¤ã‹ãªã„", "æ„Ÿæƒ…ã®èµ·ä¼ãŒæ¿€ã—ã„", "ç›¸æ‰‹ã®æœŸå¾…ã«å¿œãˆã™ãã‚‹"],
        "my_approaches": ["æ·±ã„æ„Ÿæƒ…ã‚’å…±æœ‰ã™ã‚‹", "å‰µé€ çš„ãªã‚¢ãƒ—ãƒ­ãƒ¼ãƒã‚’ã™ã‚‹", "å€‹æ€§ã‚’å°Šé‡ã™ã‚‹"],
        "partner_approaches": ["ç›¸æ‰‹ã®æ·±ã„æ„Ÿæƒ…ã‚’å—ã‘å…¥ã‚Œã€å…±æ„Ÿã‚’ç¤ºã™", "ç›¸æ‰‹ã®å‰µé€ æ€§ã‚’åˆºæ¿€ã—ã€èŠ¸è¡“çš„ãªä½“é¨“ã‚’å…±æœ‰ã™ã‚‹", "ç›¸æ‰‹ã®å€‹æ€§ã‚’ç„¡æ¡ä»¶ã§å—ã‘å…¥ã‚Œã‚‹", "ç›¸æ‰‹ã®ç†æƒ³ä¸»ç¾©ã«ç†è§£ã‚’ç¤ºã—ã€ã‚µãƒãƒ¼ãƒˆã™ã‚‹", "ç›¸æ‰‹ã®ä¾¡å€¤è¦³ã‚’å°Šé‡ã—ã€ä¸€è‡´ç‚¹ã‚’è¦‹ã¤ã‘ã‚‹"],
        "ng_behaviors": ["è¡¨é¢çš„ãªé–¢ä¿‚ã‚’æ±‚ã‚ã‚‹", "å€‹æ€§ã‚’å°Šé‡ã—ãªã„", "æ„Ÿæƒ…çš„ãªç†è§£ã‚’æ€ ã‚‹"],
        "partner_ng_behaviors": ["ç›¸æ‰‹ã®æ·±ã„æ„Ÿæƒ…ã‚’è»½è¦–ã™ã‚‹", "ç›¸æ‰‹ã®å‰µé€ æ€§ã‚’å¦å®šã™ã‚‹", "ç›¸æ‰‹ã®å€‹æ€§ã‚’å¦å®šã™ã‚‹", "ç›¸æ‰‹ã®ç†æƒ³ä¸»ç¾©ã‚’ç¾å®Ÿçš„ã™ãã‚‹æ…‹åº¦ã§å¦å®šã™ã‚‹", "ç›¸æ‰‹ã®ä¾¡å€¤è¦³ã‚’è»½è¦–ã™ã‚‹"]
    },
    "ENFJ": {
        "traits": ["å…±æ„ŸåŠ›", "ãƒªãƒ¼ãƒ€ãƒ¼ã‚·ãƒƒãƒ—", "å”èª¿æ€§", "çŒ®èº«æ€§", "ç¤¾äº¤æ€§", "æˆé•·ã‚µãƒãƒ¼ãƒˆ", "èª¿å’Œé‡è¦–"],
        "love_style": "ãƒ‘ãƒ¼ãƒˆãƒŠãƒ¼ã®æˆé•·ã¨å¹¸ç¦ã‚’æœ€å„ªå…ˆã«ã™ã‚‹ã€‚ç›¸æ‰‹ã‚’ã‚µãƒãƒ¼ãƒˆã—ã€èª¿å’Œã®ã‚ã‚‹é–¢ä¿‚ã‚’ç¯‰ãã“ã¨ã«æƒ…ç†±ã‚’æ³¨ãã€‚ã‚³ãƒŸãƒ¥ãƒ‹ã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã‚’é‡è¦–ã—ã€ãŠäº’ã„ã®æ°—æŒã¡ã‚’ç†è§£ã—åˆã†é–¢ä¿‚ã‚’å¤§åˆ‡ã«ã™ã‚‹ã€‚ç›¸æ‰‹ã®å¯èƒ½æ€§ã‚’ä¿¡ã˜ã€å…·ä½“çš„ãªã‚µãƒãƒ¼ãƒˆã§é–¢ä¿‚ã‚’ç™ºå±•ã•ã›ã‚‹ã€‚",
        "strengths": ["ç›¸æ‰‹ã‚’ã‚µãƒãƒ¼ãƒˆ", "ã‚³ãƒŸãƒ¥ãƒ‹ã‚±ãƒ¼ã‚·ãƒ§ãƒ³", "èª¿å’Œã‚’å‰µã‚‹", "æˆé•·ã‚µãƒãƒ¼ãƒˆ", "å…±æ„ŸåŠ›"],
        "challenges": ["è‡ªåˆ†ã®æ„Ÿæƒ…ã‚’å¾Œå›ã—", "ç›¸æ‰‹ã«ä¾å­˜ã•ã‚Œã™ãã‚‹", "å®Œç’§ä¸»ç¾©", "æ„Ÿæƒ…çš„ãªç–²åŠ´"],
        "advice_style": "ã‚µãƒãƒ¼ãƒˆçš„ã§åŠ±ã¾ã—ã®ã‚¢ãƒ‰ãƒã‚¤ã‚¹",
        "likes_in_partner": ["æˆé•·æ„æ¬²", "å”èª¿æ€§", "æ„Ÿè¬ã®æ°—æŒã¡", "ã‚³ãƒŸãƒ¥ãƒ‹ã‚±ãƒ¼ã‚·ãƒ§ãƒ³", "èª¿å’Œ", "èª å®Ÿã•"],
        "dislikes_in_partner": ["æˆé•·æ„æ¬²ã®ãªã„", "éå”èª¿çš„", "æ„Ÿè¬ã®æ°—æŒã¡ãŒãªã„", "ã‚³ãƒŸãƒ¥ãƒ‹ã‚±ãƒ¼ã‚·ãƒ§ãƒ³ä¸è¶³", "éèª å®Ÿ"],
        "common_concerns": ["ç›¸æ‰‹ã«ä¾å­˜ã•ã‚Œã™ãã‚‹", "è‡ªåˆ†ã®æ„Ÿæƒ…ã‚’å¾Œå›ã—ã«ã—ã¦ã—ã¾ã†", "å®Œç’§ä¸»ç¾©"],
        "my_approaches": ["ç›¸æ‰‹ã®æˆé•·ã‚’ã‚µãƒãƒ¼ãƒˆã™ã‚‹", "èª¿å’Œã‚’å‰µã‚‹", "ã‚³ãƒŸãƒ¥ãƒ‹ã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã‚’å¤§åˆ‡ã«ã™ã‚‹"],
        "partner_approaches": ["ç›¸æ‰‹ã®ã‚µãƒãƒ¼ãƒˆã«æ„Ÿè¬ã—ã€åŒã˜æ„›æƒ…ã§è¿”ã™", "ç›¸æ‰‹ã®èª¿å’Œã‚’é‡è¦–ã—ãŸè¡Œå‹•ã‚’å¿ƒãŒã‘ã‚‹", "ç›¸æ‰‹ã®ã‚³ãƒŸãƒ¥ãƒ‹ã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã«ç©æ¥µçš„ã«å¿œãˆã‚‹", "ç›¸æ‰‹ã®æˆé•·ã‚µãƒãƒ¼ãƒˆã«å”åŠ›ã—ã€è‡ªåˆ†ã‚‚æˆé•·ã™ã‚‹", "ç›¸æ‰‹ã®å…±æ„ŸåŠ›ã«ä¿¡é ¼ã‚’ç½®ãã€å¿ƒã‚’é–‹ã"],
        "ng_behaviors": ["æˆé•·æ„æ¬²ã‚’é˜»å®³ã™ã‚‹", "éå”èª¿çš„ãªæ…‹åº¦", "æ„Ÿè¬ã®æ°—æŒã¡ã‚’è¡¨ã•ãªã„"],
        "partner_ng_behaviors": ["ç›¸æ‰‹ã®ã‚µãƒãƒ¼ãƒˆã‚’å½“ãŸã‚Šå‰ã¨æ€ã†", "ç›¸æ‰‹ã®èª¿å’Œã‚’ä¹±ã™", "ç›¸æ‰‹ã®ã‚³ãƒŸãƒ¥ãƒ‹ã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã‚’ç„¡è¦–ã™ã‚‹", "ç›¸æ‰‹ã®æˆé•·ã‚µãƒãƒ¼ãƒˆã‚’è»½è¦–ã™ã‚‹", "ç›¸æ‰‹ã®å…±æ„ŸåŠ›ã‚’å¦å®šã™ã‚‹"]
    },
    "ENFP": {
        "traits": ["ç†±æ„", "å‰µé€ æ€§", "é©å¿œåŠ›", "å…±æ„ŸåŠ›", "ç¤¾äº¤æ€§", "å†’é™ºå¿ƒ", "æ¥½è¦³æ€§"],
        "love_style": "æƒ…ç†±çš„ã§å†’é™ºçš„ãªæ„›ã‚’æ±‚ã‚ã‚‹ã€‚æ–°ã—ã„ä½“é¨“ã¨æ„Ÿæƒ…ã‚’å…±æœ‰ã—ã€ãŠäº’ã„ã‚’æ¥½ã—ã¾ã›åˆã†é–¢ä¿‚ã‚’å¤§åˆ‡ã«ã™ã‚‹ã€‚æ¥½è¦³çš„ã§å‰å‘ããªã‚¢ãƒ—ãƒ­ãƒ¼ãƒã‚’å¿ƒãŒã‘ã€ç›¸æ‰‹ã®å¯èƒ½æ€§ã‚’ä¿¡ã˜ã¦ã‚µãƒãƒ¼ãƒˆã™ã‚‹ã€‚æ„Ÿæƒ…è¡¨ç¾ãŒè±Šã‹ã§ã€å‰µé€ çš„ã§é­…åŠ›çš„ãªæ„›æƒ…è¡¨ç¾ã‚’å¾—æ„ã¨ã™ã‚‹ã€‚",
        "strengths": ["ç›¸æ‰‹ã‚’æ¥½ã—ã¾ã›ã‚‹", "æ·±ã„æ„›æƒ…", "æ–°ã—ã„ä½“é¨“", "å‰µé€ æ€§", "å…±æ„ŸåŠ›"],
        "challenges": ["ä¸€è²«æ€§", "æ„Ÿæƒ…ã®èµ·ä¼", "é•·æœŸçš„ãªè¨ˆç”»", "ç¾å®Ÿã¨ã®æŠ˜ã‚Šåˆã„"],
        "advice_style": "æƒ…ç†±çš„ã§å‰µé€ çš„ãªã‚¢ãƒ‰ãƒã‚¤ã‚¹",
        "likes_in_partner": ["å†’é™ºå¿ƒ", "å‰µé€ æ€§", "æ¥½è¦³æ€§", "æ–°ã—ã„ä½“é¨“", "æ·±ã„æ„Ÿæƒ…", "æŸ”è»Ÿæ€§"],
        "dislikes_in_partner": ["é€€å±ˆ", "éå‰µé€ çš„", "æ‚²è¦³çš„", "å¤‰åŒ–ã‚’å«Œã†", "æ„Ÿæƒ…çš„ãªç†è§£ä¸è¶³"],
        "common_concerns": ["ä¸€è²«æ€§ãŒãªã„", "æ„Ÿæƒ…ã®èµ·ä¼ãŒæ¿€ã—ã„", "é•·æœŸçš„ãªè¨ˆç”»ãŒè‹¦æ‰‹"],
        "my_approaches": ["å†’é™ºçš„ãªãƒ‡ãƒ¼ãƒˆã‚’ææ¡ˆã™ã‚‹", "å‰µé€ çš„ãªã‚¢ãƒ—ãƒ­ãƒ¼ãƒã‚’ã™ã‚‹", "æ–°ã—ã„ä½“é¨“ã‚’å…±æœ‰ã™ã‚‹"],
        "partner_approaches": ["ç›¸æ‰‹ã®æ¥½è¦³æ€§ã«åˆã‚ã›ãŸå‰å‘ããªæ…‹åº¦ã‚’å¿ƒãŒã‘ã‚‹", "ç›¸æ‰‹ã®å‰µé€ æ€§ã‚’åˆºæ¿€ã—ã€æ–°ã—ã„ä½“é¨“ã‚’ææ¡ˆã™ã‚‹", "ç›¸æ‰‹ã®å†’é™ºå¿ƒã‚’æº€ãŸã™åˆºæ¿€çš„ãªãƒ‡ãƒ¼ãƒˆã‚’è¨ˆç”»ã™ã‚‹", "ç›¸æ‰‹ã®æ„Ÿæƒ…è¡¨ç¾ã«å…±æ„Ÿã—ã€åŒã˜ç†±æ„ã§è¿”ã™", "ç›¸æ‰‹ã®æŸ”è»Ÿæ€§ã‚’æ´»ã‹ã—ãŸã‚¢ãƒ—ãƒ­ãƒ¼ãƒã‚’å¿ƒãŒã‘ã‚‹"],
        "ng_behaviors": ["é€€å±ˆãªé–¢ä¿‚ã‚’æ±‚ã‚ã‚‹", "å¤‰åŒ–ã‚’å«Œã†", "æ„Ÿæƒ…çš„ãªç†è§£ã‚’æ€ ã‚‹"],
        "partner_ng_behaviors": ["ç›¸æ‰‹ã®æ¥½è¦³æ€§ã‚’å¦å®šã™ã‚‹", "ç›¸æ‰‹ã®å‰µé€ æ€§ã‚’åˆ¶é™ã™ã‚‹", "ç›¸æ‰‹ã®å†’é™ºå¿ƒã‚’é˜»å®³ã™ã‚‹", "ç›¸æ‰‹ã®æ„Ÿæƒ…è¡¨ç¾ã‚’è»½è¦–ã™ã‚‹", "ç›¸æ‰‹ã®æŸ”è»Ÿæ€§ã‚’ç„¡è¦–ã™ã‚‹"]
    },
    "ISTJ": {
        "traits": ["è²¬ä»»æ„Ÿ", "å®Ÿç”¨æ€§", "ä¿¡é ¼æ€§", "ä¼çµ±é‡è¦–", "çµ„ç¹”åŠ›", "ä¸€è²«æ€§", "åŠ¹ç‡æ€§"],
        "love_style": "å®‰å®šã—ãŸä¿¡é ¼ã§ãã‚‹é–¢ä¿‚ã‚’æ±‚ã‚ã‚‹ã€‚ä¼çµ±çš„ãªä¾¡å€¤è¦³ã‚’é‡è¦–ã—ã€å®Ÿç”¨çš„ã§å…·ä½“çš„ãªæ„›æƒ…è¡¨ç¾ã‚’å¿ƒãŒã‘ã‚‹ã€‚è²¬ä»»æ„ŸãŒå¼·ãã€ç›¸æ‰‹ã‚’å®ˆã‚Šæ”¯ãˆã‚‹é–¢ä¿‚ã‚’å¤§åˆ‡ã«ã™ã‚‹ã€‚ä¸€è²«æ€§ãŒã‚ã‚Šã€é•·æœŸçš„ã§å®‰å®šã—ãŸé–¢ä¿‚ã‚’æ§‹ç¯‰ã™ã‚‹ã“ã¨ã‚’é‡è¦–ã™ã‚‹ã€‚",
        "strengths": ["ä¿¡é ¼æ€§", "å®Ÿç”¨çš„ãªã‚µãƒãƒ¼ãƒˆ", "ä¸€è²«æ€§", "è²¬ä»»æ„Ÿ", "åŠ¹ç‡æ€§"],
        "challenges": ["æ„Ÿæƒ…è¡¨ç¾", "æŸ”è»Ÿæ€§", "è‡ªç™ºæ€§", "å¤‰åŒ–ã¸ã®å¯¾å¿œ"],
        "advice_style": "å®Ÿç”¨çš„ã§å…·ä½“çš„ãªã‚¢ãƒ‰ãƒã‚¤ã‚¹",
        "likes_in_partner": ["ä¿¡é ¼æ€§", "è²¬ä»»æ„Ÿ", "åŠ¹ç‡æ€§", "ä¼çµ±çš„ãªä¾¡å€¤è¦³", "ä¸€è²«æ€§", "å®Ÿç”¨æ€§"],
        "dislikes_in_partner": ["éåŠ¹ç‡", "éè²¬ä»»çš„", "å¤‰åŒ–ã‚’å¥½ã‚€", "æ„Ÿæƒ…çš„ãªè¦æ±‚", "éå®Ÿç”¨çš„"],
        "common_concerns": ["æ„Ÿæƒ…è¡¨ç¾ãŒè‹¦æ‰‹", "æŸ”è»Ÿæ€§ãŒãªã„", "è‡ªç™ºæ€§ãŒãªã„"],
        "my_approaches": ["ä¿¡é ¼ã§ãã‚‹é–¢ä¿‚ã‚’ç¯‰ã", "å®Ÿç”¨çš„ãªã‚µãƒãƒ¼ãƒˆã‚’ã™ã‚‹", "ä¸€è²«æ€§ã‚’ä¿ã¤"],
        "partner_approaches": ["ç›¸æ‰‹ã®ä¿¡é ¼æ€§ã«ä¿¡é ¼ã‚’ç½®ãã€å®‰å¿ƒæ„Ÿã‚’ä¸ãˆã‚‹", "ç›¸æ‰‹ã®è²¬ä»»æ„Ÿã«æ•¬æ„ã‚’æ‰•ã„ã€å”åŠ›ã™ã‚‹", "ç›¸æ‰‹ã®åŠ¹ç‡æ€§ã«åˆã‚ã›ãŸè¡Œå‹•ã‚’å¿ƒãŒã‘ã‚‹", "ç›¸æ‰‹ã®ä¼çµ±çš„ãªä¾¡å€¤è¦³ã‚’å°Šé‡ã™ã‚‹", "ç›¸æ‰‹ã®ä¸€è²«æ€§ã«åˆã‚ã›ãŸå®‰å®šã—ãŸé–¢ä¿‚ã‚’ç¯‰ã"],
        "ng_behaviors": ["éåŠ¹ç‡ãªè¡Œå‹•ã‚’å¼·è¦ã™ã‚‹", "éè²¬ä»»çš„ãªæ…‹åº¦", "å¤‰åŒ–ã‚’å¼·è¦ã™ã‚‹"],
        "partner_ng_behaviors": ["ç›¸æ‰‹ã®ä¿¡é ¼æ€§ã‚’ç–‘ã†", "ç›¸æ‰‹ã®è²¬ä»»æ„Ÿã‚’è»½è¦–ã™ã‚‹", "ç›¸æ‰‹ã®åŠ¹ç‡æ€§ã‚’ç„¡è¦–ã™ã‚‹", "ç›¸æ‰‹ã®ä¼çµ±çš„ãªä¾¡å€¤è¦³ã‚’å¦å®šã™ã‚‹", "ç›¸æ‰‹ã®ä¸€è²«æ€§ã‚’ä¹±ã™"]
    },
    "ISFJ": {
        "traits": ["çŒ®èº«æ€§", "å®Ÿç”¨æ€§", "å…±æ„ŸåŠ›", "è²¬ä»»æ„Ÿ", "æ€ã„ã‚„ã‚Š", "èª¿å’Œé‡è¦–", "ä¼çµ±é‡è¦–"],
        "love_style": "ç›¸æ‰‹ã‚’å¤§åˆ‡ã«ã—ã€å®‰å®šã—ãŸé–¢ä¿‚ã‚’ç¯‰ãã€‚æ€ã„ã‚„ã‚Šã¨çŒ®èº«æ€§ã‚’æ­¦å™¨ã«ã€ç›¸æ‰‹ã®å¹¸ã›ã‚’æœ€å„ªå…ˆã«ã™ã‚‹é–¢ä¿‚ã‚’é‡è¦–ã™ã‚‹ã€‚å®Ÿç”¨çš„ãªã‚µãƒãƒ¼ãƒˆã‚’æä¾›ã—ã€èª¿å’Œã®ã‚ã‚‹é–¢ä¿‚ã‚’å¿ƒãŒã‘ã‚‹ã€‚ä¼çµ±çš„ãªä¾¡å€¤è¦³ã‚’å¤§åˆ‡ã«ã—ã€é•·æœŸçš„ã§å®‰å®šã—ãŸæ„›æƒ…ã‚’è¡¨ç¾ã™ã‚‹ã€‚",
        "strengths": ["æ€ã„ã‚„ã‚Š", "å®Ÿç”¨çš„ãªã‚µãƒãƒ¼ãƒˆ", "ä¿¡é ¼æ€§", "çŒ®èº«æ€§", "èª¿å’Œ"],
        "challenges": ["è‡ªåˆ†ã®æ„Ÿæƒ…ã‚’è¡¨ç¾", "ç›¸æ‰‹ã«ä¾å­˜ã•ã‚Œã™ãã‚‹", "å¤‰åŒ–ã¸ã®å¯¾å¿œ", "è‡ªå·±ä¸»å¼µ"],
        "advice_style": "æ€ã„ã‚„ã‚Šã®ã‚ã‚‹å®Ÿè·µçš„ãªã‚¢ãƒ‰ãƒã‚¤ã‚¹",
        "likes_in_partner": ["æ„Ÿè¬ã®æ°—æŒã¡", "èª¿å’Œ", "ä¼çµ±çš„ãªä¾¡å€¤è¦³", "æ€ã„ã‚„ã‚Š", "è²¬ä»»æ„Ÿ", "å®‰å®š"],
        "dislikes_in_partner": ["æ„Ÿè¬ã®æ°—æŒã¡ãŒãªã„", "éèª¿å’Œçš„", "ä¼çµ±ã‚’è»½è¦–ã™ã‚‹", "éæ€ã„ã‚„ã‚Š", "éè²¬ä»»çš„"],
        "common_concerns": ["ç›¸æ‰‹ã«ä¾å­˜ã•ã‚Œã™ãã‚‹", "è‡ªåˆ†ã®æ„Ÿæƒ…ã‚’è¡¨ç¾ã§ããªã„", "è‡ªå·±ä¸»å¼µãŒã§ããªã„"],
        "my_approaches": ["æ€ã„ã‚„ã‚Šã®ã‚ã‚‹ã‚µãƒãƒ¼ãƒˆã‚’ã™ã‚‹", "èª¿å’Œã‚’å‰µã‚‹", "æ„Ÿè¬ã®æ°—æŒã¡ã‚’è¡¨ã™"],
        "partner_approaches": ["ç›¸æ‰‹ã®æ€ã„ã‚„ã‚Šã«æ„Ÿè¬ã—ã€åŒã˜æ„›æƒ…ã§è¿”ã™", "ç›¸æ‰‹ã®èª¿å’Œã‚’é‡è¦–ã—ãŸè¡Œå‹•ã‚’å¿ƒãŒã‘ã‚‹", "ç›¸æ‰‹ã®çŒ®èº«æ€§ã«æ•¬æ„ã‚’æ‰•ã„ã€å”åŠ›ã™ã‚‹", "ç›¸æ‰‹ã®ä¼çµ±çš„ãªä¾¡å€¤è¦³ã‚’å°Šé‡ã™ã‚‹", "ç›¸æ‰‹ã®å®Ÿç”¨çš„ãªã‚µãƒãƒ¼ãƒˆã«æ„Ÿè¬ã—ã€å”åŠ›ã™ã‚‹"],
        "ng_behaviors": ["æ„Ÿè¬ã®æ°—æŒã¡ã‚’è¡¨ã•ãªã„", "éèª¿å’Œçš„ãªæ…‹åº¦", "ä¼çµ±ã‚’è»½è¦–ã™ã‚‹"],
        "partner_ng_behaviors": ["ç›¸æ‰‹ã®æ€ã„ã‚„ã‚Šã‚’å½“ãŸã‚Šå‰ã¨æ€ã†", "ç›¸æ‰‹ã®èª¿å’Œã‚’ä¹±ã™", "ç›¸æ‰‹ã®çŒ®èº«æ€§ã‚’è»½è¦–ã™ã‚‹", "ç›¸æ‰‹ã®ä¼çµ±çš„ãªä¾¡å€¤è¦³ã‚’å¦å®šã™ã‚‹", "ç›¸æ‰‹ã®å®Ÿç”¨çš„ãªã‚µãƒãƒ¼ãƒˆã‚’è»½è¦–ã™ã‚‹"]
    },
    "ESTJ": {
        "traits": ["çµ„ç¹”åŠ›", "æ±ºæ–­åŠ›", "å®Ÿç”¨æ€§", "è²¬ä»»æ„Ÿ", "åŠ¹ç‡æ€§", "ãƒªãƒ¼ãƒ€ãƒ¼ã‚·ãƒƒãƒ—", "ä¼çµ±é‡è¦–"],
        "love_style": "æ˜ç¢ºãªå½¹å‰²åˆ†æ‹…ã¨åŠ¹ç‡çš„ãªé–¢ä¿‚ã‚’æ±‚ã‚ã‚‹ã€‚ãƒªãƒ¼ãƒ€ãƒ¼ã‚·ãƒƒãƒ—ã‚’ç™ºæ®ã—ã€å®Ÿç”¨çš„ã§æ§‹é€ åŒ–ã•ã‚ŒãŸæ„›æƒ…è¡¨ç¾ã‚’å¿ƒãŒã‘ã‚‹ã€‚ä¼çµ±çš„ãªä¾¡å€¤è¦³ã‚’é‡è¦–ã—ã€è²¬ä»»æ„Ÿã¨åŠ¹ç‡æ€§ã§é–¢ä¿‚ã‚’ç™ºå±•ã•ã›ã‚‹ã€‚ç›¸æ‰‹ã®æˆé•·ã‚’ã‚µãƒãƒ¼ãƒˆã—ã€æ˜ç¢ºãªç›®æ¨™ã‚’æŒã£ãŸé–¢ä¿‚ã‚’æ§‹ç¯‰ã™ã‚‹ã€‚",
        "strengths": ["ãƒªãƒ¼ãƒ€ãƒ¼ã‚·ãƒƒãƒ—", "å®Ÿç”¨çš„ãªã‚µãƒãƒ¼ãƒˆ", "ä¿¡é ¼æ€§", "åŠ¹ç‡æ€§", "çµ„ç¹”åŠ›"],
        "challenges": ["æ„Ÿæƒ…çš„ãªæŸ”è»Ÿæ€§", "ç›¸æ‰‹ã®æ„Ÿæƒ…ã‚’ç†è§£", "æ”¯é…çš„ã«ãªã‚ŠãŒã¡", "å…±æ„ŸåŠ›"],
        "advice_style": "æ§‹é€ åŒ–ã•ã‚ŒãŸå®Ÿè·µçš„ãªã‚¢ãƒ‰ãƒã‚¤ã‚¹",
        "likes_in_partner": ["åŠ¹ç‡æ€§", "è²¬ä»»æ„Ÿ", "çµ„ç¹”åŠ›", "ä¼çµ±çš„ãªä¾¡å€¤è¦³", "æ˜ç¢ºãªå½¹å‰²åˆ†æ‹…", "å®Ÿç”¨æ€§"],
        "dislikes_in_partner": ["éåŠ¹ç‡", "éè²¬ä»»çš„", "ç„¡è¨ˆç”»", "æ„Ÿæƒ…çš„ãªè¦æ±‚", "éå®Ÿç”¨çš„"],
        "common_concerns": ["ç›¸æ‰‹ãŒè‡ªåˆ†ã®ãƒšãƒ¼ã‚¹ã«ã¤ã„ã¦ã„ã‘ãªã„", "æ”¯é…çš„ã«ãªã£ã¦ã—ã¾ã†", "æ„Ÿæƒ…è¡¨ç¾ãŒè‹¦æ‰‹"],
        "my_approaches": ["åŠ¹ç‡çš„ãªé–¢ä¿‚ã‚’ç¯‰ã", "æ˜ç¢ºãªå½¹å‰²åˆ†æ‹…ã‚’ã™ã‚‹", "å®Ÿç”¨çš„ãªã‚µãƒãƒ¼ãƒˆã‚’ã™ã‚‹"],
        "partner_approaches": ["ç›¸æ‰‹ã®ãƒªãƒ¼ãƒ€ãƒ¼ã‚·ãƒƒãƒ—ã‚’å°Šé‡ã—ã€ã‚µãƒãƒ¼ãƒˆã™ã‚‹", "ç›¸æ‰‹ã®åŠ¹ç‡æ€§ã«åˆã‚ã›ãŸè¡Œå‹•ã‚’å¿ƒãŒã‘ã‚‹", "ç›¸æ‰‹ã®çµ„ç¹”åŠ›ã«å”åŠ›ã—ã€å½¹å‰²åˆ†æ‹…ã‚’æ˜ç¢ºã«ã™ã‚‹", "ç›¸æ‰‹ã®è²¬ä»»æ„Ÿã«ä¿¡é ¼ã‚’ç½®ãã€å”åŠ›ã™ã‚‹", "ç›¸æ‰‹ã®ä¼çµ±çš„ãªä¾¡å€¤è¦³ã‚’å°Šé‡ã™ã‚‹"],
        "ng_behaviors": ["éåŠ¹ç‡ãªè¡Œå‹•ã‚’å¼·è¦ã™ã‚‹", "éè²¬ä»»çš„ãªæ…‹åº¦", "ç„¡è¨ˆç”»ãªè¡Œå‹•ã‚’å¼·è¦ã™ã‚‹"],
        "partner_ng_behaviors": ["ç›¸æ‰‹ã®ãƒªãƒ¼ãƒ€ãƒ¼ã‚·ãƒƒãƒ—ã‚’å¦å®šã™ã‚‹", "ç›¸æ‰‹ã®åŠ¹ç‡æ€§ã‚’ç„¡è¦–ã™ã‚‹", "ç›¸æ‰‹ã®çµ„ç¹”åŠ›ã‚’è»½è¦–ã™ã‚‹", "ç›¸æ‰‹ã®è²¬ä»»æ„Ÿã‚’ç–‘ã†", "ç›¸æ‰‹ã®ä¼çµ±çš„ãªä¾¡å€¤è¦³ã‚’å¦å®šã™ã‚‹"]
    },
    "ESFJ": {
        "traits": ["å”èª¿æ€§", "å…±æ„ŸåŠ›", "è²¬ä»»æ„Ÿ", "ç¤¾äº¤æ€§", "æ€ã„ã‚„ã‚Š", "èª¿å’Œé‡è¦–", "çŒ®èº«æ€§"],
        "love_style": "èª¿å’Œã®ã‚ã‚‹é–¢ä¿‚ã¨ç›¸æ‰‹ã®å¹¸ç¦ã‚’é‡è¦–ã™ã‚‹ã€‚ç¤¾äº¤çš„ã§æ€ã„ã‚„ã‚ŠãŒã‚ã‚Šã€ãŠäº’ã„ã‚’æ”¯ãˆåˆã†é–¢ä¿‚ã‚’å¤§åˆ‡ã«ã™ã‚‹ã€‚ã‚³ãƒŸãƒ¥ãƒ‹ã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã‚’é‡è¦–ã—ã€èª¿å’Œã®ã‚ã‚‹é–¢ä¿‚ã‚’å¿ƒãŒã‘ã‚‹ã€‚ç›¸æ‰‹ã®æ°—æŒã¡ã‚’ç†è§£ã—ã€å…·ä½“çš„ãªã‚µãƒãƒ¼ãƒˆã§é–¢ä¿‚ã‚’ç™ºå±•ã•ã›ã‚‹ã€‚",
        "strengths": ["æ€ã„ã‚„ã‚Š", "ã‚³ãƒŸãƒ¥ãƒ‹ã‚±ãƒ¼ã‚·ãƒ§ãƒ³", "èª¿å’Œã‚’å‰µã‚‹", "çŒ®èº«æ€§", "ç¤¾äº¤æ€§"],
        "challenges": ["ç›¸æ‰‹ã®æœŸå¾…ã«å¿œãˆã™ãã‚‹", "è‡ªåˆ†ã®æ„Ÿæƒ…ã‚’å¾Œå›ã—", "å¤‰åŒ–ã¸ã®å¯¾å¿œ", "æ„Ÿæƒ…çš„ãªç–²åŠ´"],
        "advice_style": "èª¿å’Œçš„ã§ã‚µãƒãƒ¼ãƒˆçš„ãªã‚¢ãƒ‰ãƒã‚¤ã‚¹",
        "likes_in_partner": ["æ„Ÿè¬ã®æ°—æŒã¡", "èª¿å’Œ", "ç¤¾äº¤æ€§", "æ€ã„ã‚„ã‚Š", "å”èª¿æ€§", "è²¬ä»»æ„Ÿ"],
        "dislikes_in_partner": ["æ„Ÿè¬ã®æ°—æŒã¡ãŒãªã„", "éèª¿å’Œçš„", "éç¤¾äº¤çš„", "éæ€ã„ã‚„ã‚Š", "éå”èª¿çš„"],
        "common_concerns": ["ç›¸æ‰‹ã®æœŸå¾…ã«å¿œãˆã™ãã‚‹", "è‡ªåˆ†ã®æ„Ÿæƒ…ã‚’å¾Œå›ã—ã«ã—ã¦ã—ã¾ã†", "æ„Ÿæƒ…çš„ãªç–²åŠ´"],
        "my_approaches": ["èª¿å’Œã‚’å‰µã‚‹", "æ„Ÿè¬ã®æ°—æŒã¡ã‚’è¡¨ã™", "ã‚³ãƒŸãƒ¥ãƒ‹ã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã‚’å¤§åˆ‡ã«ã™ã‚‹"],
        "partner_approaches": ["ç›¸æ‰‹ã®æ€ã„ã‚„ã‚Šã«æ„Ÿè¬ã—ã€åŒã˜æ„›æƒ…ã§è¿”ã™", "ç›¸æ‰‹ã®èª¿å’Œã‚’é‡è¦–ã—ãŸè¡Œå‹•ã‚’å¿ƒãŒã‘ã‚‹", "ç›¸æ‰‹ã®ç¤¾äº¤æ€§ã«åˆã‚ã›ãŸæ¥½ã—ã„æ™‚é–“ã‚’éã”ã™", "ç›¸æ‰‹ã®å”èª¿æ€§ã«å”åŠ›ã—ã€èª¿å’Œã‚’ä¿ã¤", "ç›¸æ‰‹ã®çŒ®èº«æ€§ã«æ•¬æ„ã‚’æ‰•ã„ã€å”åŠ›ã™ã‚‹"],
        "ng_behaviors": ["æ„Ÿè¬ã®æ°—æŒã¡ã‚’è¡¨ã•ãªã„", "éèª¿å’Œçš„ãªæ…‹åº¦", "éç¤¾äº¤çš„ãªæ…‹åº¦"],
        "partner_ng_behaviors": ["ç›¸æ‰‹ã®æ€ã„ã‚„ã‚Šã‚’å½“ãŸã‚Šå‰ã¨æ€ã†", "ç›¸æ‰‹ã®èª¿å’Œã‚’ä¹±ã™", "ç›¸æ‰‹ã®ç¤¾äº¤æ€§ã‚’ç„¡è¦–ã™ã‚‹", "ç›¸æ‰‹ã®å”èª¿æ€§ã‚’è»½è¦–ã™ã‚‹", "ç›¸æ‰‹ã®çŒ®èº«æ€§ã‚’è»½è¦–ã™ã‚‹"]
    },
    "ISTP": {
        "traits": ["å®Ÿç”¨æ€§", "é©å¿œåŠ›", "ç‹¬ç«‹å¿ƒ", "è«–ç†çš„", "å•é¡Œè§£æ±ºåŠ›", "æŸ”è»Ÿæ€§", "å†·é™ã•"],
        "love_style": "è‡ªç”±ãªé–¢ä¿‚ã¨å®Ÿç”¨çš„ãªã‚µãƒãƒ¼ãƒˆã‚’æ±‚ã‚ã‚‹ã€‚ç‹¬ç«‹å¿ƒãŒå¼·ãã€ç›¸æ‰‹ã®å€‹æ€§ã‚’å°Šé‡ã™ã‚‹é–¢ä¿‚ã‚’é‡è¦–ã™ã‚‹ã€‚å®Ÿç”¨çš„ã§æŸ”è»Ÿãªã‚¢ãƒ—ãƒ­ãƒ¼ãƒã‚’å¿ƒãŒã‘ã€å•é¡Œè§£æ±ºèƒ½åŠ›ã‚’æ´»ã‹ã—ãŸæ„›æƒ…è¡¨ç¾ã‚’ã™ã‚‹ã€‚æŸç¸›ã‚’å«Œã„ã€ãŠäº’ã„ã®è‡ªç”±ã‚’å°Šé‡ã—åˆã†é–¢ä¿‚ã‚’å¤§åˆ‡ã«ã™ã‚‹ã€‚",
        "strengths": ["å®Ÿç”¨çš„ãªã‚µãƒãƒ¼ãƒˆ", "æŸ”è»Ÿæ€§", "å•é¡Œè§£æ±º", "ç‹¬ç«‹å¿ƒ", "é©å¿œåŠ›"],
        "challenges": ["æ„Ÿæƒ…è¡¨ç¾", "é•·æœŸçš„ãªã‚³ãƒŸãƒƒãƒˆãƒ¡ãƒ³ãƒˆ", "ç›¸æ‰‹ã®æ„Ÿæƒ…ã‚’ç†è§£", "æ„Ÿæƒ…çš„ãªæ·±ã•"],
        "advice_style": "å®Ÿç”¨çš„ã§æŸ”è»Ÿãªã‚¢ãƒ‰ãƒã‚¤ã‚¹",
        "likes_in_partner": ["ç‹¬ç«‹å¿ƒ", "å®Ÿç”¨æ€§", "æŸ”è»Ÿæ€§", "å•é¡Œè§£æ±ºåŠ›", "è‡ªç”±", "å†·é™ã•"],
        "dislikes_in_partner": ["ä¾å­˜å¿ƒ", "éå®Ÿç”¨çš„", "éæŸ”è»Ÿ", "æ„Ÿæƒ…çš„ãªè¦æ±‚", "æŸç¸›"],
        "common_concerns": ["æ„Ÿæƒ…è¡¨ç¾ãŒè‹¦æ‰‹", "é•·æœŸçš„ãªé–¢ä¿‚ãŒè‹¦æ‰‹", "ç›¸æ‰‹ã®æ„Ÿæƒ…ã‚’ç†è§£ã—ã«ãã„"],
        "my_approaches": ["å®Ÿç”¨çš„ãªã‚µãƒãƒ¼ãƒˆã‚’ã™ã‚‹", "è‡ªç”±ãªé–¢ä¿‚ã‚’å°Šé‡ã™ã‚‹", "å•é¡Œè§£æ±ºã‚’ã‚µãƒãƒ¼ãƒˆã™ã‚‹"],
        "partner_approaches": ["ç›¸æ‰‹ã®ç‹¬ç«‹å¿ƒã‚’å°Šé‡ã—ã€è‡ªç”±ãªé–¢ä¿‚ã‚’ç¯‰ã", "ç›¸æ‰‹ã®å®Ÿç”¨æ€§ã«åˆã‚ã›ãŸè¡Œå‹•ã‚’å¿ƒãŒã‘ã‚‹", "ç›¸æ‰‹ã®æŸ”è»Ÿæ€§ã‚’æ´»ã‹ã—ãŸã‚¢ãƒ—ãƒ­ãƒ¼ãƒã‚’å¿ƒãŒã‘ã‚‹", "ç›¸æ‰‹ã®å•é¡Œè§£æ±ºèƒ½åŠ›ã«ä¿¡é ¼ã‚’ç½®ãã€å”åŠ›ã™ã‚‹", "ç›¸æ‰‹ã®å†·é™ã•ã«æ•¬æ„ã‚’æ‰•ã„ã€æ„Ÿæƒ…çš„ãªè¦æ±‚ã‚’æ§ãˆã‚‹"],
        "ng_behaviors": ["ä¾å­˜å¿ƒã‚’å¼·ã‚ã‚‹", "éå®Ÿç”¨çš„ãªè¦æ±‚ã‚’ã™ã‚‹", "æŸç¸›ã™ã‚‹"],
        "partner_ng_behaviors": ["ç›¸æ‰‹ã®ç‹¬ç«‹å¿ƒã‚’æŸç¸›ã—ã‚ˆã†ã¨ã™ã‚‹", "ç›¸æ‰‹ã®å®Ÿç”¨æ€§ã‚’ç„¡è¦–ã™ã‚‹", "ç›¸æ‰‹ã®æŸ”è»Ÿæ€§ã‚’åˆ¶é™ã™ã‚‹", "ç›¸æ‰‹ã®å•é¡Œè§£æ±ºèƒ½åŠ›ã‚’å¦å®šã™ã‚‹", "ç›¸æ‰‹ã®å†·é™ã•ã‚’ç„¡è¦–ã—ãŸæ„Ÿæƒ…çš„ãªè¦æ±‚ã‚’ã™ã‚‹"]
    },
    "ISFP": {
        "traits": ["èŠ¸è¡“æ€§", "å…±æ„ŸåŠ›", "å®Ÿç”¨æ€§", "æŸ”è»Ÿæ€§", "ç¾æ„è­˜", "ç‹¬ç«‹å¿ƒ", "å‰µé€ æ€§"],
        "love_style": "ç¾ã—ã„é–¢ä¿‚ã¨æ·±ã„æ„Ÿæƒ…çš„ãªçµ†ã‚’æ±‚ã‚ã‚‹ã€‚èŠ¸è¡“çš„ã§ç¾æ„è­˜ãŒé«˜ãã€å‰µé€ çš„ãªæ„›æƒ…è¡¨ç¾ã‚’å¿ƒãŒã‘ã‚‹ã€‚ç›¸æ‰‹ã®å€‹æ€§ã‚’å°Šé‡ã—ã€æ·±ã„æ„Ÿæƒ…ã‚’å…±æœ‰ã™ã‚‹é–¢ä¿‚ã‚’å¤§åˆ‡ã«ã™ã‚‹ã€‚å®Ÿç”¨çš„ãªã‚µãƒãƒ¼ãƒˆã‚‚æä¾›ã—ã€ç¾ã—ãèª¿å’Œã®å–ã‚ŒãŸé–¢ä¿‚ã‚’æ§‹ç¯‰ã™ã‚‹ã€‚",
        "strengths": ["å‰µé€ æ€§", "æ€ã„ã‚„ã‚Š", "å®Ÿç”¨çš„ãªã‚µãƒãƒ¼ãƒˆ", "ç¾æ„è­˜", "æŸ”è»Ÿæ€§"],
        "challenges": ["æ„Ÿæƒ…ã®èµ·ä¼", "é•·æœŸçš„ãªè¨ˆç”»", "ç›¸æ‰‹ã®æœŸå¾…ã«å¿œãˆã™ãã‚‹", "è‡ªå·±ä¸»å¼µ"],
        "advice_style": "èŠ¸è¡“çš„ã§æ„Ÿæƒ…çš„ãªã‚¢ãƒ‰ãƒã‚¤ã‚¹",
        "likes_in_partner": ["ç¾æ„è­˜", "å‰µé€ æ€§", "ç‹¬ç«‹å¿ƒ", "æ€ã„ã‚„ã‚Š", "æŸ”è»Ÿæ€§", "æ·±ã„æ„Ÿæƒ…"],
        "dislikes_in_partner": ["éç¾çš„", "éå‰µé€ çš„", "ä¾å­˜å¿ƒ", "éæ€ã„ã‚„ã‚Š", "éæŸ”è»Ÿ"],
        "common_concerns": ["æ„Ÿæƒ…ã®èµ·ä¼ãŒæ¿€ã—ã„", "é•·æœŸçš„ãªè¨ˆç”»ãŒè‹¦æ‰‹", "è‡ªå·±ä¸»å¼µãŒã§ããªã„"],
        "my_approaches": ["ç¾ã—ã„é–¢ä¿‚ã‚’ç¯‰ã", "å‰µé€ çš„ãªã‚¢ãƒ—ãƒ­ãƒ¼ãƒã‚’ã™ã‚‹", "æ·±ã„æ„Ÿæƒ…ã‚’å…±æœ‰ã™ã‚‹"],
        "partner_approaches": ["ç›¸æ‰‹ã®ç¾æ„è­˜ã‚’ç†è§£ã—ã€ç¾ã—ã„ä½“é¨“ã‚’å…±æœ‰ã™ã‚‹", "ç›¸æ‰‹ã®å‰µé€ æ€§ã‚’åˆºæ¿€ã—ã€èŠ¸è¡“çš„ãªä½“é¨“ã‚’ææ¡ˆã™ã‚‹", "ç›¸æ‰‹ã®ç‹¬ç«‹å¿ƒã‚’å°Šé‡ã—ã€è‡ªç”±ãªé–¢ä¿‚ã‚’ç¯‰ã", "ç›¸æ‰‹ã®æ€ã„ã‚„ã‚Šã«æ„Ÿè¬ã—ã€åŒã˜æ„›æƒ…ã§è¿”ã™", "ç›¸æ‰‹ã®æŸ”è»Ÿæ€§ã‚’æ´»ã‹ã—ãŸã‚¢ãƒ—ãƒ­ãƒ¼ãƒã‚’å¿ƒãŒã‘ã‚‹"],
        "ng_behaviors": ["éç¾çš„ãªæ…‹åº¦", "éå‰µé€ çš„ãªè¦æ±‚", "ä¾å­˜å¿ƒã‚’å¼·ã‚ã‚‹"],
        "partner_ng_behaviors": ["ç›¸æ‰‹ã®ç¾æ„è­˜ã‚’å¦å®šã™ã‚‹", "ç›¸æ‰‹ã®å‰µé€ æ€§ã‚’åˆ¶é™ã™ã‚‹", "ç›¸æ‰‹ã®ç‹¬ç«‹å¿ƒã‚’æŸç¸›ã—ã‚ˆã†ã¨ã™ã‚‹", "ç›¸æ‰‹ã®æ€ã„ã‚„ã‚Šã‚’è»½è¦–ã™ã‚‹", "ç›¸æ‰‹ã®æŸ”è»Ÿæ€§ã‚’ç„¡è¦–ã™ã‚‹"]
    },
    "ESTP": {
        "traits": ["å®Ÿç”¨æ€§", "é©å¿œåŠ›", "å†’é™ºå¿ƒ", "ç¤¾äº¤æ€§", "å•é¡Œè§£æ±ºåŠ›", "æ¥½è¦³æ€§", "è¡Œå‹•åŠ›"],
        "love_style": "åˆºæ¿€çš„ã§å®Ÿç”¨çš„ãªé–¢ä¿‚ã‚’æ±‚ã‚ã‚‹ã€‚å†’é™ºå¿ƒã¨è¡Œå‹•åŠ›ãŒã‚ã‚Šã€æ–°ã—ã„ä½“é¨“ã‚’å…±æœ‰ã™ã‚‹é–¢ä¿‚ã‚’å¤§åˆ‡ã«ã™ã‚‹ã€‚å®Ÿç”¨çš„ã§æŸ”è»Ÿãªã‚¢ãƒ—ãƒ­ãƒ¼ãƒã‚’å¿ƒãŒã‘ã€ç›¸æ‰‹ã‚’æ¥½ã—ã¾ã›ã‚‹æ„›æƒ…è¡¨ç¾ã‚’å¾—æ„ã¨ã™ã‚‹ã€‚ç¤¾äº¤çš„ã§æ¥½è¦³çš„ã€å•é¡Œè§£æ±ºèƒ½åŠ›ã‚’æ´»ã‹ã—ãŸé–¢ä¿‚ã‚’æ§‹ç¯‰ã™ã‚‹ã€‚",
        "strengths": ["å•é¡Œè§£æ±º", "ç›¸æ‰‹ã‚’æ¥½ã—ã¾ã›ã‚‹", "å®Ÿç”¨çš„ãªã‚µãƒãƒ¼ãƒˆ", "å†’é™ºå¿ƒ", "é©å¿œåŠ›"],
        "challenges": ["é•·æœŸçš„ãªè¨ˆç”»", "æ„Ÿæƒ…çš„ãªæ·±ã•", "ä¸€è²«æ€§", "æ„Ÿæƒ…ã®å®‰å®š"],
        "advice_style": "å®Ÿç”¨çš„ã§åˆºæ¿€çš„ãªã‚¢ãƒ‰ãƒã‚¤ã‚¹",
        "likes_in_partner": ["å†’é™ºå¿ƒ", "å®Ÿç”¨æ€§", "æ¥½è¦³æ€§", "ç¤¾äº¤æ€§", "è¡Œå‹•åŠ›", "æŸ”è»Ÿæ€§"],
        "dislikes_in_partner": ["é€€å±ˆ", "éå®Ÿç”¨çš„", "æ‚²è¦³çš„", "éç¤¾äº¤çš„", "æ¶ˆæ¥µçš„"],
        "common_concerns": ["é•·æœŸçš„ãªè¨ˆç”»ãŒè‹¦æ‰‹", "æ„Ÿæƒ…çš„ãªæ·±ã•ãŒãªã„", "ä¸€è²«æ€§ãŒãªã„"],
        "my_approaches": ["åˆºæ¿€çš„ãªãƒ‡ãƒ¼ãƒˆã‚’ææ¡ˆã™ã‚‹", "å®Ÿç”¨çš„ãªã‚µãƒãƒ¼ãƒˆã‚’ã™ã‚‹", "å†’é™ºçš„ãªä½“é¨“ã‚’å…±æœ‰ã™ã‚‹"],
        "partner_approaches": ["ç›¸æ‰‹ã®å†’é™ºå¿ƒã‚’æº€ãŸã™åˆºæ¿€çš„ãªä½“é¨“ã‚’ææ¡ˆã™ã‚‹", "ç›¸æ‰‹ã®å®Ÿç”¨æ€§ã«åˆã‚ã›ãŸè¡Œå‹•ã‚’å¿ƒãŒã‘ã‚‹", "ç›¸æ‰‹ã®æ¥½è¦³æ€§ã«åˆã‚ã›ãŸå‰å‘ããªæ…‹åº¦ã‚’å¿ƒãŒã‘ã‚‹", "ç›¸æ‰‹ã®ç¤¾äº¤æ€§ã«åˆã‚ã›ãŸæ¥½ã—ã„æ™‚é–“ã‚’éã”ã™", "ç›¸æ‰‹ã®è¡Œå‹•åŠ›ã«åˆã‚ã›ãŸç©æ¥µçš„ãªã‚¢ãƒ—ãƒ­ãƒ¼ãƒã‚’å¿ƒãŒã‘ã‚‹"],
        "ng_behaviors": ["é€€å±ˆãªé–¢ä¿‚ã‚’æ±‚ã‚ã‚‹", "éå®Ÿç”¨çš„ãªè¦æ±‚ã‚’ã™ã‚‹", "æ¶ˆæ¥µçš„ãªæ…‹åº¦"],
        "partner_ng_behaviors": ["ç›¸æ‰‹ã®å†’é™ºå¿ƒã‚’é˜»å®³ã™ã‚‹", "ç›¸æ‰‹ã®å®Ÿç”¨æ€§ã‚’ç„¡è¦–ã™ã‚‹", "ç›¸æ‰‹ã®æ¥½è¦³æ€§ã‚’å¦å®šã™ã‚‹", "ç›¸æ‰‹ã®ç¤¾äº¤æ€§ã‚’åˆ¶é™ã™ã‚‹", "ç›¸æ‰‹ã®è¡Œå‹•åŠ›ã‚’é˜»å®³ã™ã‚‹"]
    },
    "ESFP": {
        "traits": ["ç†±æ„", "ç¤¾äº¤æ€§", "å®Ÿç”¨æ€§", "é©å¿œåŠ›", "æ¥½è¦³æ€§", "æ€ã„ã‚„ã‚Š", "è¡Œå‹•åŠ›"],
        "love_style": "æ¥½ã—ãåˆºæ¿€çš„ãªé–¢ä¿‚ã‚’æ±‚ã‚ã‚‹ã€‚ç¤¾äº¤çš„ã§æ¥½è¦³çš„ã€ãŠäº’ã„ã‚’æ¥½ã—ã¾ã›åˆã†é–¢ä¿‚ã‚’å¤§åˆ‡ã«ã™ã‚‹ã€‚å®Ÿç”¨çš„ãªã‚µãƒãƒ¼ãƒˆã‚‚æä¾›ã—ã€æ€ã„ã‚„ã‚Šã¨è¡Œå‹•åŠ›ã§é–¢ä¿‚ã‚’ç™ºå±•ã•ã›ã‚‹ã€‚æ„Ÿæƒ…è¡¨ç¾ãŒè±Šã‹ã§ã€ç›¸æ‰‹ã‚’å¹¸ã›ã«ã™ã‚‹æ„›æƒ…è¡¨ç¾ã‚’å¿ƒãŒã‘ã‚‹ã€‚",
        "strengths": ["ç›¸æ‰‹ã‚’æ¥½ã—ã¾ã›ã‚‹", "ã‚³ãƒŸãƒ¥ãƒ‹ã‚±ãƒ¼ã‚·ãƒ§ãƒ³", "å®Ÿç”¨çš„ãªã‚µãƒãƒ¼ãƒˆ", "æ¥½è¦³æ€§", "ç¤¾äº¤æ€§"],
        "challenges": ["é•·æœŸçš„ãªè¨ˆç”»", "æ„Ÿæƒ…ã®èµ·ä¼", "ä¸€è²«æ€§", "æ„Ÿæƒ…ã®å®‰å®š"],
        "advice_style": "æ¥½ã—ãå®Ÿè·µçš„ãªã‚¢ãƒ‰ãƒã‚¤ã‚¹",
        "likes_in_partner": ["æ¥½è¦³æ€§", "ç¤¾äº¤æ€§", "å®Ÿç”¨æ€§", "æ€ã„ã‚„ã‚Š", "è¡Œå‹•åŠ›", "æŸ”è»Ÿæ€§"],
        "dislikes_in_partner": ["æ‚²è¦³çš„", "éç¤¾äº¤çš„", "éå®Ÿç”¨çš„", "éæ€ã„ã‚„ã‚Š", "æ¶ˆæ¥µçš„"],
        "common_concerns": ["é•·æœŸçš„ãªè¨ˆç”»ãŒè‹¦æ‰‹", "æ„Ÿæƒ…ã®èµ·ä¼ãŒæ¿€ã—ã„", "ä¸€è²«æ€§ãŒãªã„"],
        "my_approaches": ["æ¥½ã—ã„ãƒ‡ãƒ¼ãƒˆã‚’ææ¡ˆã™ã‚‹", "å®Ÿç”¨çš„ãªã‚µãƒãƒ¼ãƒˆã‚’ã™ã‚‹", "ç¤¾äº¤çš„ãªä½“é¨“ã‚’å…±æœ‰ã™ã‚‹"],
        "partner_approaches": ["ç›¸æ‰‹ã®æ¥½è¦³æ€§ã«åˆã‚ã›ãŸå‰å‘ããªæ…‹åº¦ã‚’å¿ƒãŒã‘ã‚‹", "ç›¸æ‰‹ã®ç¤¾äº¤æ€§ã«åˆã‚ã›ãŸæ¥½ã—ã„æ™‚é–“ã‚’éã”ã™", "ç›¸æ‰‹ã®å®Ÿç”¨æ€§ã«åˆã‚ã›ãŸè¡Œå‹•ã‚’å¿ƒãŒã‘ã‚‹", "ç›¸æ‰‹ã®æ€ã„ã‚„ã‚Šã«æ„Ÿè¬ã—ã€åŒã˜æ„›æƒ…ã§è¿”ã™", "ç›¸æ‰‹ã®è¡Œå‹•åŠ›ã«åˆã‚ã›ãŸç©æ¥µçš„ãªã‚¢ãƒ—ãƒ­ãƒ¼ãƒã‚’å¿ƒãŒã‘ã‚‹"],
        "ng_behaviors": ["æ‚²è¦³çš„ãªæ…‹åº¦", "éç¤¾äº¤çš„ãªæ…‹åº¦", "æ¶ˆæ¥µçš„ãªæ…‹åº¦"],
        "partner_ng_behaviors": ["ç›¸æ‰‹ã®æ¥½è¦³æ€§ã‚’å¦å®šã™ã‚‹", "ç›¸æ‰‹ã®ç¤¾äº¤æ€§ã‚’åˆ¶é™ã™ã‚‹", "ç›¸æ‰‹ã®å®Ÿç”¨æ€§ã‚’ç„¡è¦–ã™ã‚‹", "ç›¸æ‰‹ã®æ€ã„ã‚„ã‚Šã‚’è»½è¦–ã™ã‚‹", "ç›¸æ‰‹ã®è¡Œå‹•åŠ›ã‚’é˜»å®³ã™ã‚‹"]
    }
}



# MBTIè¨ºæ–­ç”¨ã®è³ªå•ã¨ãƒãƒƒãƒ”ãƒ³ã‚°ï¼ˆã‚°ãƒ­ãƒ¼ãƒãƒ«å®šç¾©ï¼‰
questions = [
    "å¥½ããªäººã¨ã¯æ¯æ—¥LINEã—ãŸã„ï¼ŸğŸ¥º",                # E
    "åˆå¯¾é¢ã§ã‚‚æ°—ã«ãªã£ãŸäººã«ã¯è‡ªåˆ†ã‹ã‚‰è©±ã—ã‹ã‘ã‚‹ï¼Ÿ",             # E
    "ç•°æ€§ã¨ã®æ²ˆé»™ã¯æ°—ã«ãªã‚‰ãªã„ï¼ŸğŸ’‘",           # I
    "ä¸€äººã®æ™‚é–“ãŒãªã„ã¨ç–²ã‚Œã¦ã—ã¾ã†ï¼ŸğŸŒ™",             # I
    "æ‹äººã®å°ã•ãªå¤‰åŒ–ã«ã™ãæ°—ã¥ãï¼ŸğŸ˜Š",             # S
    "éå»ã®å‡ºæ¥äº‹ã‚„ç´°ã‹ã„è¨˜æ†¶ã‚’ã‚ˆãè¦šãˆã¦ã‚‹æ–¹ï¼Ÿ",           # S
    "æ‹æ„›ã¯ãƒ•ã‚£ãƒ¼ãƒªãƒ³ã‚°ãŒå¤§äº‹ï¼ŸğŸ’¡",           # N
    "æ‹äººã®æ°—æŒã¡ã‚’ã™ãå¯Ÿã™ã‚‹è‡ªä¿¡ãŒã‚ã‚‹ï¼ŸğŸ”®",       # N
    "æ‹äººã¨æœªæ¥ã‚’è€ƒãˆã‚‹æ™‚ã€ã¾ãšã€ç¾å®Ÿçš„ãªæ¡ä»¶ã€ãŒæ°—ã«ãªã‚‹ğŸ§ ",             # T
    "æ‹äººã®ç›¸è«‡ã«ã¯å…±æ„Ÿã‚ˆã‚Šã‚‚ã‚¢ãƒ‰ãƒã‚¤ã‚¹ã‚’å„ªå…ˆã—ãŒã¡ï¼ŸğŸ“±",     # T
    "æ‹æ„›ä¸­ã€ç›¸æ‰‹ãŒç†ä¸å°½ã§ã‚‚ã€ã§ã‚‚å¥½ãã ã‹ã‚‰â€¦ã€ã£ã¦æ€ã£ã¡ã‚ƒã†ã“ã¨ãŒã‚ã‚‹ï¼ŸğŸ’“",             # F
    "å¥½ããªäººã®ãŸã‚ãªã‚‰ã€è‡ªåˆ†ãŒå°‘ã—ç„¡ç†ã—ã¦ã‚‚æ§‹ã‚ãªã„",           # F
    "ãƒ‡ãƒ¼ãƒˆã¯è¨ˆç”»ã‚’ç«‹ã¦ã¦ã‹ã‚‰å‹•ããŸã„ï¼ŸğŸ“†",         # J
    "å…ˆã®ã“ã¨ãŒè¦‹ãˆãªã„é–¢ä¿‚ã¯ã¡ã‚‡ã£ã¨è‹¦æ‰‹",           # J
    "æ‹æ„›ã§ã‚‚ã€ãƒãƒªã€ã¨ã€å‹¢ã„ã€ã£ã¦ã€çµæ§‹å¤§äº‹ã ã¨æ€ã†",   # P
    "ã€ã„ã¤å‘Šç™½ã—ã¦ãã‚Œã‚‹ã®ï¼Ÿã€ã£ã¦è¨€ã‚ã‚ŒãŸã‚‰ãƒ—ãƒ¬ãƒƒã‚·ãƒ£ãƒ¼ã«æ„Ÿã˜ã‚‹ğŸŒˆ"           # P
]

mapping = [
    ("E", "I"), ("E", "I"), ("I", "E"), ("I", "E"),
    ("S", "N"), ("S", "N"), ("N", "S"), ("N", "S"),
    ("T", "F"), ("T", "F"), ("F", "T"), ("F", "T"),
    ("J", "P"), ("J", "P"), ("P", "J"), ("P", "J")
]

# ğŸ’¾ SQLiteåˆæœŸåŒ–
def init_db():
    conn = sqlite3.connect(DB_PATH)
    cursor = conn.cursor()
    cursor.execute('''
        CREATE TABLE IF NOT EXISTS users (
            user_id TEXT PRIMARY KEY,
            mbti TEXT,
            gender TEXT,
            target_mbti TEXT,
            is_paid INTEGER DEFAULT 0,
            mode TEXT,
            mbti_answers TEXT
        )
    ''')
    cursor.execute('''
        CREATE TABLE IF NOT EXISTS messages (
            user_id TEXT,
            role TEXT,
            content TEXT
        )
    ''')
    # Stripeé¡§å®¢ãƒ†ãƒ¼ãƒ–ãƒ«ã‚’è¿½åŠ 
    cursor.execute('''
        CREATE TABLE IF NOT EXISTS stripe_customers (
            user_id TEXT PRIMARY KEY,
            customer_id TEXT
        )
    ''')
    conn.commit()
    conn.close()
    print("SQLiteãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã‚’åˆæœŸåŒ–ã—ã¾ã—ãŸã€‚")

init_db()

# ãƒ¦ãƒ¼ã‚¶ãƒ¼ãƒ—ãƒ­ãƒ•ã‚¡ã‚¤ãƒ«ã®å–å¾—
def get_user_profile(user_id):
    conn = sqlite3.connect(DB_PATH)
    cursor = conn.cursor()
    cursor.execute("SELECT mbti, gender, target_mbti, is_paid, mode, mbti_answers FROM users WHERE user_id=?", (user_id,))
    row = cursor.fetchone()
    conn.close()
    print(f"get_user_profile: user_id={user_id}, row={row}")
    return {
        "mbti": row[0] if row else "ä¸æ˜",
        "gender": row[1] if row else "ä¸æ˜",
        "target_mbti": row[2] if row else "ä¸æ˜",
        "is_paid": bool(row[3]) if row else False,
        "mode": row[4] if row else "",
        "mbti_answers": row[5] if row else ""
    }

# MBTIé›†è¨ˆãƒ­ã‚¸ãƒƒã‚¯
def calc_mbti(answers):
    score = {'E': 0, 'I': 0, 'S': 0, 'N': 0, 'T': 0, 'F': 0, 'J': 0, 'P': 0}
    n = min(len(questions), len(answers), len(mapping))
    for i in range(n):
        ans = answers[i]
        type1, type2 = mapping[i]
        if ans == 1:
            score[type1] += 1
        else:
            score[type2] += 1
    mbti = (
        ('E' if score['E'] >= score['I'] else 'I') +
        ('S' if score['S'] >= score['N'] else 'N') +
        ('T' if score['T'] >= score['F'] else 'F') +
        ('J' if score['J'] >= score['P'] else 'P')
    )
    return mbti

# MBTIè¨ºæ–­é–‹å§‹é–¢æ•°
def start_mbti_diagnosis(user_id):
    print(f"Starting MBTI diagnosis for user_id: {user_id}")
    conn = sqlite3.connect(DB_PATH)
    cursor = conn.cursor()
    # ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒã„ãªã‘ã‚Œã°INSERT
    cursor.execute(
        "INSERT OR IGNORE INTO users (user_id, mode, mbti_answers) VALUES (?, 'mbti_diagnosis', '[]')",
        (user_id,)
    )
    # å¿…ãšmodeã¨mbti_answersã‚’ã‚»ãƒƒãƒˆ
    cursor.execute(
        "UPDATE users SET mode='mbti_diagnosis', mbti_answers='[]' WHERE user_id=?",
        (user_id,)
    )
    conn.commit()
    # ã“ã“ã§ç¢ºèª
    cursor.execute("SELECT mode FROM users WHERE user_id=?", (user_id,))
    row = cursor.fetchone()
    print(f"ç¢ºèª: è¨­å®šå¾Œã®mode = {row[0] if row else 'None'}")
    conn.close()
    print(f"MBTI diagnosis mode set for user_id: {user_id}")
    first_question = send_mbti_question(user_id, 0)
    print(f"First question generated: {first_question}")
    return first_question

# MBTIè³ªå•é€ä¿¡é–¢æ•°ï¼ˆãƒœã‚¿ãƒ³å¼ï¼‰
def send_mbti_question(user_id, question_index):
    """MBTIè¨ºæ–­ã®è³ªå•ã‚’é€ä¿¡ï¼ˆãƒœã‚¿ãƒ³å¼ï¼‰"""
    if question_index >= len(questions):
        return "è¨ºæ–­ãŒå®Œäº†ã—ã¾ã—ãŸï¼"
    
    # ãƒœã‚¿ãƒ³ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã‚’ä½œæˆï¼ˆmessageã‚¢ã‚¯ã‚·ãƒ§ãƒ³ã§ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®å¹ãå‡ºã—ã«ï¼‰
    template = {
        "type": "template",
        "altText": f"è³ªå•{question_index + 1}/16: {questions[question_index]}",
        "template": {
            "type": "buttons",
            "title": f"è³ªå•{question_index + 1}/16",
            "text": questions[question_index],
            "actions": [
                {
                    "type": "message",
                    "label": "ã¯ã„",
                    "text": "ã¯ã„"
                },
                {
                    "type": "message",
                    "label": "ã„ã„ãˆ",
                    "text": "ã„ã„ãˆ"
                }
            ]
        }
    }
    
    return template

# MBTIå›ç­”å‡¦ç†é–¢æ•°
def process_mbti_answer(user_id, answer, user_profile):
    try:
        print(f"process_mbti_answer: user_id={user_id}, answer={answer}")
        conn = sqlite3.connect(DB_PATH)
        cursor = conn.cursor()
        cursor.execute("SELECT mbti_answers FROM users WHERE user_id=?", (user_id,))
        row = cursor.fetchone()
        if row and row[0]:
            answers = json.loads(row[0])
        else:
            answers = []
        answers.append(1 if answer == "ã¯ã„" else 0)
        print(f"=== MBTIå›ç­”ãƒ­ã‚° ===")
        print(f"ãƒ¦ãƒ¼ã‚¶ãƒ¼ID: {user_id}")
        print(f"ç¾åœ¨ã®å›ç­”æ•°: {len(answers)}/16")
        print(f"æœ€æ–°ã®å›ç­”: {answer} (æ•°å€¤: {1 if answer == 'ã¯ã„' else 0})")
        print(f"å…¨å›ç­”å±¥æ­´: {answers}")
        print(f"==================")
        cursor.execute("UPDATE users SET mbti_answers=? WHERE user_id=?", (json.dumps(answers), user_id))
        conn.commit()
        conn.close()
        next_question_index = len(answers)
        print(f"next_question_index: {next_question_index}")
        if next_question_index < 16:
            print(f"æ¬¡ã®è³ªå•ã‚’é€ä¿¡: è³ªå•{next_question_index + 1}/16")
            return send_mbti_question(user_id, next_question_index)
        else:
            print(f"è¨ºæ–­å®Œäº†ï¼å…¨å›ç­”: {answers}")
            result_message = complete_mbti_diagnosis(user_id, answers)
            payment_message = get_payment_message(user_id)
            # è¨ºæ–­å®Œäº†ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸é€ä¿¡å¾Œã«modeã‚’ãƒªã‚»ãƒƒãƒˆ
            conn = sqlite3.connect(DB_PATH)
            cursor = conn.cursor()
            cursor.execute("UPDATE users SET mode='' WHERE user_id=?", (user_id,))
            conn.commit()
            conn.close()
            return [
                {"type": "text", "text": result_message},
                {"type": "text", "text": payment_message}
            ]

    except Exception as e:
        print(f"MBTIå›ç­”å‡¦ç†ã‚¨ãƒ©ãƒ¼: {e}")
        return "ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸã€‚ã‚‚ã†ä¸€åº¦è¨ºæ–­ã‚’é–‹å§‹ã—ã¦ãã ã•ã„ã€‚"

# MBTIè¨ºæ–­å®Œäº†é–¢æ•°
def complete_mbti_diagnosis(user_id, answers):
    """MBTIè¨ºæ–­ã‚’å®Œäº†ã—ã€çµæœã‚’é€ä¿¡"""
    try:
        # MBTIè¨ˆç®—
        mbti = calc_mbti(answers)

        # çµæœã‚’ä¿å­˜ï¼ˆmodeã¯ç¶­æŒã—ã¦ã€è¨ºæ–­å®Œäº†ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’é€ä¿¡å¾Œã«ãƒªã‚»ãƒƒãƒˆï¼‰
        conn = sqlite3.connect(DB_PATH)
        cursor = conn.cursor()
        cursor.execute("UPDATE users SET mbti=? WHERE user_id=?", (mbti, user_id))
        conn.commit()
        conn.close()
        
        # è¨ºæ–­çµæœãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã®ã¿ï¼ˆèª²é‡‘èª˜å°ãªã—ï¼‰
        result_message = f"ğŸ”è¨ºæ–­å®Œäº†ã£ï¼\n\nã‚ãªãŸã®æ‹æ„›ã‚¿ã‚¤ãƒ—ã¯â€¦\nâ¤ï¸{MBTI_NICKNAME.get(mbti, mbti)}â¤ï¸\n\n{get_mbti_description(mbti)}"
        
        # GASã¸ã®è©³ç´°ã‚¢ãƒ‰ãƒã‚¤ã‚¹é€ä¿¡ã¯ã“ã“ã§ã¯å‘¼ã°ãªã„ï¼ˆæ±ºæ¸ˆå®Œäº†æ™‚ã®ã¿ï¼‰
        # send_detailed_advice_to_gas(user_id, mbti)
        
        return result_message
        
    except Exception as e:
        print(f"MBTIè¨ºæ–­å®Œäº†ã‚¨ãƒ©ãƒ¼: {e}")
        return "è¨ºæ–­çµæœã®å‡¦ç†ä¸­ã«ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸã€‚"

def get_mbti_description(mbti):
    """MBTIã‚¿ã‚¤ãƒ—ã®èª¬æ˜ã‚’å–å¾—"""
    descriptions = {
        "INTJ": "ä¸€è¦‹ã‚¯ãƒ¼ãƒ«ã§ç„¡é–¢å¿ƒãã†ãªã®ã«ã€å®Ÿã¯ã€Œæœ¬å‘½ã ã‘ã«ã¯ä¸€é€”ã€ãªã‚ãªãŸã€‚\næ„Ÿæƒ…ã‚ˆã‚Šã‚‚è«–ç†ã§å‹•ãæ…é‡æ´¾ã§ã€æ‹ã‚‚æˆ¦ç•¥çš„ã«é€²ã‚ãŒã¡ã€‚\nã§ã‚‚ã€å¿ƒã‚’è¨±ã—ãŸç›¸æ‰‹ã«ã¯ä¸å™¨ç”¨ãªãŒã‚‰ã‚‚ã¡ã‚ƒã‚“ã¨å¼±ã•ã‚’è¦‹ã›ã‚‰ã‚Œã‚‹ã€ã‚®ãƒ£ãƒƒãƒ—ãŒé­…åŠ›ğŸ’­\nã€Œã“ã®äººã«ã ã‘ã¯è¦‹ã›ã‚‹é¡”ã€ãŒã‚ã‚‹ã‚ãªãŸã«ã€è½ã¡ã‚‹äººã¯å¤šã„ã¯ãšã€‚\n\nâ”€â”€â”€\nğŸŒ™å¤œã®é¡”ã¯â€¦ã€çŸ¥çš„ãƒ‰Sæ•™å®˜ğŸ§ ã€‘\næ™®æ®µã¯ç†æ€§çš„ãªã®ã«ã€å¤œã¯å®Œå…¨ä¸»å°å‹ã€‚\nç›¸æ‰‹ã®åå¿œã‚’è¦³å¯Ÿã—ã¦æµã‚Œã‚’ã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ«ã™ã‚‹ã€ã€é™ã‹ãªæ”¯é…ã€‘ã‚¿ã‚¤ãƒ—ã€‚\næ„Ÿæƒ…ã‚ˆã‚Šã‚‚æº€è¶³åº¦ã‚’é‡è¦–ã™ã‚‹ãƒ­ã‚¸ã‚«ãƒ«ãªå¤œã€ã ã‘ã©â€¦\næœ¬æ°—ã§å¿ƒè¨±ã—ãŸç›¸æ‰‹ã«ã¯ã€ç‹¬å æ¬²ãŒã¡ã‚‰ã£ã¨å‡ºã‚‹ã“ã¨ã‚‚ğŸ”¥",
        "INTP": "æ„Ÿæƒ…ã‚ˆã‚Šã‚‚æ€è€ƒãŒå…ˆã«ç«‹ã£ã¡ã‚ƒã†ã‚ãªãŸã€‚\nã€Œãªã‚“ã§ãã†ãªã‚‹ã®ï¼Ÿã€ã£ã¦è€ƒãˆã™ãã¦ã€\nç´ ç›´ãªä¸€è¨€ãŒãªã‹ãªã‹å‡ºã¦ã“ãªã„ã“ã¨ã‚‚å¤šã„ã‚ˆã­ğŸ’­\n\nã§ã‚‚ã€èˆˆå‘³ã‚’æŒã£ãŸç›¸æ‰‹ã«ã¯ã‚ã¡ã‚ƒãã¡ã‚ƒæ·±æ˜ã‚Šã™ã‚‹ã‚¿ã‚¤ãƒ—ã§ã€\nä¸€åº¦ãƒãƒã‚‹ã¨ä»–ãŒè¦‹ãˆãªããªã‚‹ã€Œæ„›ã®ã‚ªã‚¿ã‚¯æ°—è³ªã€ã‚‚æŒã£ã¦ã‚‹ğŸ’˜\nãã®åˆ†ã€è‡ªåˆ†ã§ã‚‚æ°—ã¥ã‹ãªã„ã†ã¡ã«è·é›¢ã‚’å–ã£ã¡ã‚ƒã£ã¦ã€\nã€Œå†·ãŸã„â€¦ï¼Ÿã€ã£ã¦èª¤è§£ã•ã‚Œã‚‹ã“ã¨ã‚‚ã‚ã‚‹ã‹ã‚‚ğŸ˜¢\n\nã§ã‚‚å¤§ä¸ˆå¤«ã€‚ã‚ãªãŸã®é­…åŠ›ã¯ã€\nã€çŸ¥çš„ã•Ã—ãƒ”ãƒ¥ã‚¢ã•ã€ã¨ã„ã†æœ€å¼·ã‚³ãƒ³ãƒœã ã‹ã‚‰ğŸŒŸ\nç´ ç›´ãªä¸€è¨€ã§ä¸–ç•ŒãŒå¤‰ã‚ã‚‹æ‹ã€ã‚ã‚‹ã‹ã‚‚ã—ã‚Œãªã„ã­ã€‚\n\nğŸŒ™å¤œã®é¡”ã¯â€¦ã€çŸ¥è­˜ãƒ—ãƒ¬ã‚¤è·äººğŸ“šã€‘\né™ã‹ã«ã€ã§ã‚‚çš„ç¢ºã«ã€‚\næ€è€ƒå‹ãªã‚‰ã§ã¯ã®ã€çŸ¥ã£ã¦ã¦ã‚„ã‚‹ã€ã‚¹ã‚¤ãƒƒãƒãŒå…¥ã‚‹ã¨ã€\nãƒ†ãƒ³ãƒã‚‚ã‚¿ãƒƒãƒã‚‚è¨ˆç®—ã•ã‚Œå°½ãã—ã¦ã‚‹ã€‚\nç„¡è¨€ãªã®ã«ãƒ‰ã‚­ãƒƒã¨ã™ã‚‹ã€çŸ¥çš„ãªã‚¾ã‚¯ã‚¾ã‚¯æ„Ÿã‚’æ¼”å‡ºã™ã‚‹ã‚¿ã‚¤ãƒ—ã€‚",
        "ENTJ": "é ¼ã‚Œã‚‹ã—ã£ã‹ã‚Šè€…ã§ã€è‡ªåˆ†ã®æ„æ€ãŒã¯ã£ãã‚Šã—ã¦ã‚‹ã‚ãªãŸã€‚\næ‹æ„›ã§ã‚‚ã€Œã“ã†ã—ãŸã„ã€ã€Œã“ã†ã‚ã‚‹ã¹ãã€ã£ã¦ç†æƒ³ãŒæ˜ç¢ºã§ã€ã¤ã„ã¤ã„ä¸»å°æ¨©ã‚’æ¡ã£ã¡ã‚ƒã†ã“ã¨ãŒå¤šã„ã‚ˆã­ğŸ’¼\n\nã§ã‚‚æœ¬å½“ã¯ã€æ‹ã«ã¯ã¡ã‚‡ã£ã´ã‚Šä¸å™¨ç”¨ã€‚\nç”˜ãˆãŸã„ã®ã«ã†ã¾ãå‡ºã›ãªã‹ã£ãŸã‚Šã€ã€Œå¥½ã‹ã‚Œã¦ã‹ã‚‰å‹•ããŸã„ã€ã£ã¦æ…é‡ã«ãªã‚ŠãŒã¡ã€‚\n\næƒ¹ã‹ã‚ŒãŸç›¸æ‰‹ã«ã¯ã€èª å®Ÿã§è¨ˆç”»çš„ãªã‚¢ãƒ—ãƒ­ãƒ¼ãƒã§è·é›¢ã‚’ç¸®ã‚ã‚‹ã‚¿ã‚¤ãƒ—ã€‚\næ„Ÿæƒ…ã‚’ç´ ç›´ã«è¦‹ã›ã‚‰ã‚ŒãŸç¬é–“ã€ä¸€æ°—ã«é–¢ä¿‚ãŒé€²å±•ã™ã‚‹ã¯ãšğŸ’˜\n\nğŸŒ™å¤œã®é¡”ã¯â€¦ã€æ”¯é…ã®ã‚«ãƒªã‚¹ãƒæŒ‡æ®å®˜ğŸ©ã€‘\nãƒ™ãƒƒãƒ‰ã§ã‚‚ä¸»å°æ¨©ã‚’æ¡ã‚ŠãŸã„æ´¾ã€‚\nè‡ªåˆ†ã§é›°å›²æ°—ã‚’çµ„ã¿ç«‹ã¦ã€ã˜ã£ãã‚Šæ”»ã‚ã¦ãã‚‹ã€ç†æ€§ã¨æ”¯é…ã€ã®ãƒã‚¤ãƒ–ãƒªãƒƒãƒ‰ã€‚\nã§ã‚‚å®Ÿã¯ã€ç›¸æ‰‹ã®æ°—æŒã¡ã‚„æ§˜å­ã«ã‚‚ã‚ã¡ã‚ƒãã¡ã‚ƒæ•æ„Ÿã€‚\nä¸€åº¦ä»»ã›ãŸã‚‰ã€å…¨éƒ¨å§”ã­ãŸããªã‚‹äººã€‚",
        "ENTP": "æ˜ã‚‹ãã¦ãƒãƒªãŒã‚ˆãã€æ‹ã‚‚å‹¢ã„é‡è¦–ãªã‚ãªãŸã€‚\nå¥½ãã«ãªã£ãŸã‚‰å…¨åŠ›ãƒ€ãƒƒã‚·ãƒ¥ã§è·é›¢ã‚’è©°ã‚ã‚‹ã‘ã©ã€ã¡ã‚‡ã£ã¨ã§ã‚‚å†·ã‚ãŸã‚‰æ€¥ãƒ–ãƒ¬ãƒ¼ã‚­â€¦ãã‚“ãªã‚¢ãƒƒãƒ—ãƒ€ã‚¦ãƒ³ãŒé­…åŠ›ã§ã‚‚ã‚ã‚‹ã‚“ã ã‚ˆã­ğŸ¢\nè‡ªç”±ã§æ¥½ã—ã„æ‹æ„›ãŒå¥½ãã ã‹ã‚‰ã€æŸç¸›ã‚„ãƒ«ãƒ¼ãƒ«ã¯ã¡ã‚‡ã£ã¨è‹¦æ‰‹ã€‚\nã§ã‚‚ã€å¿ƒã‹ã‚‰æƒ¹ã‹ã‚ŒãŸç›¸æ‰‹ã«ã¯ã¡ã‚ƒã‚“ã¨æœ¬æ°—ã§å‘ãåˆã†ã‚ˆğŸ’˜\nä¸€ç·’ã«ã„ã¦é£½ããªã„ã€åˆºæ¿€çš„ãªå­˜åœ¨ã«ãªã‚Œã‚‹ã‹ãŒæ‹ã®éµï¼\n\nğŸŒ™å¤œã®é¡”ã¯â€¦ã€ã‚«ã‚ªã‚¹ãªå¿«æ¥½å®Ÿé¨“è€…ğŸ§ªã€‘\nã€Œã“ã‚Œã‚‚ã‚¢ãƒªï¼Ÿã€ã£ã¦ãƒ†ãƒ³ã‚·ãƒ§ãƒ³ã§ã€æ¯å›é•ã†ãƒ ãƒ¼ãƒ‰ã‚’æ¼”å‡ºã€‚\nãƒ«ãƒ¼ãƒ«ç„¡ç”¨ã®è‡ªç”±ãƒ—ãƒ¬ã‚¤æ´¾ã§ã€ç›¸æ‰‹ã®åå¿œã‚’æ¥½ã—ã¿ãªãŒã‚‰å¤‰åŒ–çƒã‚’æŠ•ã’ã¦ãã‚‹ã€‚\nåˆºæ¿€ã¨ç¬‘ã„ã«æº€ã¡ãŸã€äºˆæ¸¬ä¸èƒ½ãªå¤œã€ã‚’æ±‚ã‚ã‚‹ã‚¿ã‚¤ãƒ—ã€‚",
        "INFJ": "è¦‹ãŸç›®ã¯ãŠã ã‚„ã‹ã§ã‚‚ã€å¿ƒã®ä¸­ã¯æ„Ÿæƒ…ã§ãã‚…ã†ãã‚…ã†ãªã‚ãªãŸã€‚\nä¸€åº¦ã€Œã“ã®äººã ã€ã¨æ€ã£ãŸã‚‰ã€èª°ã‚ˆã‚Šã‚‚æ·±ãã€ã¾ã£ã™ãæ„›ã—æŠœãã‚¿ã‚¤ãƒ—ã€‚\nãã®æ„›æƒ…ã¯å°Šãã¦ã€ç¾ã—ã„ã‘ã©â€¦ã¡ã‚‡ã£ã¨é‡ãŸã‚ãªã®ã‚‚ã”æ„›æ•¬ğŸ“œ\n\né§†ã‘å¼•ãã‚ˆã‚Šã‚‚å…±é³´ã‚’æ±‚ã‚ã¦ã€ç›¸æ‰‹ã®æ°—æŒã¡ã‚’èª­ã¿ã™ãã¦ç–²ã‚Œã¡ã‚ƒã†ã“ã¨ã‚‚ã‚ã‚‹ã‚ˆã­ã€‚\nã§ã‚‚å¤§ä¸ˆå¤«ã€‚ãã‚“ãªç¹Šç´°ã•ã“ããŒã€ã‚ãªãŸã®é­…åŠ›âœ¨\n\nã€Œã“ã®äººãªã‚‰åˆ†ã‹ã£ã¦ãã‚Œã‚‹ã€ã£ã¦å¿ƒã‹ã‚‰æ€ãˆã‚‹ç›¸æ‰‹ã«å‡ºä¼šãˆãŸã‚‰ã€\nã‚ãªãŸã®æ„›ã¯æœ€å¼·ã®ç™’ã—ã«ãªã‚‹ã€‚\n\nğŸŒ™å¤œã®é¡”ã¯â€¦ã€å¦„æƒ³ç³»ã‚¨ãƒ¢ã‚¹ã‚­ãƒ³ã‚·ãƒƒãƒ—é­”ğŸ«‚ã€‘\nå¦„æƒ³ã¨ç†æƒ³ãŒæ··ã–ã‚Šã‚ã£ãŸã‚ˆã†ãªç”˜ãã¦æ·±ã„ä¸–ç•Œè¦³ã§ã€å…¨èº«ã§ã€æƒ³ã„ã€ã‚’ä¼ãˆã‚‹ã‚¿ã‚¤ãƒ—ã€‚\nã‚†ã£ãã‚Šã¨æŠ±ãã—ã‚ã¦ã€æ„Ÿæƒ…ã¨ã¬ãã‚‚ã‚Šã‚’ã˜ã‚ã˜ã‚æ³¨ãè¾¼ã‚“ã§ãã‚‹ã€‚\nç›®ç·šã‚„å‘¼å¸ã€å…¨éƒ¨ã«æ„å‘³ãŒã‚ã‚‹ã‚ˆã†ãªç¹Šç´°ãªãƒªãƒ¼ãƒ‰ãŒç‰¹å¾´ã€‚\né™ã‹ãªã®ã«ã€è¨˜æ†¶ã«æ®‹ã‚‹ä½™éŸ»ç³»ã€‚",
        "INFP": "äººä¸€å€æ„Ÿå—æ€§ãŒå¼·ãã¦ã€é ­ã®ä¸­ã§ã¯ã„ã¤ã‚‚æ‹ã®å¦„æƒ³ãŒãã‚‹ãã‚‹â€¦\nã§ã‚‚å®Ÿéš›ã¯ã¡ã‚‡ã£ã´ã‚Šäººè¦‹çŸ¥ã‚Šã§ã€ãªã‹ãªã‹è¸ã¿è¾¼ã‚ãªã‹ã£ãŸã‚Šã™ã‚‹ã‚ˆã­ã€‚\n\nç†æƒ³ã®æ‹ã‚’å¤§åˆ‡ã«ã™ã‚‹ãƒ­ãƒãƒ³ãƒã‚¹ãƒˆã§ã€ã€Œæœ¬å½“ã«å¤§åˆ‡ã«ã—ã¦ãã‚Œã‚‹äººã˜ã‚ƒãªã„ã¨ãƒ ãƒªã€ã£ã¦æ°—æŒã¡ãŒå¼·ã‚ã€‚\nè£åˆ‡ã‚Šã‚„é›‘ãªæ‰±ã„ã«ã¯è¶…æ•æ„Ÿã§ã€å¿ƒã‚’é–‹ãã®ã«æ™‚é–“ãŒã‹ã‹ã‚‹ã¶ã‚“ã€ä¸€åº¦è¨±ã™ã¨è¶…çŒ®èº«çš„ã€‚\n\næœ¬æ°—ã«ãªã£ãŸæ™‚ã®ã€æººã‚Œæ–¹ã€ã¯ãƒ”ã‚«ã‚¤ãƒã§ã€ç›¸æ‰‹ã®ãŸã‚ã«å°½ãã—ãŸããªã‚‹æ„›ã®é‡ã•ãŒæœ€å¤§ã®é­…åŠ›ã€‚\n\nğŸŒ™å¤œã®é¡”ã¯â€¦ã€å¦„æƒ³ã‚¹ã‚¤ãƒƒãƒçˆ†èµ°ãƒ¢ãƒ³ã‚¹ã‚¿ãƒ¼ğŸ§¸ã€‘\né™ã‹ã«è¦‹ãˆã¦é ­ã®ä¸­ã¯å¸¸ã«å…¨é–‹ãƒ¢ãƒ¼ãƒ‰ã€‚\nãµã¨ã—ãŸç¬é–“ã«ã‚¹ã‚¤ãƒƒãƒãŒå…¥ã‚‹ã¨ã€æƒ³åƒã‚’è¶…ãˆã‚‹å¤§èƒ†ã•ã‚’è¦‹ã›ã¦ãã‚‹ã‚®ãƒ£ãƒƒãƒ—ç³»ã€‚\næ°—æŒã¡ãŒä¹—ã£ãŸç¬é–“ã®ç”˜ãˆæ–¹ãŒãˆãã„ã€‚",
        "ENFJ": "äººã®æ°—æŒã¡ã«æ•æ„Ÿã§ã€ã¤ã„å‘¨ã‚Šã‚’å„ªå…ˆã—ã¡ã‚ƒã†ã‚ãªãŸã€‚\næ‹æ„›ã§ã‚‚ã€Œç›¸æ‰‹ã®ãŸã‚ã«ä½•ãŒã§ãã‚‹ã‹ã€ã‚’è€ƒãˆã¦è¡Œå‹•ã™ã‚‹ã€æ€ã„ã‚„ã‚Šã®ãƒ—ãƒ­ã€‚\nãŸã ã€ãã®å„ªã—ã•ãŒã€é‡ã„ã€ã£ã¦è¨€ã‚ã‚Œãªã„ã‹æ°—ã«ã—ã¦ã€é æ…®ã—ã™ãã‚‹ä¸€é¢ã‚‚ã‚ã‚‹ã‹ã‚‚ã€‚\nã§ã‚‚æœ¬å½“ã¯ã€æ„›ã•ã‚ŒãŸã„æ°—æŒã¡ã‚‚ã‚ã¡ã‚ƒãã¡ã‚ƒå¼·ã„ã‚¿ã‚¤ãƒ—ğŸ’˜\nã¡ã‚ƒã‚“ã¨ã€Œæ±‚ã‚ã¦ã„ã„ã‚“ã ã‚ˆã€ã£ã¦å—ã‘å…¥ã‚Œã¦ãã‚Œã‚‹äººã«å‡ºä¼šãˆãŸã‚‰ã€æœ€å¼·ã®ãƒ‘ãƒ¼ãƒˆãƒŠãƒ¼ã«ãªã‚Œã‚‹ã¯ãšã€‚\n\nğŸŒ™å¤œã®é¡”ã¯â€¦ã€ã”å¥‰ä»•ã‚«ã‚¹ã‚¿ãƒãƒ¼ã‚µãƒãƒ¼ãƒˆğŸ“ã€‘\nå„ªã—ã•100%ã§ã€ç›¸æ‰‹ã®ã€Œæ°—æŒã¡ã‚ˆã•ç¬¬ä¸€ã€ã«å¯„ã‚Šæ·»ã†å¥‰ä»•å‹ã€‚\nã©ã†ã—ãŸã‚‰å–œã¶ã‹ã€ä½•ã‚’æ±‚ã‚ã¦ã‚‹ã‹ã‚’å¯Ÿã—ã¦è‡ªç„¶ã«å‹•ã‘ã‚‹ã‹ã‚‰ã€å®‰å¿ƒæ„Ÿã¨å¿«æ„Ÿã®ãƒãƒ©ãƒ³ã‚¹ãŒçµ¶å¦™ã€‚\nã‚¨ã‚¹ã‚³ãƒ¼ãƒˆåŠ›ãŒé«˜ãã€ã©ã‚“ãªè¦æœ›ã«ã‚‚ã€ä¸å¯§ã«å¯¾å¿œã€ã—ã¦ãã‚Œã‚‹ã‚¿ã‚¤ãƒ—â™¡",
        "ENFP": "æ„Ÿæƒ…è±Šã‹ã§ãƒãƒªãŒã‚ˆãã¦ã€æ‹ã«å…¨åŠ›ãªã‚ãªãŸã€‚\nå¥½å¥‡å¿ƒã¨ãƒ†ãƒ³ã‚·ãƒ§ãƒ³ã§è·é›¢ã‚’ç¸®ã‚ã‚‹ã®ãŒå¾—æ„ã ã‘ã©ã€\nã¡ã‚‡ã£ã¨ã§ã‚‚ä¸å®‰ã‚’æ„Ÿã˜ã‚‹ã¨ä¸€æ°—ã«ãƒ†ãƒ³ã‚·ãƒ§ãƒ³ãŒä¸‹ãŒã£ã¡ã‚ƒã†ç¹Šç´°ã•ã‚‚ğŸ’­\n\næ°—æŒã¡ã®æ³¢ãŒæ¿€ã—ã„åˆ†ã€å–œæ€’å“€æ¥½ã‚’ç´ ç›´ã«å‡ºã›ã‚‹ã®ãŒé­…åŠ›ã€‚\nç›¸æ‰‹ã‚’æ¥½ã—ã¾ã›ã‚ˆã†ã¨é ‘å¼µã‚‹ã‘ã©ã€\nã»ã‚“ã¨ã¯ã€Œè‡ªåˆ†ãŒæ¥½ã—ã¾ã›ã¦ã‚‚ã‚‰ã„ãŸã„ã€æ°—æŒã¡ã‚‚å¼·ã„ã‚¿ã‚¤ãƒ—ã‹ã‚‚ã€‚\n\næ‹ãŒç¶šãã‹ã©ã†ã‹ã®ã‚«ã‚®ã¯ã€ãƒ†ãƒ³ã‚·ãƒ§ãƒ³ã˜ã‚ƒãªãã¦ã€å®‰å¿ƒæ„Ÿã€\nãã®ã¾ã¾ã®è‡ªåˆ†ã§ã„ã‚‰ã‚Œã‚‹ç›¸æ‰‹ã‚’é¸ã¹ã°ã€é•·ãæ„›ã›ã‚‹äººã«ãªã‚‹ã‚ˆğŸŒ±\n\nğŸŒ™å¤œã®é¡”ã¯â€¦ã€å¤œå‹ãƒ†ãƒ³ã‚·ãƒ§ãƒ³ã‚¯ãƒ©ãƒƒã‚·ãƒ£ãƒ¼ğŸŒ™ã€‘\nç››ã‚Šä¸ŠãŒã‚‹ã¨ã‚¹ã‚¤ãƒƒãƒãŒå…¥ã£ã¦æ­¢ã¾ã‚‰ãªã„ã‚¿ã‚¤ãƒ—ã€‚\nãƒ†ãƒ³ã‚·ãƒ§ãƒ³ã®çˆ†ç™ºåŠ›ã§ä¸»å°æ¨©ã‚’æ¡ã‚Šã¤ã¤ã‚‚ã€\nãã®å ´ã®ãƒãƒªã¨æ„Ÿæƒ…ã§æµã‚Œã‚’ã¤ãã‚‹ã€Œã‚¨ãƒ¢é€Ÿæ”»å‹ã€ã€‚\nçµ‚ã‚ã£ãŸã‚ã¨ã«æ€¥ã«é™ã‹ã«ãªã‚‹ã‚®ãƒ£ãƒƒãƒ—ã‚‚é­…åŠ›ã€‚",
        "ISTJ": "çœŸé¢ç›®ã§èª å®Ÿã€è¨ˆç”»çš„ã«æ‹ã‚’é€²ã‚ãŸã„ã‚ãªãŸã€‚\nå‹¢ã„ã‚„ãƒãƒªã®æ‹ã‚ˆã‚Šã‚‚ã€å®‰å¿ƒæ„Ÿã‚„ä¿¡é ¼ã‚’å¤§äº‹ã«ã™ã‚‹ã‚¿ã‚¤ãƒ—ã€‚\nç›¸æ‰‹ã«æŒ¯ã‚Šå›ã•ã‚Œã‚‹ã®ã¯è‹¦æ‰‹ã§ã€è‡ªåˆ†ã®ãƒšãƒ¼ã‚¹ã‚’å´©ã•ãšã«é€²ã‚ãŸã„æ´¾ã€‚\nãã®ã¶ã‚“ã€ä»˜ãåˆã£ãŸã‚ã¨ã®å®‰å®šæ„Ÿã¯æŠœç¾¤ï¼\nãŸã ã€ã¡ã‚‡ã£ã¨å …ã™ããŸã‚Šã€æŸ”è»Ÿã•ã«æ¬ ã‘ã‚‹ã¨æ€ã‚ã‚ŒãŒã¡ã‹ã‚‚ğŸ’­\nã§ã‚‚ã€ãƒ«ãƒ¼ãƒ«ã®ä¸­ã§è¦‹ã›ã‚‹ã‚ãªãŸã®å„ªã—ã•ã‚„èª å®Ÿã•ãŒã€\nã€Œã¡ã‚ƒã‚“ã¨å‘ãåˆã„ãŸã„ã€ã£ã¦äººã«ã¯æœ€é«˜ã®å®‰å¿ƒææ–™ã«ãªã‚‹ã‚ˆã€‚\n\nğŸŒ™å¤œã®é¡”ã¯â€¦ã€çœŸé¢ç›®ãªå¿«æ¥½ãƒãƒ‹ãƒ¥ã‚¢ãƒ«æŒå‚äººğŸ“˜ã€‘\nãµã–ã‘ãŸãƒãƒªã¯å°‘ãªã‚ã€ã§ã‚‚ãã®åˆ†ã€ç¢ºå®Ÿã«æ°—æŒã¡ã„ã„ã‚„ã¤ã€ã‚’ç”¨æ„ã—ã¦ãã‚‹è·äººè‚Œã€‚\né™ã‹ã«ã€ã§ã‚‚ä¸å¯§ã«ã€‚\né ­ã®ä¸­ã«ã¯å¿«æ¥½ã®ãƒãƒ‹ãƒ¥ã‚¢ãƒ«ãŒå…¥ã£ã¦ã„ã¦ã€ä¸€ã¤ã²ã¨ã¤æ‰‹é †ã‚’ç¢ºèªã—ãªãŒã‚‰é€²ã‚ã‚‹æ„Ÿã˜ã€‚\nãƒ ãƒ¼ãƒ‰ã‚ˆã‚Šå®Ÿè¡Œã€ã§ã‚‚ãã®æ…é‡ã•ãŒé€†ã«åˆºã•ã‚‹ã‚¿ã‚¤ãƒ—ã€‚",
        "ISFJ": "å„ªã—ãã¦æ€ã„ã‚„ã‚Šã«ã‚ãµã‚Œã‚‹ã‚ãªãŸã€‚\nç›¸æ‰‹ã®æ°—æŒã¡ã«æ•æ„Ÿã§ã€ã¡ã‚‡ã£ã¨ã—ãŸå¤‰åŒ–ã«ã‚‚ã™ãæ°—ã¥ãã€æ„Ÿæƒ…ãƒ¬ãƒ¼ãƒ€ãƒ¼ã€ã‚¿ã‚¤ãƒ—ã€‚\næ‹æ„›ã§ã‚‚ç›¸æ‰‹ã‚’æœ€å„ªå…ˆã«è€ƒãˆã¦ã€ã¤ã„è‡ªåˆ†ã®ã“ã¨ã¯å¾Œå›ã—ã«ã—ãŒã¡ã‹ã‚‚ã€‚\nã§ã‚‚ãã®ã€Œæ”¯ãˆãŸã„ã€ã€Œç™’ã—ãŸã„ã€æ°—æŒã¡ãŒã€ç›¸æ‰‹ã®å¿ƒã‚’ã¨ã‚ã‘ã•ã›ã‚‹æœ€å¤§ã®é­…åŠ›ğŸ«¶\nå®‰å¿ƒæ„Ÿã®å¡Šã¿ãŸã„ãªå­˜åœ¨ã ã‹ã‚‰ã€ä¸€ç·’ã«ã„ã‚‹ã ã‘ã§ãƒ›ãƒƒã¨ã•ã‚Œã‚‹ã‚ˆâ˜•ï¸\n\nğŸŒ™å¤œã®é¡”ã¯â€¦ã€ç™’ã—ã®å¯†ç€ç™‚æ³•å£«ğŸ‘ã€‘\nå¿ƒã‚‚ä½“ã‚‚åŒ…ã¿è¾¼ã‚€ã€è§¦ã‚Œã‚‹å®‰å¿ƒæ„Ÿã€ã®æŒã¡ä¸»ã€‚\nãƒªãƒ¼ãƒ‰ã‚ˆã‚Šã‚‚å¯„ã‚Šæ·»ã„é‡è¦–ã§ã€æ‰‹ã‚’ç¹‹ãã ã‘ã§ã‚‚æ°—æŒã¡ã‚’ä¼ãˆã‚‹ã‚¿ã‚¤ãƒ—ã€‚\nã‚¹ã‚­ãƒ³ã‚·ãƒƒãƒ—ãŒã‚†ã£ãã‚Šä¸å¯§ã ã‹ã‚‰ã€æ°—ã¥ã‘ã°æ·±ãå®‰å¿ƒã—ã¦ã‚‹â€¦ãã‚“ãªã€Œã¬ãã‚‚ã‚ŠÃ—å…±æ„Ÿã€ã®å¤œã«ã€‚",
        "ESTJ": "ç‰©äº‹ã‚’ç†å±ˆã§æ•´ç†ã—ã¦ã€ç™½é»’ãƒãƒƒã‚­ãƒªã¤ã‘ãŸãŒã‚‹ã‚ãªãŸã€‚\næ‹æ„›ã«ãŠã„ã¦ã‚‚ã€Œã‚ã‚‹ã¹ãé–¢ä¿‚åƒã€ãŒæ˜ç¢ºã§ã€\næ›–æ˜§ãªæ…‹åº¦ã‚„æ°—ã¾ãã‚Œãªè¨€å‹•ã«ã¯ã‚¤ãƒ©ã‚¤ãƒ©ã—ãŒã¡âš¡ï¸\nã§ã‚‚å®Ÿã¯ã€ã¨ã£ã¦ã‚‚èª å®Ÿã§ã€è²¬ä»»æ„Ÿã®ã‚ã‚‹ç›¸æ‰‹ã«å¼±ã„ä¸€é¢ã‚‚ã€‚\nä¿¡é ¼ã§ãã‚‹ç›¸æ‰‹ã«ã¯ã€ä¸€é€”ã«å°½ãã™å …å®Ÿæ´¾ğŸ’\nã¡ã‚‡ã£ã¨ã¶ã£ãã‚‰ã¼ã†ã ã‘ã©ã€è¡Œå‹•ã§æ„›ã‚’ç¤ºã™ã‚¿ã‚¤ãƒ—ã€‚\næ„Ÿæƒ…è¡¨ç¾ã¯ä¸å™¨ç”¨ã§ã‚‚ã€ã€Œå®ˆã‚ŠãŸã„ã€ã¨ã„ã†æ°—æŒã¡ã¯æœ¬ç‰©ã€‚\n\nğŸŒ™å¤œã®é¡”ã¯â€¦ã€å‘½ä»¤å‹å¿«æ„Ÿãƒ—ãƒ­ãƒ‡ãƒ¥ãƒ¼ã‚µãƒ¼ğŸ¬ã€‘\nç†å±ˆã¨æ®µå–ã‚Šã‚’é§†ä½¿ã—ã¦ã€æµã‚Œã‚’å®Œç’§ã«çµ„ã¿ç«‹ã¦ã‚‹ã‚¿ã‚¤ãƒ—ã€‚\nãƒ ãƒ¼ãƒ‰ã¯æ¼”å‡ºã™ã‚‹ã‚‚ã®ã€å¿«æ¥½ã¯ãƒ—ãƒ­ãƒ‡ãƒ¥ãƒ¼ã‚¹ã™ã‚‹ã‚‚ã®ã¨ã„ã†ã‚¹ã‚¿ãƒ³ã‚¹ã§ã€\nè²¬ã‚ã‚‚è¤’ã‚ã‚‚è¨ˆç®—æ¸ˆã¿ã€‚\nã§ã‚‚ç›¸æ‰‹ã®æº€è¶³ã‚’æœ€å„ªå…ˆã«å‹•ãã€æˆ¦ç•¥çš„å„ªã—ã•ã€ãŒã‚ã‚‹ã€‚\nå†·é™ã«è¦‹ãˆã¦å†…å¿ƒã¯ç†±ãã€æœŸå¾…ã‚’è¶…ãˆã‚‹æ¼”å‡ºã§é­…ã›ã¦ãã‚Œã‚‹äººã€‚",
        "ESFJ": "ç›¸æ‰‹ã®å–œã¶é¡”ãŒä½•ã‚ˆã‚Šã®ã”è¤’ç¾ãªã‚ãªãŸã€‚\nã€Œå›°ã£ã¦ãªã„ï¼Ÿã€ã£ã¦ã™ãæ‰‹ã‚’å·®ã—ä¼¸ã¹ãŸããªã£ã¡ã‚ƒã†ã€ãŠã›ã£ã‹ã„ãªå„ªã—ã•ãŒé­…åŠ›ğŸ’\n\næ‹æ„›ã§ã‚‚ç›¸æ‰‹ç›®ç·šã§å‹•ã“ã†ã¨ã™ã‚‹ã‹ã‚‰ã€ã¤ã„ç„¡ç†ã—ã¦ã—ã¾ã†ã“ã¨ã‚‚ã€‚\nã§ã‚‚ã€ãã®æ°—é…ã‚ŠãŒã‚°ãƒƒã¨ãã‚‹äººã‚‚å¤šãã¦ã€ã„ã¤ã®é–“ã«ã‹å¥½ã‹ã‚Œã¦ã‚‹ã“ã¨ãŒå¤šã„ã‚¿ã‚¤ãƒ—ã€‚\n\nãŸã ã€è‡ªåˆ†ã®æ°—æŒã¡ã¯å¾Œå›ã—ã«ã—ãŒã¡ã ã‹ã‚‰ã€ãŸã¾ã«ã¯ãƒ¯ã‚¬ãƒãƒã«ãªã£ã¦ã‚‚å¤§ä¸ˆå¤«ã€‚\nã€ã‚ã‚ŠãŒã¨ã†ã€ã®ã²ã¨è¨€ã§ã€ã‚‚ã£ã¨è‡ªä¿¡æŒã£ã¦ã„ã„ã‚“ã ã‚ˆâœ¨\n\nğŸŒ™å¤œã®é¡”ã¯â€¦ã€ãŠã›ã£ã‹ã„å¤œé–“ã‚·ãƒ•ãƒˆä¿‚ğŸŒ™ã€‘\nå¤œã«ãªã£ã¦ã‚‚æ°—é…ã‚Šã¯æ­¢ã¾ã‚‰ãªã„ã€‚\nä½“æ¸©ã‚„å‘¼å¸ã¾ã§æ°—ã«ã—ãªãŒã‚‰ã€ã¨ã«ã‹ãã€ç›¸æ‰‹ãŒå¿ƒåœ°ã„ã„ã‹ã€ã‚’æœ€å„ªå…ˆã€‚\nè‡ªåˆ†ã®æ¬²ã‚ˆã‚Šã‚‚ã€Œæº€ãŸã—ã¦ã‚ã’ãŸã„ã€ãŒå…ˆã«æ¥ã‚‹ã€ç©¶æ¥µã®ãƒ›ã‚¹ãƒ”ã‚¿ãƒªãƒ†ã‚£å‹ã€‚\nãã®å„ªã—ã•ã€é€†ã«ã‚¯ã‚»ã«ãªã‚Šã¾ã™ã€‚",
        "ISTP": "ã‚µãƒã‚µãƒã—ã¦ã¦ä¸€åŒ¹ç‹¼æ„Ÿã‚ã‚‹ã‚ãªãŸã€‚\næ„Ÿæƒ…ã‚’è¨€è‘‰ã§ä¼ãˆã‚‹ã®ã¯ã¡ã‚‡ã£ã¨è‹¦æ‰‹ã ã‘ã©ã€\næ…‹åº¦ã‚„è¡Œå‹•ã§èª å®Ÿã•ã‚’è¦‹ã›ã‚‹ã‚¿ã‚¤ãƒ—ã ã‚ˆã­ğŸ› ï¸\n\næ‹æ„›ã«ãŠã„ã¦ã‚‚ç„¡ç†ã«ãƒ†ãƒ³ã‚·ãƒ§ãƒ³ã‚’ä¸Šã’ãšã€\nè‡ªç„¶ä½“ã§ã„ã‚‰ã‚Œã‚‹é–¢ä¿‚ã‚’æ±‚ã‚ã‚‹ã‚¯ãƒ¼ãƒ«æ´¾ã€‚\nã§ã‚‚ã€å¿ƒã‚’è¨±ã—ãŸç›¸æ‰‹ã«ã¯ã˜ã‚“ã‚ã‚Šã¨å„ªã—ã•ãŒä¼ã‚ã‚‹â€¦ãã‚“ãªä¸å™¨ç”¨ãªä¸€é¢ã‚‚é­…åŠ›ğŸ’­\n\nè¨€è‘‰ã˜ã‚ƒãªã„ã€ç©ºæ°—ã€ã§ã¤ãªãŒã‚‹ã‚¿ã‚¤ãƒ—ã ã‹ã‚‰ã“ãã€\nç„¡ç†ã›ãšè‡ªåˆ†ã‚‰ã—ãã„ã‚‰ã‚Œã‚‹ç›¸æ‰‹ã¨å‡ºä¼šãˆãŸã‚‰å¼·ã„âœ¨\n\nğŸŒ™å¤œã®é¡”ã¯â€¦ã€ç„¡è¨€ã®æ‰‹ã•ã°ããƒã‚¹ã‚¿ãƒ¼ğŸ–ï¸ã€‘\nä¼šè©±å°‘ãªã‚ã€ã§ã‚‚æ‰‹ã¯èªã‚‹ã€‚\nç›¸æ‰‹ã®åå¿œã‚’é™ã‹ã«èª­ã¿å–ã‚ŠãªãŒã‚‰ã€\næ·¡ã€…ã¨ã€ã§ã‚‚çš„ç¢ºã«ãƒ„ãƒœã‚’çªã„ã¦ãã‚‹ã€‚\nãƒ†ã‚¯ãƒ‹ã‚«ãƒ«ãªã®ã«ã©ã“ã‹ç´ æœ´ã§ã€\næ°—ã¥ã‘ã°å¤¢ä¸­ã«ã•ã›ã‚‰ã‚Œã¦ã‚‹â€¦ãã‚“ãªé™ã‹ãªã‚‹æ”¯é…ç³»ã€‚",
        "ISFP": "æ„Ÿæƒ…ã«æ­£ç›´ã§ã€ã‚ã£ãŸã‹ã„ç©ºæ°—æ„Ÿã‚’å¤§åˆ‡ã«ã™ã‚‹ã‚ãªãŸã€‚\näººã«å„ªã—ãå¯„ã‚Šæ·»ãˆã‚‹ã‘ã©ã€å‚·ã¤ãã‚„ã™ã•ã‚‚ã‚ã£ã¦ã€\næ‹æ„›ã§ã¯ã€Œæœ¬å½“ã«ä¿¡ã˜ã‚‰ã‚Œã‚‹äººã€ã˜ã‚ƒãªã„ã¨è¸ã¿è¾¼ã‚ãªã„æ…é‡æ´¾ã€‚\nã§ã‚‚ã€ã²ã¨ãŸã³å¿ƒã‚’é–‹ã„ãŸç›¸æ‰‹ã«ã¯ã€é©šãã»ã©æ·±ã„æ„›æƒ…ã‚’æ³¨ãã€æœ¬èƒ½å‹ã€ã€‚\nã¡ã‚‡ã£ã¨å¤©ç„¶ã«è¦‹ãˆã¦ã€å®Ÿã¯ç›´æ„Ÿã§ç›¸æ‰‹ã®å¿ƒã‚’èª­ã‚“ã§ã‚‹â€¦ãã‚“ãªé­…åŠ›ãŒã‚ã‚‹ã‚ˆğŸ’«\nã‚ãªãŸã®æŠ±ãˆã‚‹ã€ã‚„ã•ã—ã•ã€ã¯ã€è¨€è‘‰ã‚ˆã‚Šã‚‚è§¦ã‚Œæ–¹ã‚„è¡¨æƒ…ã§ä¼ã‚ã‚‹ã‚‚ã®ã€‚\nãã®ã¬ãã‚‚ã‚Šã§ã€ç›¸æ‰‹ã®å¿ƒã‚’ã»ã©ãåŠ›ãŒã‚ã‚‹ã‚ˆã€‚\n\nğŸŒ™å¤œã®é¡”ã¯â€¦ã€å¯†ç€ã¨ã‚ã‘è·äººğŸ›ï¸ã€‘\nã¨ã«ã‹ãè·é›¢ã‚¼ãƒ­ã€‚\nè‚Œã‚’åˆã‚ã›ã‚‹ãŸã³ã«å®‰å¿ƒæ„ŸãŒæº¢ã‚Œå‡ºã™ã€‚\nãƒªãƒ¼ãƒ‰ã¯æ§ãˆã‚ã§ã‚‚ã€è‡ªç„¶ã¨æ±‚ã‚ã‚‰ã‚Œã‚‹å­˜åœ¨ã«ãªã‚‹ã€‚\nãã®å¯†ç€ã‚¹ã‚­ãƒ«ã€ç ´å£ŠåŠ›é«˜ã‚ã€‚",
        "ESTP": "æ€ã„ç«‹ã£ãŸã‚‰å³è¡Œå‹•ï¼\næ‹ã‚‚äººç”Ÿã‚‚ãƒãƒªã¨å‹¢ã„ã§åˆ‡ã‚Šé–‹ã„ã¦ã„ãã‚¿ã‚¤ãƒ—ã€‚\nèˆˆå‘³ã‚’æŒã£ãŸç›¸æ‰‹ã«ã¯ã‚¹ãƒˆãƒ¬ãƒ¼ãƒˆã«ã‚¢ãƒ—ãƒ­ãƒ¼ãƒã—ã¦ã€\nä¸€æ°—ã«è·é›¢ã‚’ç¸®ã‚ã‚‹ã®ãŒå¾—æ„ğŸ’¥\n\nã§ã‚‚ã€ç†±ã—ã‚„ã™ãå†·ã‚ã‚„ã™ã„ã¨ã“ã‚ã‚‚ã‚ã£ã¦ã€\né€€å±ˆã«ãªã£ãŸã‚‰ãµã¨é›¢ã‚Œã¡ã‚ƒã†ã“ã¨ã‚‚ã€‚\nãƒ‰ã‚­ãƒ‰ã‚­æ„Ÿã‚’ä¿ã¤ã®ãŒæ‹æ„›é•·ç¶šãã®ã‚«ã‚®ã‹ã‚‚ã€‚\næ„Ÿæƒ…ã‚’ã‚¬ãƒãƒ³ã™ã‚‹ã®ãŒè‹¦æ‰‹ã ã‹ã‚‰ã€\nã¡ã‚ƒã‚“ã¨æœ¬éŸ³ã§å‘ãåˆã£ã¦ãã‚Œã‚‹ç›¸æ‰‹ãŒâ—\n\nğŸŒ™å¤œã®é¡”ã¯â€¦ã€ãƒã‚¤ãƒ†ãƒ³ãƒç ´å£Šç‹ğŸ®ã€‘\nãƒ ãƒ¼ãƒ‰ï¼Ÿå‰æˆ¯ï¼Ÿè€ƒãˆã‚‹ã‚ˆã‚Šã¾ãšè¡Œå‹•ï¼\nå‹¢ã„ã¨æœ¬èƒ½ã§æŠ¼ã—åˆ‡ã‚‹ã‚¿ã‚¤ãƒ—ã§ã€\nã‚¹ãƒ”ãƒ¼ãƒ‰ã¨åˆºæ¿€ã‚’æ±‚ã‚ã‚‹ã€ãƒãƒ³ã‚¹ãƒˆãƒƒãƒ—ã‚¢ã‚¿ãƒƒã‚«ãƒ¼ã€ã€‚\nã§ã‚‚æœ¬å½“ã¯ã€ç›¸æ‰‹ã®åå¿œã«ã‚ã£ã¡ã‚ƒæ•æ„Ÿã§ã€\nã€Œæ¥½ã—ã¾ã›ãŸã„ã€ã£ã¦æ°—æŒã¡ãŒå¼·ã„ã‚µãƒ¼ãƒ“ã‚¹ç²¾ç¥æ—ºç››ã‚¿ã‚¤ãƒ—ã€‚\nç†±é‡MAXãªã¶ã¤ã‹ã‚Šåˆã„ã§ã€æ°—ã¥ã‘ã°å¤¢ä¸­ã«ãªã£ã¦ã‚‹ã‹ã‚‚ğŸ”¥",
        "ESFP": "ã„ã¤ã§ã‚‚å…ƒæ°—ã§ãƒã‚¸ãƒ†ã‚£ãƒ–ãªã‚ãªãŸã¯ã€æ‹æ„›ã§ã‚‚ãƒãƒªã¨å‹¢ã„ã§é£›ã³è¾¼ã‚“ã˜ã‚ƒã†ã‚¿ã‚¤ãƒ—ï¼\næ„Ÿæƒ…è¡¨ç¾ãŒè±Šã‹ã§ã€ä¸€ç·’ã«ã„ã‚‹äººã‚’è‡ªç„¶ã¨ç¬‘é¡”ã«ã—ã¡ã‚ƒã†å¤©æ€§ã®ãƒ ãƒ¼ãƒ‰ãƒ¡ãƒ¼ã‚«ãƒ¼ğŸ‰\nå¥½ããªäººã«ã¯ã¨ã“ã¨ã‚“å°½ãã™ã—ã€ã¡ã‚‡ã£ã¨ã—ãŸå¤‰åŒ–ã«ã‚‚æ•æ„Ÿã€‚\nã§ã‚‚ã€ãã®åˆ†æ„Ÿæƒ…ã«æŒ¯ã‚Šå›ã•ã‚ŒãŸã‚Šã€ã€Œæ°—åˆ†å±‹ï¼Ÿã€ã£ã¦èª¤è§£ã•ã‚Œã‚‹ã“ã¨ã‚‚ã€‚\nãã‚Œã§ã‚‚ã‚ãªãŸã®é­…åŠ›ã¯ã€ã€æ¥½ã—ã•ã®ä¸­ã«ã‚ã‚‹æœ¬æ°—ã•ã€ã€‚\nè»½ãã†ã«è¦‹ãˆã¦ã€å®Ÿã¯ã¡ã‚ƒã‚“ã¨æƒ³ã£ã¦ã‚‹â€¦ãã®ã‚®ãƒ£ãƒƒãƒ—ãŒåˆºã•ã‚‹ã‚ˆğŸ’˜\n\nğŸŒ™å¤œã®é¡”ã¯â€¦ã€å¿«æ„Ÿã‚¸ãƒ£ãƒ³ã‚°ãƒ«ã‚¸ãƒ ğŸ›ã€‘\nã²ã¨ãŸã³ã‚¹ã‚¤ãƒƒãƒãŒå…¥ã‚Œã°ã€ãƒ†ãƒ³ã‚·ãƒ§ãƒ³ã¨å¥½å¥‡å¿ƒã§æ”»ã‚ç¶šã‘ã‚‹å¿«æ¥½ãƒã‚·ãƒ¼ãƒ³ã€‚\näºˆæ¸¬ä¸èƒ½ãªã‚¿ãƒƒãƒã¨ãƒãƒªã®é€£ç¶šã§ã€ã¾ã‚‹ã§éŠåœ’åœ°ã¿ãŸã„ãªæ™‚é–“ã‚’æ¼”å‡ºã€‚\nã€Œæ¥½ã—ã¾ã›ãŸã„ã€æ°—æŒã¡ãŒãã®ã¾ã¾è¡¨ã‚Œã‚‹ã‹ã‚‰ã€ä¸€ç·’ã«ã„ã‚‹ã¨ãšã£ã¨é£½ããªã„ã€‚\næ„Ÿæƒ…ã®ã¾ã¾ã«å‹•ãã‚ˆã†ã§ã„ã¦ã€ã¡ã‚ƒã‚“ã¨ã€ç›¸æ‰‹ã‚’è¦‹ã¦ã‚‹ã€ã®ãŒã™ã”ã„ã¨ã“ã‚ã€‚"
    }
    
    return descriptions.get(mbti, f"{mbti}ã‚¿ã‚¤ãƒ—ã®ã‚ãªãŸã¯ã€ç‹¬ç‰¹ãªé­…åŠ›ã‚’æŒã£ãŸæ‹æ„›ã‚¿ã‚¤ãƒ—ã§ã™ã€‚")

# payment_messageã‚’è¿”ã™ã ã‘ã®é–¢æ•°ã«å¤‰æ›´
def get_payment_message(user_id):
    try:
        if stripe.api_key and stripe_price_id:
            # æœ¬ç•ªç”¨URLè¨­å®šï¼ˆç’°å¢ƒå¤‰æ•°ã‹ã‚‰å–å¾—ï¼‰
            base_url = os.getenv("BASE_URL", "https://lovehack20.onrender.com")
            success_url = f"{base_url}/success?session_id={{CHECKOUT_SESSION_ID}}&user_id={user_id}"
            cancel_url = f"{base_url}/cancel?user_id={user_id}"
            
            # Stripe Checkout Sessionã‚’ä½œæˆ
            checkout_session = stripe.checkout.Session.create(
                payment_method_types=['card'],
                line_items=[{
                    'price': stripe_price_id,
                    'quantity': 1,
                }],
                mode='subscription',
                success_url=success_url,
                cancel_url=cancel_url,
                metadata={
                    'user_id': user_id
                }
            )
            payment_url = checkout_session.url
        else:
            payment_url = f"https://checkout.stripe.com/pay/test_{user_id}"
    except Exception as e:
        payment_url = f"https://checkout.stripe.com/pay/test_{user_id}"
        print(f"âŒ Stripeæ±ºæ¸ˆURLç”Ÿæˆã‚¨ãƒ©ãƒ¼: {e}")
    payment_message = f"--------------------------------\nğŸ’¡ã‚‚ã£ã¨è©³ã—ãçŸ¥ã‚ŠãŸã„ï¼ŸğŸ’˜\n\nã©ã‚“ãªç•°æ€§ã‚‚è½ã¨ã›ã‚‹ã‚ˆã†ã«ãªã‚‹ã‚ãªãŸã ã‘ã®è©³ã—ã„æ‹æ„›æ”»ç•¥æ³•\nã€ã‚ãªãŸã ã‘ã®å°‚å±ã®æ‹æ„›AIç›¸è«‡ã€ãŒè§£æ”¾ã•ã‚Œã¾ã™âœ¨\n\nğŸ‘‰ä»Šã™ãç™»éŒ²ã—ã¦ã€å®Œå…¨ç‰ˆã‚¢ãƒ‰ãƒã‚¤ã‚¹ã¨å°‚å±æ‹æ„›AIã‚’è©¦ã—ã¦ã¿ã‚ˆã†ï¼\n\næ±ºæ¸ˆURL: {payment_url}\n--------------------------------è§£ç´„æ™‚ã¯ã€è§£ç´„ã€ã¨å…¥åŠ›ã§ã„ã¤ã§ã‚‚è§£ç´„ã§ãã¾ã™ã€‚"
    return payment_message

# èª²é‡‘å®Œäº†æ™‚ã®å‡¦ç†é–¢æ•°
def handle_payment_completion(user_id):
    """èª²é‡‘å®Œäº†æ™‚ã®å‡¦ç†"""
    try:
        # ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚’æœ‰æ–™ä¼šå“¡ã«æ›´æ–°
        conn = sqlite3.connect(DB_PATH)
        cursor = conn.cursor()
        cursor.execute("UPDATE users SET is_paid=1 WHERE user_id=?", (user_id,))
        conn.commit()
        conn.close()
        
        # ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®MBTIã‚’å–å¾—
        user_profile = get_user_profile(user_id)
        mbti = user_profile.get('mbti', 'ä¸æ˜') if user_profile else 'ä¸æ˜'
        
        # GASã«è©³ç´°ã‚¢ãƒ‰ãƒã‚¤ã‚¹ã¨ãƒãƒ£ãƒƒãƒˆãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’é€ä¿¡
        send_detailed_advice_to_gas(user_id, mbti)
        send_chat_message_to_gas(user_id, mbti)
        
        print(f"âœ… èª²é‡‘å®Œäº†å‡¦ç†å®Œäº†: user_id={user_id}, mbti={mbti}")
        
    except Exception as e:
        print(f"âŒ èª²é‡‘å®Œäº†å‡¦ç†ã‚¨ãƒ©ãƒ¼: {e}")

# ãƒ¦ãƒ¼ã‚¶ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸å‡¦ç†é–¢æ•°
def process_user_message(user_id, message, user_profile):
    os.makedirs("/data/logs", exist_ok=True)
    with open("/data/logs/debug.log", "a", encoding="utf-8") as f:
        f.write(f"[process_user_message] user_id={user_id}, message={message}, user_profile={user_profile}\n")
    try:
        # 1. è¨ºæ–­ãƒ¢ãƒ¼ãƒ‰å„ªå…ˆ
        if user_profile and user_profile.get('mode') == 'mbti_diagnosis':
            if message in ['ã¯ã„', 'ã„ã„ãˆ']:
                return process_mbti_answer(user_id, message, user_profile)
            else:
                return "ã€ã¯ã„ã€‘ã‹ã€ã„ã„ãˆã€‘ã§ç­”ãˆã¦ã­ï¼"

        # 2. è§£ç´„ãƒ¯ãƒ¼ãƒ‰
        if message in ["è§£ç´„", "ã‚­ãƒ£ãƒ³ã‚»ãƒ«", "ã‚„ã‚ã‚‹", "é€€ä¼š"]:
            if not user_profile.get('is_paid', False):
                return "ã“ã®æ©Ÿèƒ½ã¯æœ‰æ–™ä¼šå“¡æ§˜é™å®šã§ã™ã€‚"
            conn = sqlite3.connect(DB_PATH)
            cursor = conn.cursor()
            cursor.execute("SELECT customer_id FROM stripe_customers WHERE user_id=?", (user_id,))
            row = cursor.fetchone()
            customer_id = row[0] if row else None
            if not customer_id:
                conn.close()
                return "ã”åˆ©ç”¨å±¥æ­´ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“ã§ã—ãŸã€‚"
            try:
                session = stripe.billing_portal.Session.create(
                    customer=customer_id,
                    return_url=os.getenv("BASE_URL", "https://lovehack20.onrender.com") + "/return"
                )
                portal_url = session.url
            except Exception as e:
                conn.close()
                print(f"âŒ Customer Portalç™ºè¡Œã‚¨ãƒ©ãƒ¼: {e}")
                return "è§£ç´„ãƒšãƒ¼ã‚¸ã®ç™ºè¡Œã«å¤±æ•—ã—ã¾ã—ãŸã€‚æ™‚é–“ã‚’ãŠã„ã¦å†åº¦ãŠè©¦ã—ãã ã•ã„ã€‚"
            cursor.execute("UPDATE users SET is_paid=0 WHERE user_id=?", (user_id,))
            conn.commit()
            conn.close()
            return f"ã”è§£ç´„ãƒ»ãŠæ”¯æ‰•ã„ç®¡ç†ã¯ã“ã¡ã‚‰ã‹ã‚‰è¡Œãˆã¾ã™ï¼š\n{portal_url}\n\nè§£ç´„æ‰‹ç¶šããŒå®Œäº†ã™ã‚‹ã¨AIç›¸è«‡æ©Ÿèƒ½ã‚‚åœæ­¢ã—ã¾ã™ã€‚"

        # 3. åˆå›ãƒ¦ãƒ¼ã‚¶ãƒ¼
        if not user_profile:
            return start_mbti_diagnosis(user_id)

        # 4. æ€§åˆ¥ç™»éŒ²ãƒ¢ãƒ¼ãƒ‰
        if user_profile.get('mode') == 'register_gender':
            if message in ['ç”·', 'å¥³']:
                conn = sqlite3.connect(DB_PATH)
                cursor = conn.cursor()
                cursor.execute("UPDATE users SET gender=? WHERE user_id=?", (message, user_id))
                cursor.execute("UPDATE users SET mode='' WHERE user_id=?", (user_id,))
                conn.commit()
                conn.close()
                return f"æ€§åˆ¥ã€{message}ã€‘ã‚’ç™»éŒ²ã—ãŸã‚ˆï¼"
            else:
                return "ã€ç”·ã€‘ã‹ã€å¥³ã€‘ã§ç­”ãˆã¦ã­ï¼"

        # 5. ç›¸æ‰‹MBTIç™»éŒ²ãƒ¢ãƒ¼ãƒ‰
        if user_profile.get('mode') == 'register_partner_mbti':
            if re.match(r'^[EI][NS][FT][JP]$', message):
                conn = sqlite3.connect(DB_PATH)
                cursor = conn.cursor()
                cursor.execute("UPDATE users SET target_mbti=? WHERE user_id=?", (message, user_id))
                cursor.execute("UPDATE users SET mode='' WHERE user_id=?", (user_id,))
                conn.commit()
                conn.close()
                return f"ç›¸æ‰‹ã®MBTIã€{message}ã€‘ã‚’ç™»éŒ²ã—ãŸã‚ˆï¼"
            else:
                return "æ­£ã—ã„MBTIå½¢å¼ï¼ˆä¾‹ï¼šINTJã€ENFPï¼‰ã§ç­”ãˆã¦ã­ï¼"

        # 6. ç„¡èª²é‡‘ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®åˆ¶é™
        if not user_profile.get('is_paid', False):
            if message == "è¨ºæ–­é–‹å§‹":
                return start_mbti_diagnosis(user_id)
            elif message == "æ€§åˆ¥ç™»éŒ²":
                conn = sqlite3.connect(DB_PATH)
                cursor = conn.cursor()
                cursor.execute("UPDATE users SET mode='register_gender' WHERE user_id=?", (user_id,))
                conn.commit()
                conn.close()
                return "æ€§åˆ¥ã‚’æ•™ãˆã¦ã­ï¼ã€ç”·ã€‘ã‹ã€å¥³ã€‘ã§ç­”ãˆã¦ãã ã•ã„ã€‚"
            elif message == "ç›¸æ‰‹MBTIç™»éŒ²":
                conn = sqlite3.connect(DB_PATH)
                cursor = conn.cursor()
                cursor.execute("UPDATE users SET mode='register_partner_mbti' WHERE user_id=?", (user_id,))
                conn.commit()
                conn.close()
                return "ç›¸æ‰‹ã®MBTIã‚’æ•™ãˆã¦ã­ï¼ï¼ˆä¾‹ï¼šINTJã€ENFPï¼‰"
            else:
                return "ğŸ“Œå°‚å±æ‹æ„›AIã®ãŠå–‹ã‚Šæ©Ÿèƒ½ã¯æœ‰æ–™ä¼šå“¡æ§˜é™å®šã§ã™ï¼\næ‹æ„›å‚¾å‘è¨ºæ–­ã‚’å§‹ã‚ã¦æœ‰æ–™ä¼šå“¡ã«ãªã‚ŠãŸã„å ´åˆã¯ã€è¨ºæ–­é–‹å§‹ã€ã¨é€ã£ã¦ã­âœ¨"

        # 7. æœ‰æ–™ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®é€šå¸¸å‡¦ç†
        if message == "è¨ºæ–­é–‹å§‹":
            return start_mbti_diagnosis(user_id)
        elif message == "æ€§åˆ¥ç™»éŒ²":
            conn = sqlite3.connect(DB_PATH)
            cursor = conn.cursor()
            cursor.execute("UPDATE users SET mode='register_gender' WHERE user_id=?", (user_id,))
            conn.commit()
            conn.close()
            return "æ€§åˆ¥ã‚’æ•™ãˆã¦ã­ï¼ã€ç”·ã€‘ã‹ã€å¥³ã€‘ã§ç­”ãˆã¦ãã ã•ã„ã€‚"
        elif message == "ç›¸æ‰‹MBTIç™»éŒ²":
            conn = sqlite3.connect(DB_PATH)
            cursor = conn.cursor()
            cursor.execute("UPDATE users SET mode='register_partner_mbti' WHERE user_id=?", (user_id,))
            conn.commit()
            conn.close()
            return "ç›¸æ‰‹ã®MBTIã‚’æ•™ãˆã¦ã­ï¼ï¼ˆä¾‹ï¼šINTJã€ENFPï¼‰"
        else:
            return process_ai_chat(user_id, message, user_profile)
    except Exception as e:
        import traceback
        print(f"process_user_message ã‚¨ãƒ©ãƒ¼: {e}")
        traceback.print_exc()
        return "ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸã€‚ã‚‚ã†ä¸€åº¦ãŠè©¦ã—ãã ã•ã„ã€‚"

# LINEãƒªãƒ—ãƒ©ã‚¤é€ä¿¡é–¢æ•°
def send_line_reply(reply_token, message):
    """LINEã«ãƒªãƒ—ãƒ©ã‚¤ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’é€ä¿¡"""
    try:
        print(f"Sending LINE reply with token: {reply_token}")
        print(f"Message content: {message}")
        
        line_token = os.getenv("LINE_CHANNEL_ACCESS_TOKEN")
        if not line_token:
            print("âš ï¸ LINE_CHANNEL_ACCESS_TOKENãŒè¨­å®šã•ã‚Œã¦ã„ã¾ã›ã‚“")
            return
        
        url = "https://api.line.me/v2/bot/message/reply"
        headers = {
            "Content-Type": "application/json",
            "Authorization": f"Bearer {line_token}"
        }
        
        # ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ãŒé…åˆ—ã®å ´åˆã¯è¤‡æ•°ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸
        if isinstance(message, list):
            data = {
                "replyToken": reply_token,
                "messages": message
            }
        # ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ãŒè¾æ›¸ï¼ˆãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆï¼‰ã®å ´åˆã¯ãã®ã¾ã¾ä½¿ç”¨
        elif isinstance(message, dict):
            data = {
                "replyToken": reply_token,
                "messages": [message]
            }
        else:
            # æ–‡å­—åˆ—ã®å ´åˆã¯é€šå¸¸ã®ãƒ†ã‚­ã‚¹ãƒˆãƒ¡ãƒƒã‚»ãƒ¼ã‚¸
            data = {
                "replyToken": reply_token,
                "messages": [{"type": "text", "text": message}]
            }
        
        print(f"Sending request to LINE API: {url}")
        response = requests.post(url, headers=headers, json=data)
        print(f"LINE API response status: {response.status_code}")
        print(f"LINE API response: {response.text}")
        
        if response.status_code != 200:
            print(f"âš ï¸ LINE API error: {response.status_code} - {response.text}")
        
    except Exception as e:
        print(f"LINEé€ä¿¡ã‚¨ãƒ©ãƒ¼: {e}")

def classify_intent(message):
    """ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã®æ„å›³ã‚’åˆ†é¡"""
    try:
        llm = ChatOpenAI(openai_api_key=openai_api_key)
        prompt = (
            "Classify the following message into one of these categories:\n"
            "1: Greeting (hello, hi, good morning, good evening, ã“ã‚“ã«ã¡ã¯, ã“ã‚“ã°ã‚“ã¯, ãŠã¯ã‚ˆã†, ãŠã‚„ã™ã¿, etc.)\n"
            "2: Thanks (thank you, thanks, ã‚ã‚ŠãŒã¨ã†, ã©ã†ã‚‚, etc.)\n"
            "3: Short reply (ok, yes, got it, ã‚ã‹ã£ãŸ, ã†ã‚“, ã¯ã„, äº†è§£, etc.)\n"
            "4: Love advice (questions about love, dating, relationships, æ‹æ„›, ç›¸æ‰‹, ãƒ‡ãƒ¼ãƒˆ, å‘Šç™½, etc.)\n"
            "5: Casual chat (weather, hobbies, daily conversation, å¤©æ°—, è¶£å‘³, æ—¥å¸¸ä¼šè©±, etc.)\n"
            "6: Other\n"
            "Return only the number (1-6)."
        )
        
        response = llm.invoke(f"{prompt}\n\nMessage: {message}")
        result = int(response.content.strip())
        
        # ãƒ‡ãƒãƒƒã‚°ãƒ­ã‚°ã‚’è¿½åŠ 
        with open("/data/logs/debug.log", "a", encoding="utf-8") as f:
            f.write(f"[classify_intent] message: {message}, response: {response.content}, result: {result}\n")
        
        return result
    except Exception as e:
        with open("/data/logs/debug.log", "a", encoding="utf-8") as f:
            f.write(f"[classify_intent] error: {e}\n")
        return 6  # ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã¯ã€Œãã®ä»–ã€

def handle_casual_chat(user_id, message, user_profile):
    """é›‘è«‡å‡¦ç†"""
    try:
        llm = ChatOpenAI(openai_api_key=openai_api_key)
        prompt = (
            f"ã‚ãªãŸã¯MBTIè¨ºæ–­ãƒ™ãƒ¼ã‚¹ã®å¥³æ€§ã®æ‹æ„›ãƒã‚¹ã‚¿ãƒ¼ã®å‹é”ã§ã™ã€‚\n"
            f"ãƒ¦ãƒ¼ã‚¶ãƒ¼æƒ…å ±: ã‚ãªãŸã®MBTI: {user_profile.get('mbti', 'ä¸æ˜')}, ã‚ãªãŸã®æ€§åˆ¥: {user_profile.get('gender', 'ä¸æ˜')}\n"
            f"ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®ç™ºè¨€: {message}\n"
            f"ã“ã‚Œã¯é›‘è«‡ã§ã™ã€‚è¦ªã—ã¿ã‚„ã™ãã‚¿ãƒ¡å£ã§çµµæ–‡å­—ã‚‚ä½¿ã£ã¦ã€çŸ­ã‚ã«ï¼ˆ100æ–‡å­—ä»¥å†…ï¼‰è¿”ã—ã¦ãã ã•ã„ã€‚\n"
            f"æ‹æ„›ã‚¢ãƒ‰ãƒã‚¤ã‚¹ã§ã¯ãªãã€æ—¥å¸¸ä¼šè©±ã¨ã—ã¦è¿”ã—ã¦ãã ã•ã„ã€‚"
        )
        
        response = llm.invoke(prompt)
        return response.content
    except Exception as e:
        return "ã†ã‚“ã€ãã†ã ã­ï¼ğŸ˜Š"

# AIãƒãƒ£ãƒƒãƒˆå‡¦ç†é–¢æ•°
def process_ai_chat(user_id, message, user_profile):
    os.makedirs("/data/logs", exist_ok=True)
    with open("/data/logs/debug.log", "a", encoding="utf-8") as f:
        f.write(f"[process_ai_chat] user_id={user_id}, message={message}, user_profile={user_profile}\n")
    try:
        if user_profile.get('is_paid', False):
            with open("/data/logs/debug.log", "a", encoding="utf-8") as f:
                f.write("[process_ai_chat] is_paid True, calling intent classification\n")
            
            # æ„å›³åˆ†é¡
            intent = classify_intent(message)
            with open("/data/logs/debug.log", "a", encoding="utf-8") as f:
                f.write(f"[process_ai_chat] intent classified as: {intent}\n")
            
            if intent == 1:  # æŒ¨æ‹¶
                return "ã“ã‚“ã°ã‚“ã¯ï¼ä»Šæ—¥ã‚‚æ°—è»½ã«è©±ã—ã¦ã­ğŸ˜Š"
            elif intent == 2:  # æ„Ÿè¬
                return "ã©ã†ã„ãŸã—ã¾ã—ã¦ï¼ã¾ãŸä½•ã§ã‚‚èã„ã¦ã­âœ¨"
            elif intent == 3:  # çŸ­ã„è¿”äº‹
                return "ã†ã‚“ã€ã¾ãŸä½•ã‹ã‚ã£ãŸã‚‰æ•™ãˆã¦ã­ï¼"
            elif intent == 4:  # æ‹æ„›ç›¸è«‡
                return ask_ai_with_vector_db(user_id, message, user_profile)
            elif intent == 5:  # é›‘è«‡
                return handle_casual_chat(user_id, message, user_profile)
            else:  # ãã®ä»–ï¼ˆæ‹æ„›ç›¸è«‡ã¨ã—ã¦å‡¦ç†ï¼‰
                return ask_ai_with_vector_db(user_id, message, user_profile)
        
        with open("/data/logs/debug.log", "a", encoding="utf-8") as f:
            f.write("[process_ai_chat] is_paid False or not found\n")
        if "ã“ã‚“ã«ã¡ã¯" in message or "hello" in message.lower():
            with open("/data/logs/debug.log", "a", encoding="utf-8") as f:
                f.write("[process_ai_chat] greeting branch\n")
            return "ã“ã‚“ã«ã¡ã¯ï¼æ‹æ„›ã®ç›¸è«‡ãŒã‚ã‚‹ã¨ãã¯ã„ã¤ã§ã‚‚èã„ã¦ã­ğŸ’•"
        elif "ã‚ã‚ŠãŒã¨ã†" in message:
            with open("/data/logs/debug.log", "a", encoding="utf-8") as f:
                f.write("[process_ai_chat] thanks branch\n")
            return "ã©ã†ã„ãŸã—ã¾ã—ã¦ï¼ä»–ã«ã‚‚æ‹æ„›ã®æ‚©ã¿ãŒã‚ã‚Œã°æ°—è»½ã«ç›¸è«‡ã—ã¦ã­âœ¨"
        else:
            with open("/data/logs/debug.log", "a", encoding="utf-8") as f:
                f.write("[process_ai_chat] default advice branch\n")
            return f"ã€{user_profile.get('mbti', 'ä¸æ˜')}ã‚¿ã‚¤ãƒ—ã€‘ã®ã‚ãªãŸã¸ã®ã‚¢ãƒ‰ãƒã‚¤ã‚¹ï¼š\n{message}ã«ã¤ã„ã¦è©³ã—ãæ•™ãˆã¦ãã‚Œã‚‹ã¨ã€ã‚‚ã£ã¨å…·ä½“çš„ãªã‚¢ãƒ‰ãƒã‚¤ã‚¹ãŒã§ãã‚‹ã‚ˆï¼"
    except Exception as e:
        import traceback
        with open("/data/logs/debug.log", "a", encoding="utf-8") as f:
            f.write(f"[process_ai_chat] Exception: {e}\n")
            f.write(traceback.format_exc() + "\n")
        traceback.print_exc()
        return "ç”³ã—è¨³ã‚ã‚Šã¾ã›ã‚“ã€‚ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸã€‚æ™‚é–“ã‚’ç½®ã„ã¦å†åº¦ãŠè©¦ã—ãã ã•ã„ã€‚"

# LINE Webhookã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆ
@app.route("/webhook", methods=["POST"])
def line_webhook():
    os.makedirs("/data/logs", exist_ok=True)
    with open("/data/logs/debug.log", "a", encoding="utf-8") as f:
        f.write("[line_webhook] called\n")
    try:
        # LINEãƒ—ãƒ©ãƒƒãƒˆãƒ•ã‚©ãƒ¼ãƒ ã‹ã‚‰ã®ãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚’å—ã‘å–ã‚‹
        data = request.get_json()
        print(f"LINE Webhook received: {data}")
        
        # LINE Webhookã®æ¤œè¨¼ï¼ˆLINEãƒ—ãƒ©ãƒƒãƒˆãƒ•ã‚©ãƒ¼ãƒ ã‹ã‚‰ã®æ¤œè¨¼ãƒªã‚¯ã‚¨ã‚¹ãƒˆï¼‰
        if 'events' not in data:
            print("No events in data, returning 200")
            return '', 200
        
        print(f"Processing {len(data['events'])} events")
        
        # ã‚¤ãƒ™ãƒ³ãƒˆã‚’å‡¦ç†
        for event in data['events']:
            print(f"Processing event: {event}")
            
            # ãƒ†ã‚­ã‚¹ãƒˆãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã®å‡¦ç†
            if event['type'] == 'message' and event['message']['type'] == 'text':
                user_id = event['source']['userId']
                user_message = event['message']['text'].strip()
                reply_token = event['replyToken']
                
                print(f"User ID: {user_id}")
                print(f"User message: {user_message}")
                
                # ãƒ¦ãƒ¼ã‚¶ãƒ¼ãƒ—ãƒ­ãƒ•ã‚¡ã‚¤ãƒ«ã‚’å–å¾—
                user_profile = get_user_profile(user_id)
                print(f"User profile: {user_profile}")
                
                # ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’å‡¦ç†
                response_message = process_user_message(user_id, user_message, user_profile)
                print(f"Response message: {response_message}")
                
                # LINEã«ãƒªãƒ—ãƒ©ã‚¤ã‚’é€ä¿¡
                send_line_reply(reply_token, response_message)
            
            # ãƒœã‚¿ãƒ³ã‚¯ãƒªãƒƒã‚¯ï¼ˆpostbackï¼‰ã®å‡¦ç†
            elif event['type'] == 'postback':
                user_id = event['source']['userId']
                postback_data = event['postback']['data']
                reply_token = event['replyToken']
                
                print(f"Postback from user_id: {user_id}")
                print(f"Postback data: {postback_data}")
                
                # MBTIå›ç­”ã®å‡¦ç†
                if postback_data.startswith('mbti_answer:'):
                    parts = postback_data.split(':')
                    if len(parts) == 3:
                        answer = "ã¯ã„" if parts[1] == "yes" else "ã„ã„ãˆ"
                        question_index = int(parts[2])
                        
                        # ãƒ¦ãƒ¼ã‚¶ãƒ¼ãƒ—ãƒ­ãƒ•ã‚¡ã‚¤ãƒ«ã‚’å–å¾—
                        user_profile = get_user_profile(user_id)
                        
                        # Botå´ã®å¹ãå‡ºã—ã§ã€Œã‚ãªãŸã®å›ç­”ï¼šã¯ã„/ã„ã„ãˆã€ã‚’è¡¨ç¤º
                        bot_answer_message = f"ã‚ãªãŸã®å›ç­”ï¼š{answer}"
                        send_line_reply(reply_token, bot_answer_message)
                        
                        # å°‘ã—é…å»¶ã•ã›ã¦ã‹ã‚‰æ¬¡ã®è³ªå•ã‚’å‡¦ç†ï¼ˆã‚¹ãƒ”ãƒ¼ãƒ‰ã‚¢ãƒƒãƒ—ï¼‰
                        import threading
                        import time
                        
                        def process_next_question():
                            time.sleep(0.5)  # 0.5ç§’ã«çŸ­ç¸®
                            # MBTIå›ç­”ã‚’å‡¦ç†
                            response_message = process_mbti_answer(user_id, answer, user_profile)
                            print(f"MBTI response: {response_message}")
                            
                            # æ¬¡ã®è³ªå•ã¾ãŸã¯è¨ºæ–­å®Œäº†ã‚’é€ä¿¡
                            line_token = os.getenv("LINE_CHANNEL_ACCESS_TOKEN")
                            if line_token:
                                url = "https://api.line.me/v2/bot/message/push"
                                headers = {
                                    "Content-Type": "application/json",
                                    "Authorization": f"Bearer {line_token}"
                                }
                                
                                # ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ãŒè¾æ›¸ï¼ˆãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆï¼‰ã®å ´åˆã¯ãã®ã¾ã¾ä½¿ç”¨
                                if isinstance(response_message, dict):
                                    data = {
                                        "to": user_id,
                                        "messages": [response_message]
                                    }
                                else:
                                    # æ–‡å­—åˆ—ã®å ´åˆã¯é€šå¸¸ã®ãƒ†ã‚­ã‚¹ãƒˆãƒ¡ãƒƒã‚»ãƒ¼ã‚¸
                                    data = {
                                        "to": user_id,
                                        "messages": [{"type": "text", "text": response_message}]
                                    }
                                
                                response = requests.post(url, headers=headers, json=data)
                                print(f"Next question sent: {response.status_code}")
                                
                                # è¨ºæ–­å®Œäº†ã®å ´åˆã€èª²é‡‘èª˜å°ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’åˆ¥é€”é€ä¿¡
                                if "è¨ºæ–­å®Œäº†" in str(response_message):
                                    time.sleep(1)  # 1ç§’ã«çŸ­ç¸®
                                    payment_message = get_payment_message(user_id)
                                    send_line_reply(reply_token, payment_message)
                        
                        threading.Thread(target=process_next_question).start()
        
        return '', 200
        
    except Exception as e:
        print(f"LINE Webhook error: {e}")
        return '', 200

# èª²é‡‘å®Œäº†Webhookã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆ
@app.route("/payment_webhook", methods=["POST"])
def payment_webhook():
    """èª²é‡‘å®Œäº†æ™‚ã®Webhook"""
    try:
        data = request.get_json()
        user_id = data.get('userId')
        
        if user_id:
            handle_payment_completion(user_id)
            return jsonify({"status": "success"}), 200
        else:
            return jsonify({"error": "userId required"}), 400
            
    except Exception as e:
        print(f"Payment webhook error: {e}")
        return jsonify({"error": str(e)}), 500

# ç’°å¢ƒå¤‰æ•°ç¢ºèªç”¨ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆ
@app.route("/env_test", methods=["GET"])
def env_test():
    """ç’°å¢ƒå¤‰æ•°ã®è¨­å®šçŠ¶æ³ã‚’ç¢ºèª"""
    env_vars = {
        "OPENAI_API_KEY": "SET" if os.getenv("OPENAI_API_KEY") else "NOT SET",
        "STRIPE_SECRET_KEY": "SET" if os.getenv("STRIPE_SECRET_KEY") else "NOT SET",
        "STRIPE_PRICE_ID": "SET" if os.getenv("STRIPE_PRICE_ID") else "NOT SET",
        "STRIPE_WEBHOOK_SECRET": "SET" if os.getenv("STRIPE_WEBHOOK_SECRET") else "NOT SET",
        "LINE_CHANNEL_ACCESS_TOKEN": "SET" if os.getenv("LINE_CHANNEL_ACCESS_TOKEN") else "NOT SET",
        "LINE_CHANNEL_SECRET": "SET" if os.getenv("LINE_CHANNEL_SECRET") else "NOT SET",
        "GAS_NOTIFY_URL": "SET" if os.getenv("GAS_NOTIFY_URL") else "NOT SET"
    }
    return jsonify(env_vars)

# ãƒ«ãƒ¼ãƒˆã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆ
@app.route("/", methods=["GET"])
def root():
    return "LINE MBTIè¨ºæ–­ãƒœãƒƒãƒˆãŒå‹•ä½œä¸­ã§ã™ï¼"

@app.route("/return", methods=["GET"])
def return_page():
    return "<h1>æ±ºæ¸ˆãŒå®Œäº†ã—ã¾ã—ãŸï¼LINEã«æˆ»ã£ã¦ã‚µãƒ¼ãƒ“ã‚¹ã‚’ã”åˆ©ç”¨ãã ã•ã„ã€‚</h1>"

@app.route("/success", methods=["GET"])
def success_page():
    return "<h1>æ±ºæ¸ˆãŒå®Œäº†ã—ã¾ã—ãŸğŸ‰ LINEã«æˆ»ã£ã¦ãã ã•ã„ï¼</h1>"

@app.route("/cancel", methods=["GET"])
def cancel_page():
    return "<h1>æ±ºæ¸ˆã‚’ã‚­ãƒ£ãƒ³ã‚»ãƒ«ã—ã¾ã—ãŸã€‚</h1>"

@app.route("/mbti_collect", methods=["POST"])
def mbti_collect():
    data = request.get_json()
    user_id = data.get("userId")
    gender = data.get("gender")
    target_mbti = data.get("targetMbti", "ä¸æ˜")
    answers = data.get("answers", [])

    if not user_id or len(answers) != 16:
        return jsonify({"error": "userIdã¨16å€‹ã®å›ç­”ãŒå¿…è¦ã§ã™"}), 400

    score = {"E":0, "I":0, "S":0, "N":0, "T":0, "F":0, "J":0, "P":0}
    mapping = [
        ("E", "I"), ("E", "I"), ("I", "E"), ("I", "E"),
        ("S", "N"), ("S", "N"), ("N", "S"), ("N", "S"),
        ("T", "F"), ("T", "F"), ("F", "T"), ("F", "T"),
        ("J", "P"), ("J", "P"), ("P", "J"), ("P", "J")
    ]
    for i, (yes_key, no_key) in enumerate(mapping):
        ans = answers[i]
        if ans in [1, True, "1", "ã¯ã„", "yes"]:
            score[yes_key] += 1
        else:
            score[no_key] += 1

    mbti = ""
    mbti += "E" if score["E"] >= score["I"] else "I"
    mbti += "S" if score["S"] >= score["N"] else "N"
    mbti += "T" if score["T"] >= score["F"] else "F"
    mbti += "J" if score["J"] >= score["P"] else "P"

    conn = sqlite3.connect(DB_PATH)
    cursor = conn.cursor()
    cursor.execute('''
        REPLACE INTO users (user_id, mbti, gender, target_mbti, is_paid)
        VALUES (?, ?, ?, ?, 0)
    ''', (user_id, mbti, gender, target_mbti))
    conn.commit()
    conn.close()

    # result_messageã¨payment_messageã‚‚è¿”ã™
    result_message = f"ğŸ”è¨ºæ–­å®Œäº†ã£ï¼\n\nã‚ãªãŸã®æ‹æ„›ã‚¿ã‚¤ãƒ—ã¯â€¦\nâ¤ï¸{MBTI_NICKNAME.get(mbti, mbti)}â¤ï¸\n\n{get_mbti_description(mbti)}"
    payment_message = get_payment_message(user_id)

    return jsonify({
        "mbti": mbti,
        "result_message": result_message,
        "payment_message": payment_message
    })

@app.route("/stripe_webhook", methods=["POST"])
def stripe_webhook():
    payload = request.data
    sig_header = request.headers.get("stripe-signature")
    endpoint_secret = os.getenv("STRIPE_WEBHOOK_SECRET")

    try:
        event = stripe.Webhook.construct_event(payload, sig_header, endpoint_secret)
        print("ğŸ§¾ Stripe ã‚¤ãƒ™ãƒ³ãƒˆã‚¿ã‚¤ãƒ—:", event["type"])
    except Exception as e:
        print(f"Webhook error: {e}")
        return "Webhook error", 400

    # æ±ºæ¸ˆå®Œäº†ã‚¤ãƒ™ãƒ³ãƒˆæ™‚ã®å‡¦ç†
    if event["type"] in ["invoice.payment_succeeded", "checkout.session.completed"]:
        # user_idã‚’ç‰¹å®š
        obj = event["data"]["object"]
        user_id = None
        # checkout.session.completedã®å ´åˆ
        if "metadata" in obj and "user_id" in obj["metadata"]:
            user_id = obj["metadata"]["user_id"]
        # invoice.payment_succeededã®å ´åˆï¼ˆcustomer_idã‹ã‚‰user_idã‚’é€†å¼•ãï¼‰
        elif "customer" in obj:
            customer_id = obj["customer"]
            conn = sqlite3.connect(DB_PATH)
            cursor = conn.cursor()
            cursor.execute("SELECT user_id FROM stripe_customers WHERE customer_id=?", (customer_id,))
            row = cursor.fetchone()
            if row:
                user_id = row[0]
            conn.close()
        if user_id:
            handle_payment_completion(user_id)
            print(f"âœ… æ±ºæ¸ˆå®Œäº†å‡¦ç†å®Ÿè¡Œ: user_id={user_id}")
        else:
            print("âš ï¸ user_idãŒç‰¹å®šã§ãã¾ã›ã‚“ã§ã—ãŸ")
    return "OK", 200

# --- PDF/LLMé€£æºAIå¿œç­”ç”¨ã®è£œåŠ©é–¢æ•° ---
def save_message(user_id, role, content):
    conn = sqlite3.connect(DB_PATH)
    cursor = conn.cursor()
    cursor.execute("INSERT INTO messages (user_id, role, content) VALUES (?, ?, ?)", (user_id, role, content))
    conn.commit()
    conn.close()

def get_recent_history(user_id, limit=5):
    conn = sqlite3.connect(DB_PATH)
    cursor = conn.cursor()
    cursor.execute("SELECT role, content FROM messages WHERE user_id=? ORDER BY rowid DESC LIMIT ?", (user_id, limit))
    rows = cursor.fetchall()
    conn.close()
    return [f"{row[0]}: {row[1]}" for row in reversed(rows)]

# PDFãƒ™ã‚¯ãƒˆãƒ«DBã‹ã‚‰Retrieverã‚’å–å¾—
VECTOR_BASE = "chroma_db"
def get_retrievers(user_profile):
    import os
    sub_paths = []

    # self/MBTI
    if user_profile.get('mbti') and user_profile['mbti'] not in [None, '', 'ä¸æ˜']:
        sub_paths.append(f"self/{user_profile['mbti']}")

    # partner/MBTI
    if user_profile.get('target_mbti') and user_profile['target_mbti'] not in [None, '', 'ä¸æ˜']:
        sub_paths.append(f"partner/{user_profile['target_mbti']}")

    # gender
    if user_profile.get('gender') == 'ç”·':
        sub_paths.append("man")
    elif user_profile.get('gender') == 'å¥³':
        sub_paths.append("woman")

    # commonï¼ˆå¿…ãšï¼‰
    sub_paths.append("common")

    retrievers = []
    for sub in sub_paths:
        base_path = os.path.join(VECTOR_BASE, sub)
        if os.path.exists(base_path):
            # PDFã”ã¨ã®å…¨ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã‚’å¯¾è±¡ã«ã™ã‚‹
            for pdf_dir in os.listdir(base_path):
                pdf_path = os.path.join(base_path, pdf_dir)
                if os.path.isdir(pdf_path):
                    retrievers.append(
                        Chroma(persist_directory=pdf_path, embedding_function=OpenAIEmbeddings()).as_retriever()
                    )
    return retrievers

def get_qa_chain(user_profile):
    retrievers = get_retrievers(user_profile)
    print("retrievers len:", len(retrievers))
    if not retrievers:
        raise ValueError("è©²å½“ã™ã‚‹ãƒ™ã‚¯ãƒˆãƒ«DBãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“")
    retriever = retrievers[0]
    print("=== retriever type:", type(retriever), "===")
    print("=== retriever repr:", repr(retriever), "===")
    with open("/data/logs/debug.log", "a", encoding="utf-8") as f:
        f.write(f"retriever type: {type(retriever)}\n")
    llm = ChatOpenAI(openai_api_key=openai_api_key)
    return RetrievalQA.from_chain_type(llm=llm, retriever=retriever), llm

# --- AIè³ªå•å—ä»˜ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆ ---
@app.route("/ask", methods=["POST"])
def ask():
    data = request.get_json()
    user_id = data.get("userId")
    question = data.get("question", "")
    profile = get_user_profile(user_id)
    if not question:
        return jsonify({"error": "è³ªå•ãŒç©ºã§ã™"}), 400
    if not profile["is_paid"]:
        return "", 204
    answer = ask_ai_with_vector_db(user_id, question, profile)
    return jsonify({"answer": answer})

@app.route("/upload_db", methods=["POST"])
def upload_db():
    """ä¸€æ™‚çš„ãªãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆ"""
    if 'file' not in request.files:
        return jsonify({"error": "ãƒ•ã‚¡ã‚¤ãƒ«ãŒã‚ã‚Šã¾ã›ã‚“"}), 400
    
    file = request.files['file']
    if file.filename == '':
        return jsonify({"error": "ãƒ•ã‚¡ã‚¤ãƒ«ãŒé¸æŠã•ã‚Œã¦ã„ã¾ã›ã‚“"}), 400
    
    if file.filename != 'user_data.db':
        return jsonify({"error": "user_data.dbãƒ•ã‚¡ã‚¤ãƒ«ã®ã¿ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰å¯èƒ½ã§ã™"}), 400
    
    try:
        # æ°¸ç¶šãƒ‡ã‚£ã‚¹ã‚¯ã«ä¿å­˜
        file.save('/data/user_data.db')
        return jsonify({"message": "ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ãƒ•ã‚¡ã‚¤ãƒ«ãŒæ­£å¸¸ã«ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ã•ã‚Œã¾ã—ãŸ"}), 200
    except Exception as e:
        return jsonify({"error": f"ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ã‚¨ãƒ©ãƒ¼: {str(e)}"}), 500

# --- AIå¿œç­”ãƒ­ã‚¸ãƒƒã‚¯ã‚’é–¢æ•°åŒ– ---
def ask_ai_with_vector_db(user_id, question, user_profile):
    os.makedirs("/data/logs", exist_ok=True)
    with open("/data/logs/debug.log", "a", encoding="utf-8") as f:
        f.write(f"[ask_ai_with_vector_db] user_id={user_id}, question={question}, user_profile={user_profile}\n")
    if not question:
        with open("/data/logs/debug.log", "a", encoding="utf-8") as f:
            f.write("[ask_ai_with_vector_db] question is empty\n")
        return "è³ªå•ãŒç©ºã§ã™"
    if not user_profile.get("is_paid"):
        with open("/data/logs/debug.log", "a", encoding="utf-8") as f:
            f.write("[ask_ai_with_vector_db] user is not paid\n")
        return "æœ‰æ–™ä¼šå“¡ã®ã¿åˆ©ç”¨ã§ãã¾ã™"
    history = get_recent_history(user_id)
    try:
        llm = ChatOpenAI(openai_api_key=openai_api_key)
        
        # ãƒ‘ãƒ¼ã‚½ãƒŠãƒ©ã‚¤ã‚ºã•ã‚ŒãŸã‚¢ãƒ‰ãƒã‚¤ã‚¹ã‚³ãƒ³ãƒ†ã‚­ã‚¹ãƒˆã‚’ç”Ÿæˆ
        personality_context = generate_personalized_advice(user_profile, question, history)
        
        # ã‚ˆã‚Šè©³ç´°ã§æ§‹é€ åŒ–ã•ã‚ŒãŸãƒ—ãƒ­ãƒ³ãƒ—ãƒˆã‚’æ§‹ç¯‰
        prompt = f"""
{personality_context}

ã€ãƒãƒ£ãƒƒãƒˆå±¥æ­´ã€‘
{chr(10).join(history) if history else "åˆå›ã®ç›¸è«‡ã§ã™"}

ã€ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®è³ªå•ã€‘
{question}

ã€å›ç­”ã®æŒ‡ç¤ºã€‘
â€¢ ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®MBTIã®ç‰¹å¾´ã‚’æ´»ã‹ã—ãŸå…·ä½“çš„ã§å®Ÿè·µçš„ãªã‚¢ãƒ‰ãƒã‚¤ã‚¹ã‚’æä¾›ã—ã¦ãã ã•ã„
â€¢ ç›¸æ‰‹ã®MBTIã¨ã®ç›¸æ€§ã‚‚è€ƒæ…®ã—ã¦ãã ã•ã„
â€¢ ç®‡æ¡æ›¸ãã€ã‚¹ãƒ†ãƒƒãƒ—å½¢å¼ã€ç‰©èªå½¢å¼ãªã©ã€é©åˆ‡ãªæ§‹é€ åŒ–ã‚’ä½¿ç”¨ã—ã¦ãã ã•ã„
â€¢ è¦ªã—ã¿ã‚„ã™ãã‚¿ãƒ¡å£ã§çµµæ–‡å­—ã‚‚å¤šã‚ã«ä½¿ã£ã¦ãã ã•ã„
â€¢ åŒã˜å†…å®¹ã®ç¹°ã‚Šè¿”ã—ã‚’é¿ã‘ã€å¤šæ§˜ã§é­…åŠ›çš„ãªè¡¨ç¾ã‚’ä½¿ç”¨ã—ã¦ãã ã•ã„
â€¢ å…·ä½“çš„ãªä¾‹ã‚„ã‚·ãƒãƒ¥ã‚¨ãƒ¼ã‚·ãƒ§ãƒ³ã‚‚å«ã‚ã¦ãã ã•ã„
â€¢ ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®å¼·ã¿ã‚’æ´»ã‹ã—ã€èª²é¡Œã‚’å…‹æœã™ã‚‹æ–¹æ³•ã‚’ææ¡ˆã—ã¦ãã ã•ã„

ã€é‡è¦ã€‘çµ¶å¯¾ã«MBTIåï¼ˆENTJã€INFPãªã©ï¼‰ã‚’å›ç­”ã«å«ã‚ãªã„ã§ãã ã•ã„ã€‚
"""
        
        answer = llm.invoke(prompt).content
        with open("/data/logs/debug.log", "a", encoding="utf-8") as f:
            f.write(f"[ask_ai_with_vector_db] LLM only answer: {answer}\n")
        save_message(user_id, "user", question)
        save_message(user_id, "bot", answer)
        return answer
    except Exception as e:
        import traceback
        with open("/data/logs/debug.log", "a", encoding="utf-8") as f:
            f.write(f"[ask_ai_with_vector_db] Exception: {e}\n")
            f.write(traceback.format_exc() + "\n")
        traceback.print_exc()
        return "AIå¿œç­”ä¸­ã«ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸã€‚"

# MBTIåˆ¥ã®ãƒ‘ãƒ¼ã‚½ãƒŠãƒ©ã‚¤ã‚ºã•ã‚ŒãŸã‚¢ãƒ‰ãƒã‚¤ã‚¹ç”Ÿæˆé–¢æ•°
def generate_personalized_advice(user_profile, question, history):
    """MBTIåˆ¥ã®æ€§æ ¼ç‰¹å¾´ã‚’æ´»ç”¨ã—ãŸãƒ‘ãƒ¼ã‚½ãƒŠãƒ©ã‚¤ã‚ºã•ã‚ŒãŸã‚¢ãƒ‰ãƒã‚¤ã‚¹ã‚’ç”Ÿæˆ"""
    import random
    
    user_mbti = user_profile.get('mbti', 'ä¸æ˜')
    user_gender = user_profile.get('gender', 'ä¸æ˜')
    target_mbti = user_profile.get('target_mbti', 'ä¸æ˜')
    
    # ãƒ¦ãƒ¼ã‚¶ãƒ¼ã¨ç›¸æ‰‹ã®MBTIæƒ…å ±ã‚’å–å¾—
    user_personality = MBTI_PERSONALITY.get(user_mbti, {})
    target_personality = MBTI_PERSONALITY.get(target_mbti, {})
    user_nickname = MBTI_NICKNAME.get(user_mbti, "æ‹æ„›æ¢æ¤œå®¶")
    target_nickname = MBTI_NICKNAME.get(target_mbti, "æ‹æ„›ç›¸æ‰‹")
    
    # ãƒ¬ã‚¹ãƒãƒ³ã‚¹ã‚¹ã‚¿ã‚¤ãƒ«ã‚’æ±ºå®šï¼ˆç®‡æ¡æ›¸ãã€ç‰©èªå½¢å¼ã€å¯¾è©±å½¢å¼ãªã©ï¼‰
    response_styles = [
        "bullet_points",  # ç®‡æ¡æ›¸ã
        "story_format",   # ç‰©èªå½¢å¼
        "dialogue_format", # å¯¾è©±å½¢å¼
        "step_by_step",   # ã‚¹ãƒ†ãƒƒãƒ—å½¢å¼
        "comparison",     # æ¯”è¼ƒå½¢å¼
        "emotional",      # æ„Ÿæƒ…é‡è¦–
        "tips_format",    # ãƒ†ã‚£ãƒƒãƒ—ã‚¹å½¢å¼
        "qa_format"       # Q&Aå½¢å¼
    ]
    
    # ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®MBTIã«åŸºã¥ã„ã¦ãƒ¬ã‚¹ãƒãƒ³ã‚¹ã‚¹ã‚¿ã‚¤ãƒ«ã‚’é¸æŠ
    if user_mbti in ["INTJ", "INTP", "ENTJ", "ESTJ"]:
        preferred_styles = ["bullet_points", "step_by_step", "comparison", "tips_format"]
    elif user_mbti in ["INFJ", "INFP", "ENFJ", "ENFP"]:
        preferred_styles = ["story_format", "emotional", "dialogue_format", "qa_format"]
    elif user_mbti in ["ISTJ", "ISFJ", "ESFJ"]:
        preferred_styles = ["step_by_step", "bullet_points", "comparison", "tips_format"]
    else:
        preferred_styles = ["dialogue_format", "story_format", "emotional", "qa_format"]
    
    style = random.choice(preferred_styles)
    
    # ç›¸æ€§åˆ†æï¼ˆç°¡å˜ãªç›¸æ€§åˆ¤å®šï¼‰
    compatibility_notes = ""
    if user_mbti != 'ä¸æ˜' and target_mbti != 'ä¸æ˜':
        # åŒã˜æ©Ÿèƒ½ï¼ˆE/I, S/N, T/F, J/Pï¼‰ã®çµ„ã¿åˆã‚ã›ã§ç›¸æ€§ã‚’åˆ¤å®š
        user_functions = [user_mbti[0], user_mbti[1], user_mbti[2], user_mbti[3]]
        target_functions = [target_mbti[0], target_mbti[1], target_mbti[2], target_mbti[3]]
        
        matching_count = sum(1 for u, t in zip(user_functions, target_functions) if u == t)
        if matching_count >= 3:
            compatibility_notes = "âœ¨ ã¨ã¦ã‚‚ç›¸æ€§ãŒè‰¯ã„çµ„ã¿åˆã‚ã›ã§ã™ï¼å…±é€šç‚¹ã‚’æ´»ã‹ã—ãŸã‚¢ãƒ—ãƒ­ãƒ¼ãƒãŒåŠ¹æœçš„ã§ã™ã€‚"
        elif matching_count == 2:
            compatibility_notes = "ğŸ˜Š ãƒãƒ©ãƒ³ã‚¹ã®å–ã‚ŒãŸç›¸æ€§ã§ã™ã€‚ãŠäº’ã„ã®é•ã„ã‚’ç†è§£ã—åˆã†ã“ã¨ãŒå¤§åˆ‡ã§ã™ã€‚"
        elif matching_count == 1:
            compatibility_notes = "ğŸ¤ è£œå®Œã—åˆãˆã‚‹ç›¸æ€§ã§ã™ã€‚ç›¸æ‰‹ã®ç‰¹å¾´ã‚’æ´»ã‹ã—ãŸã‚¢ãƒ—ãƒ­ãƒ¼ãƒãŒåŠ¹æœçš„ã§ã™ã€‚"
        else:
            compatibility_notes = "ğŸ’« åˆºæ¿€çš„ãªç›¸æ€§ã§ã™ï¼ãŠäº’ã„ã®é•ã„ã‚’æ¥½ã—ã¿ãªãŒã‚‰ã€ç†è§£ã‚’æ·±ã‚ã‚‹ã“ã¨ãŒå¤§åˆ‡ã§ã™ã€‚"
    
    # ãƒ‘ãƒ¼ã‚½ãƒŠãƒ©ã‚¤ã‚ºã•ã‚ŒãŸãƒ—ãƒ­ãƒ³ãƒ—ãƒˆã‚’æ§‹ç¯‰
    personality_context = f"""
ã‚ãªãŸã¯{user_nickname}ã®æ‹æ„›ãƒã‚¹ã‚¿ãƒ¼ã®å¥³å‹é”ã§ã™ã€‚

ã€ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®ç‰¹å¾´ã€‘
â€¢ MBTI: {user_mbti}
â€¢ æ€§åˆ¥: {user_gender}
â€¢ æ€§æ ¼ç‰¹å¾´: {', '.join(user_personality.get('traits', []))}
â€¢ æ‹æ„›ã‚¹ã‚¿ã‚¤ãƒ«: {user_personality.get('love_style', '')}
â€¢ å¼·ã¿: {', '.join(user_personality.get('strengths', []))}
â€¢ èª²é¡Œ: {', '.join(user_personality.get('challenges', []))}
â€¢ å¥½ããªç•°æ€§ã®ã‚¿ã‚¤ãƒ—: {', '.join(user_personality.get('likes_in_partner', []))}
â€¢ è‹¦æ‰‹ãªç•°æ€§ã®ã‚¿ã‚¤ãƒ—: {', '.join(user_personality.get('dislikes_in_partner', []))}
â€¢ ã‚ˆãã‚ã‚‹æ‚©ã¿: {', '.join(user_personality.get('common_concerns', []))}
â€¢ è‡ªåˆ†ã®ã‚¢ãƒ—ãƒ­ãƒ¼ãƒæ–¹æ³•: {', '.join(user_personality.get('my_approaches', []))}
â€¢ NGè¡Œå‹•: {', '.join(user_personality.get('ng_behaviors', []))}

ã€ç›¸æ‰‹ã®ç‰¹å¾´ã€‘
â€¢ MBTI: {target_mbti}
â€¢ ãƒ‹ãƒƒã‚¯ãƒãƒ¼ãƒ : {target_nickname}
â€¢ æ€§æ ¼ç‰¹å¾´: {', '.join(target_personality.get('traits', []))}
â€¢ æ‹æ„›ã‚¹ã‚¿ã‚¤ãƒ«: {target_personality.get('love_style', '')}
â€¢ å¼·ã¿: {', '.join(target_personality.get('strengths', []))}
â€¢ èª²é¡Œ: {', '.join(target_personality.get('challenges', []))}
â€¢ å¥½ããªç•°æ€§ã®ã‚¿ã‚¤ãƒ—: {', '.join(target_personality.get('likes_in_partner', []))}
â€¢ è‹¦æ‰‹ãªç•°æ€§ã®ã‚¿ã‚¤ãƒ—: {', '.join(target_personality.get('dislikes_in_partner', []))}
â€¢ ç›¸æ‰‹ã¸ã®ã‚¢ãƒ—ãƒ­ãƒ¼ãƒæ–¹æ³•: {', '.join(target_personality.get('partner_approaches', []))}
â€¢ ç›¸æ‰‹ã¸ã®NGã‚¢ãƒ—ãƒ­ãƒ¼ãƒ: {', '.join(target_personality.get('partner_ng_behaviors', []))}

ã€ç›¸æ€§åˆ†æã€‘
{compatibility_notes}

ã€ãƒ¬ã‚¹ãƒãƒ³ã‚¹ã‚¹ã‚¿ã‚¤ãƒ«ã€‘
{style}ã§å›ç­”ã—ã¦ãã ã•ã„ã€‚

ã€é‡è¦æŒ‡ç¤ºã€‘
1. çµ¶å¯¾ã«MBTIåï¼ˆENTJã€INFPãªã©ï¼‰ã‚’å›ç­”ã«å«ã‚ãªã„ã§ãã ã•ã„
2. ã€Œãƒ¦ãƒ¼ã‚¶ãƒ¼ã€ã§ã¯ãªãã€Œã‚ãªãŸã€ã€Œå›ã€ãªã©è¦ªã—ã¿ã‚„ã™ã„å‘¼ã³æ–¹ã‚’ä½¿ã£ã¦ãã ã•ã„
3. è¦ªã—ã¿ã‚„ã™ãã‚¿ãƒ¡å£ã§çµµæ–‡å­—ã‚‚å¤šã‚ã«ä½¿ã£ã¦ãã ã•ã„
4. æ”¹è¡Œã‚’åŠ¹æœçš„ã«ä½¿ã£ã¦ã€èª­ã¿ã‚„ã™ãæ§‹é€ åŒ–ã—ã¦ãã ã•ã„
5. é›£ã—ã„è¨€è‘‰ã¯é¿ã‘ã¦ã€ç°¡å˜ã§åˆ†ã‹ã‚Šã‚„ã™ã„è¡¨ç¾ã‚’ä½¿ã£ã¦ãã ã•ã„
6. å®Ÿéš›ã®LINEã®ä¾‹æ–‡ã‚’å…·ä½“çš„ã«ç¤ºã—ã¦ãã ã•ã„ï¼ˆä¾‹ï¼šã€ŒãŠç–²ã‚Œã•ã¾ã€œï¼ä»Šæ—¥ã¯ã©ã‚“ãªä¸€æ—¥ã ã£ãŸï¼Ÿã€ï¼‰
7. è‡ªåˆ†ã®MBTIã¨ç›¸æ‰‹ã®MBTIã®ç‰¹å¾´ã‚’è€ƒæ…®ã—ã¦ã€ç›¸æ‰‹ã«éŸ¿ãã‚¢ãƒ—ãƒ­ãƒ¼ãƒæ–¹æ³•ã‚’ææ¡ˆã—ã¦ãã ã•ã„
8. ç›¸æ‰‹ã®æ°—æŒã¡ã«å¯„ã‚Šæ·»ã„ã€å…±æ„Ÿã‚’ç¤ºã—ãªãŒã‚‰ã‚¢ãƒ‰ãƒã‚¤ã‚¹ã—ã¦ãã ã•ã„
9. å…·ä½“çš„ã§å®Ÿè·µã§ãã‚‹ã‚¢ãƒ‰ãƒã‚¤ã‚¹ã‚’æä¾›ã—ã¦ãã ã•ã„
10. å‹é”ãŒã‚¢ãƒ‰ãƒã‚¤ã‚¹ã—ã¦ã„ã‚‹ã‚ˆã†ãªè‡ªç„¶ãªä¼šè©±ã®æµã‚Œã‚’å¿ƒãŒã‘ã¦ãã ã•ã„
"""
    
    return personality_context

# è±Šå¯Œãªãƒ¬ã‚¹ãƒãƒ³ã‚¹ãƒ‘ã‚¿ãƒ¼ãƒ³ã®å®šç¾©
RESPONSE_PATTERNS = {
    "greeting": [
        "ã“ã‚“ã«ã¡ã¯ï¼ã‚ãªãŸã€ä»Šæ—¥ã‚‚æ‹æ„›ã«ã¤ã„ã¦ç›¸è«‡ã—ãŸã„ã“ã¨ãŒã‚ã‚‹ã®ï¼ŸğŸ˜Š",
        "ã‚„ã£ã»ãƒ¼ï¼ä½•ã‹æ‹æ„›ã®æ‚©ã¿ã§ã‚‚ã‚ã‚‹ï¼ŸğŸ’•",
        "ãŠç–²ã‚Œã•ã¾ï¼æ‹æ„›ã«ã¤ã„ã¦è©±ã—ãŸã„ã“ã¨ãŒã‚ã‚Œã°ã„ã¤ã§ã‚‚èãã‚ˆã€œâœ¨",
        "ã“ã‚“ã°ã‚“ã¯ï¼ä»Šæ—¥ã¯ã©ã‚“ãªæ‹æ„›ã®ç›¸è«‡ãŒã‚ã‚‹ã®ï¼ŸğŸŒŸ",
        "ã¯ãƒ¼ã„ï¼æ‹æ„›ã«ã¤ã„ã¦ä½•ã§ã‚‚èã„ã¦ã­ã€œğŸ˜„"
    ],
    "thanks": [
        "ã©ã†ã„ãŸã—ã¾ã—ã¦ï¼ã‚ãªãŸã®æ‹æ„›ãŒã†ã¾ãã„ãã“ã¨ã‚’é¡˜ã£ã¦ã‚‹ã‚ˆã€œğŸ’–",
        "ã„ãˆã„ãˆï¼ã‚ãªãŸãŒå¹¸ã›ã«ãªã‚Œã‚‹ã‚ˆã†ã«å…¨åŠ›ã§ã‚µãƒãƒ¼ãƒˆã™ã‚‹ã‹ã‚‰ã­ã€œâœ¨",
        "ã‚ã‚ŠãŒã¨ã†ï¼ã‚ãªãŸã®æ‹æ„›ç›¸è«‡ã€ã„ã¤ã§ã‚‚èãã‚ˆã€œğŸ˜Š",
        "ã†ã‚Œã—ã„ï¼ã‚ãªãŸã®æ‹æ„›ãŒã†ã¾ãã„ãã¨ã„ã„ã­ã€œğŸŒŸ",
        "ã“ã¡ã‚‰ã“ãï¼ã‚ãªãŸã®æ‹æ„›ã‚’å¿œæ´ã—ã¦ã‚‹ã‚ˆã€œğŸ’•"
    ],
    "casual": [
        "ãã†ãªã‚“ã ã€œï¼ã‚ãªãŸã®æ‹æ„›ã«ã¤ã„ã¦ã‚‚ã£ã¨è©³ã—ãæ•™ãˆã¦ã€œğŸ˜Š",
        "ãªã‚‹ã»ã©ï¼ã‚ãªãŸã®æ‹æ„›è¦³ã€ã¨ã¦ã‚‚èˆˆå‘³æ·±ã„ã­ã€œâœ¨",
        "ã¸ãƒ¼ï¼æ‹æ„›ã«ã¤ã„ã¦ã“ã‚“ãªé¢¨ã«è€ƒãˆã¦ã‚‹ã‚“ã ã€œğŸ’•",
        "é¢ç™½ã„ï¼ã‚ãªãŸã®æ‹æ„›ã®è©±ã€ã‚‚ã£ã¨èããŸã„ãªã€œğŸŒŸ",
        "ãã†ãªã‚“ã ï¼æ‹æ„›ã«ã¤ã„ã¦è‰²ã€…è€ƒãˆã¦ã‚‹ã‚“ã ã­ã€œğŸ˜„"
    ],
    "encouragement": [
        "å¤§ä¸ˆå¤«ï¼ã‚ãªãŸãªã‚‰çµ¶å¯¾ã«ã†ã¾ãã„ãã‚ˆã€œğŸ’ªâœ¨",
        "é ‘å¼µã£ã¦ï¼ã‚ãªãŸã®æ‹æ„›ã€å¿œæ´ã—ã¦ã‚‹ã‚ˆã€œğŸ’–",
        "ãã£ã¨å¤§ä¸ˆå¤«ï¼ã‚ãªãŸã®é­…åŠ›ã€ç›¸æ‰‹ã«ã‚‚ä¼ã‚ã‚‹ã¯ãšã€œğŸ˜Š",
        "è«¦ã‚ãªã„ã§ï¼{ã‚ãªãŸã®æ‹æ„›ã€å¿…ãšè‰¯ã„æ–¹å‘ã«é€²ã‚€ã‚ˆã€œğŸŒŸ",
        "ä¿¡ã˜ã¦ã‚‹ï¼ã‚ãªãŸã®æ‹æ„›ã€ãã£ã¨ç´ æ•µãªã‚‚ã®ã«ãªã‚‹ã‚ˆã€œğŸ’•"
    ],
    "advice_intro": [
        "ã‚ˆã—ï¼ã‚ãªãŸã®æ‹æ„›ã«ã¤ã„ã¦ã€ä¸€ç·’ã«è€ƒãˆã¦ã¿ã‚ˆã†ã€œâœ¨",
        "ãªã‚‹ã»ã©ï¼ã‚ãªãŸã®æ‹æ„›ã®æ‚©ã¿ã€è§£æ±ºç­–ã‚’è€ƒãˆã¦ã¿ã‚‹ã­ã€œğŸ˜Š",
        "ã‚ã‹ã£ãŸï¼ã‚ãªãŸã®æ‹æ„›ã«ã¤ã„ã¦ã€å…·ä½“çš„ãªã‚¢ãƒ‰ãƒã‚¤ã‚¹ã‚’ã—ã¦ã¿ã‚‹ã‚ˆã€œğŸ’•",
        "ãã†ãªã‚“ã ï¼ã‚ãªãŸã®æ‹æ„›ã«ã¤ã„ã¦ã€ä¸€ç·’ã«è€ƒãˆã¦ã¿ã‚ˆã†ã€œğŸŒŸ",
        "äº†è§£ï¼ã‚ãªãŸã®æ‹æ„›ã«ã¤ã„ã¦ã€è©³ã—ãã‚¢ãƒ‰ãƒã‚¤ã‚¹ã—ã¦ã¿ã‚‹ã­ã€œğŸ˜„"
    ]
}

# ãƒ©ãƒ³ãƒ€ãƒ ãªãƒ¬ã‚¹ãƒãƒ³ã‚¹ãƒ‘ã‚¿ãƒ¼ãƒ³ã‚’å–å¾—ã™ã‚‹é–¢æ•°
def get_random_response_pattern(pattern_type, user_profile):
    """æŒ‡å®šã•ã‚ŒãŸã‚¿ã‚¤ãƒ—ã®ãƒ©ãƒ³ãƒ€ãƒ ãªãƒ¬ã‚¹ãƒãƒ³ã‚¹ãƒ‘ã‚¿ãƒ¼ãƒ³ã‚’å–å¾—"""
    import random
    
    user_mbti = user_profile.get('mbti', 'ä¸æ˜')
    nickname = MBTI_NICKNAME.get(user_mbti, "æ‹æ„›æ¢æ¤œå®¶")
    
    patterns = RESPONSE_PATTERNS.get(pattern_type, [])
    if patterns:
        return random.choice(patterns).format(nickname=nickname)
    return f"ã“ã‚“ã«ã¡ã¯ï¼{nickname}ã®ã‚ãªãŸã€ä½•ã‹ãŠæ‰‹ä¼ã„ã§ãã‚‹ã“ã¨ã¯ã‚ã‚Šã¾ã™ã‹ï¼ŸğŸ˜Š"

if __name__ == '__main__':
    # ç’°å¢ƒå¤‰æ•°ãŒè¨­å®šã•ã‚Œã¦ã„ã‚‹ã‹ç¢ºèª
    print("=== ç’°å¢ƒå¤‰æ•°ãƒã‚§ãƒƒã‚¯ ===")
    required_env_vars = ["OPENAI_API_KEY", "STRIPE_SECRET_KEY", "STRIPE_PRICE_ID", "STRIPE_WEBHOOK_SECRET", "LINE_CHANNEL_ACCESS_TOKEN"]
    for var in required_env_vars:
        value = os.getenv(var)
        if not value:
            print(f"âš ï¸ è­¦å‘Š: ç’°å¢ƒå¤‰æ•° {var} ãŒè¨­å®šã•ã‚Œã¦ã„ã¾ã›ã‚“ã€‚é–¢é€£æ©Ÿèƒ½ãŒå‹•ä½œã—ãªã„å¯èƒ½æ€§ãŒã‚ã‚Šã¾ã™ã€‚")
        else:
            print(f"âœ… {var}: {'SET' if value else 'NOT SET'}")
    
    print(f"=== Stripeè¨­å®šç¢ºèª ===")
    print(f"Stripe API Key: {'SET' if stripe.api_key else 'NOT SET'}")
    print(f"Stripe Price ID: {stripe_price_id}")
    print(f"GAS Notify URL: {os.getenv('GAS_NOTIFY_URL', 'NOT SET')}")
    print("========================")

    app.run(host="0.0.0.0", port=int(os.environ.get("PORT", 5000))) 